/**
 * @license
 * Copyright (c) 2014, 2025, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["ojs/ojcore-base","knockout","ojs/ojcustomelement","ojs/ojcustomelement-utils","ojs/ojkoshared","ojs/ojlogger","ojs/ojtemplateengine-ko"],function(e,t,o,n,l,r,i){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,l=l&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i;const a={};e._registerLegacyNamespaceProp("CompositeTemplateRenderer",a),a.renderTemplate=function(o,n,l){var r=a._storeNodes(n,l);t.virtualElements.setDomNodeChildren(n,l),a.invokeViewModelMethod(n,o.viewModel,"attached",[o.viewModelContext]),a.invokeViewModelMethod(n,o.viewModel,"connected",[o.viewModelContext]);var i=a._getKoBindingContext().createChildContext(o.viewModel,void 0,function(t){t[e.Composite.__COMPOSITE_PROP]=n,t.__oj_slots=o.slotMap,t.__oj_nodestorage=r,t.$slotNodeCounts=o.slotNodeCounts,t.$slotCounts=o.slotNodeCounts,t.$props=o.props,t.$properties=o.props,t.$unique=o.unique,t.$uniqueId=o.uniqueId,t.$parent=null,t.$parentContext=null,t.$parents=null,t.$provided=null});t.applyBindingsToDescendants(i,n),a.invokeViewModelMethod(n,o.viewModel,"bindingsApplied",[o.viewModelContext])},a.getEnclosingComposite=function(o){for(var n=null,l=t.contextFor(o);l&&!n;l=l.$parentContext)n=l[e.Composite.__COMPOSITE_PROP];return n},a.createTracker=function(){return t.observable()},a.invokeViewModelMethod=function(e,o,n,l){if(null!=o){var r=o[n];if("function"==typeof r)try{return t.ignoreDependencies(r,o,l)}catch(t){throw new Error("Error while invoking "+n+" callback for "+e.tagName.toLowerCase()+" with id '"+e.id+"'.")}}},a._storeNodes=function(e,t){var o,l=e.childNodes;if(l){(o=document.createElement("div")).setAttribute("data-bind","_ojNodeStorage_"),o.style.display="none",t.push(o);for(var r=[],i=0;i<l.length;i++){var a=l[i];n.CustomElementUtils.isSlotable(a)&&r.push(a)}r.forEach(function(e){o.appendChild(e)}),n.CustomElementUtils.subtreeHidden(o)}return o},a._getKoBindingContext=function(){if(!a._BINDING_CONTEXT){var e=document.createElement("div");t.applyBindings(null,e),a._BINDING_CONTEXT=t.contextFor(e),t.cleanNode(e)}return a._BINDING_CONTEXT},a._BINDING_CONTEXT=null,function(){function e(e,o){var n,l,r=["name","slot"];o?(r.push("data"),r.push("as"),l="ko _ojBindTemplateSlot_:{"):(r.push("index"),l="ko _ojBindSlot_:{");for(var i=[],a=0;a<r.length;a++){var s=r[a],d=t(e.getAttribute(s));d&&i.push(s+":"+d)}l+=i.join(","),l+="}";var u=document.createComment(l),c=document.createComment("/ko");n=[u];var p=e.parentNode;for(p.insertBefore(u,e);e.childNodes.length>0;){var m=e.childNodes[0];p.insertBefore(m,e),n.push(m)}return n.push(c),p.replaceChild(c,e),n}function t(e){if(null!=e){var t=n.AttributeUtils.getExpressionInfo(e).expr;return null==t&&(t="'"+e+"'"),t}return null}l.registerPreprocessor("oj-bind-slot",e),l.registerPreprocessor("oj-slot",e),l.registerPreprocessor("oj-bind-template-slot",function(t){return e(t,!0)})}(),t.bindingHandlers._ojNodeStorage_={init:function(){return{controlsDescendantBindings:!0}}};const s={};e._registerLegacyNamespaceProp("SlotUtils",s),s.cleanup=function(e,o){var l=o.__oj_nodestorage;if(l)for(var r=t.virtualElements.firstChild(e);r;){var i=t.virtualElements.nextSibling(r);null!=r.__oj_slots&&(l.appendChild(r),1===r.nodeType&&n.CustomElementUtils.subtreeHidden(r)),r=i}},s.preactTemplateCleanup=function(e,t,o){o.forEach(o=>{try{e.clean(o,t)}catch(e){r.warn("Error during template cleanup "+e)}})},t.bindingHandlers._ojBindSlot_={init:function(e,o,l,r,i){t.utils.domNodeDisposal.addDisposeCallback(e,s.cleanup.bind(null,e,i));var a=i.__oj_slots,d=o(),u=t.utils.unwrapObservable,c=u(d.name)||"",p=u(d.slot)||"",m=u(d.index),_=null!=m?[a[c][m]]:a[c];if(_){var f;for(f=0;f<_.length;f++){_[f].__oj_slots=p}n.CustomElementUtils.allowSlotRelocation(!0);try{t.virtualElements.setDomNodeChildren(e,_)}finally{n.CustomElementUtils.allowSlotRelocation(!1)}for(f=0;f<_.length;f++){var C=_[f];1===C.nodeType&&n.CustomElementUtils.subtreeShown(C)}return{controlsDescendantBindings:!0}}t.virtualElements.childNodes(e).forEach(function(e){(function(e){return 1===e.nodeType||3===e.nodeType&&e.nodeValue.trim()})(e)&&(e.__oj_slots=p)})}},t.virtualElements.allowedBindings._ojBindSlot_=!0,t.bindingHandlers._ojBindTemplateSlot_={init:function(o,l,a,d,u){t.utils.domNodeDisposal.addDisposeCallback(o,s.cleanup.bind(null,o,u));var c=u.__oj_slots,p=l(),m=t.utils.unwrapObservable,_=m(p.name)||"",f=c[_],C=f&&f[f.length-1],v=!1;if(!C)for(var g=t.virtualElements.childNodes(o),h=0;h<g.length;h++)if("TEMPLATE"===g[h].tagName){v=!0,C=g[h];break}if(C){var E=u[e.Composite.__COMPOSITE_PROP];"TEMPLATE"!==C.tagName&&r.error("Slot content for slot '"+_+"' under "+E.tagName.toLowerCase()+" with id '"+E.id+"' should be wrapped inside a <template> node."),C.__oj_slots=m(p.slot)||"";const l=i,a=v?o:E;let d;if(t.computed(function(){C.render&&d&&s.preactTemplateCleanup(l,a,d);var e=m(p.data),n=m(p.as);d=l.execute(a,C,e,v?n:null),t.virtualElements.setDomNodeChildren(o,d)}),C.render){const e=n.CustomElementUtils.getElementState(E);e.addTemplateCleanCallback&&e.addTemplateCleanCallback(()=>{s.preactTemplateCleanup(l,a,d)}),t.utils.domNodeDisposal.addDisposeCallback(o,()=>{s.preactTemplateCleanup(l,a,d)})}}else t.virtualElements.setDomNodeChildren(o,[]);return{controlsDescendantBindings:!0}}},t.virtualElements.allowedBindings._ojBindTemplateSlot_=!0});
//# sourceMappingURL=ojcomposite-knockout.js.map