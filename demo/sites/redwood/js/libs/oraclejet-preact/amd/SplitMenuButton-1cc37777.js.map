{"version":3,"file":"SplitMenuButton-1cc37777.js","sources":["../../src/UNSAFE_SplitMenuButton/SplitMenuButton.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nimport { ButtonLabelLayout } from '../UNSAFE_ButtonLabelLayout';\nimport { MenuButtonDropdownIcon } from '../PRIVATE_ThemedIcons/MenuButtonDropdownIcon';\nimport { Menu } from '../UNSAFE_Menu';\nimport { Text } from '../UNSAFE_Text';\n\nimport { BaseButton, StylingOptions } from '../UNSAFE_BaseButton';\nimport { UNSAFE_DOM_ACCESS } from '#utils/UNSAFE_unsafeDomAccess';\n\nimport type { UnpackSignals } from '@oracle/oraclejet-internal-utilities/attributeUtils';\nimport { classNames } from '../utils/UNSAFE_classNames';\nimport type { DimensionProps } from '../utils/UNSAFE_interpolations/dimensions';\nimport { TabbableModeContext } from '../hooks/UNSAFE_useTabbableMode';\nimport { dimensionInterpolations } from '../utils/UNSAFE_interpolations/dimensions';\nimport { mergeInterpolations } from '../utils/UNSAFE_mergeInterpolations';\nimport { useComponentTheme } from '../hooks/UNSAFE_useComponentTheme';\nimport { useLongPress } from '../hooks/UNSAFE_useLongPress';\nimport { usePressClick } from '#hooks/UNSAFE_usePressClick';\nimport {\n  SplitMenuButtonStyles,\n  SplitMenuButtonVariantOptions\n} from './themes/SplitMenuButtonStyles.css';\nimport { SplitMenuButtonRedwoodTheme } from './themes/redwood/SplitMenuButtonTheme.css';\n\nimport type { ComponentChildren, ComponentProps, JSX } from 'preact';\nimport { forwardRef, ForwardedRef, ElementRef } from 'preact/compat';\nimport { useCallback, useState, useRef, useImperativeHandle } from 'preact/hooks';\nimport { TestIdProps } from '../hooks/UNSAFE_useTestId';\nimport { mergeProps } from '#utils/UNSAFE_mergeProps';\n\ntype InitialFocusType = ComponentProps<typeof Menu>['initialFocus'];\n\ntype ButtonHandle = ElementRef<typeof BaseButton>;\n\ntype IntrinsicProps = Pick<\n  UnpackSignals<JSX.HTMLAttributes<HTMLElement>>,\n  | 'autofocus'\n  | 'onBlur'\n  | 'onFocus'\n  | 'onMouseEnter'\n  | 'onMouseLeave'\n  | 'onTouchEnd'\n  | 'onTouchStart'\n  | 'aria-describedby'\n>;\n\ntype WidthInterpolationProps = Pick<DimensionProps, 'width'>;\n\nexport type Props = IntrinsicProps &\n  WidthInterpolationProps &\n  TestIdProps & {\n    /**\n     * children - One or more MenuItems\n     */\n    children?: ComponentChildren;\n\n    /**\n     * Specifies that the button element should be disabled.\n     */\n    isDisabled?: boolean;\n\n    /**\n     * The label rendered on the action side of the button.  Used\n     * to identify which child MenuItem action is invoked.\n     */\n    label?: string;\n\n    /**\n     * Indicates in what states the button has chrome (background and border).\n     *     \"outlined\"': \"Outlined buttons are salient, but lighter weight than\n     * solid buttons. Outlined buttons are useful for secondary actions.\",\n     *     \"solid\"': \"Solid buttons stand out, and direct the user's attention to the\n     *  most important actions in the UI.\",\n     *     \"callToAction\"': \"A Call To Action (CTA) button guides the user to take or\n     * complete the action that is the main goal of the page or page section. There\n     * should only be one CTA button on a page at any given time.\",\n     \n     */\n    variant?: 'outlined' | 'solid' | 'callToAction';\n\n    /**\n     * The size indicates how large the button is rendered: \"sm\", \"md\" (default), \"lg\".\n     */\n    size?: 'sm' | 'md' | 'lg';\n\n    /**\n     * Triggered when a button is clicked, whether by keyboard, mouse, or touch events.\n     */\n    onAction?: () => void;\n  };\n\nconst menuButtonStyling = [\n  'embedded',\n  'min',\n  'noBorderRadiusStart',\n  'noBorderStart'\n] as StylingOptions[];\nconst menuButtonActiveStyling = [...menuButtonStyling, 'active'] as StylingOptions[];\n\nconst actionbuttonStyling = [\n  'embedded',\n  'fill',\n  'noBorderRadiusEnd',\n  'noBorderEnd'\n] as StylingOptions[];\nconst actionButtonActiveStyling = [...actionbuttonStyling, 'active'] as StylingOptions[];\n\nconst interpolations = [...Object.values(dimensionInterpolations)];\n\nconst styleInterpolations = mergeInterpolations<DimensionProps>(interpolations);\n\n/**\n * A SplitMenuButton is a combined action and menu button.\n */\nexport const SplitMenuButton = forwardRef(\n  (\n    {\n      children,\n      label = '',\n      variant = 'outlined',\n      isDisabled = false,\n      size = 'md',\n      testId,\n      onAction,\n      'aria-describedby': ariaDescribedBy,\n      onBlur: propsOnBlur,\n      onFocus,\n      onMouseEnter,\n      onMouseLeave,\n      onTouchEnd,\n      onTouchStart,\n      ...props\n    }: Props,\n    ref: ForwardedRef<ButtonHandle>\n  ) => {\n    const rootButtonRef = useRef<ButtonHandle>(null);\n    const actionButtonRef = useRef<ButtonHandle>(null);\n    const [initialFocus, setInitialFocus] = useState<InitialFocusType>('menu');\n\n    useImperativeHandle(\n      ref,\n      () => {\n        return {\n          focus: rootButtonRef.current!.focus,\n          blur: rootButtonRef.current!.blur,\n          [UNSAFE_DOM_ACCESS]: rootButtonRef.current![UNSAFE_DOM_ACCESS],\n\n          // Need to delegate click to the inner action button since\n          // clicking on the outer button does not trigger an action\n          click: actionButtonRef.current!.click\n        };\n      },\n      []\n    );\n\n    const [isMenuOpen, setIsMenuOpen] = useState<boolean>(false);\n    const [isActive, setIsActive] = useState<boolean>(false);\n    const { class: cls, ...styles } = styleInterpolations(props);\n\n    // SPACE or ENTER on root area invokes action, as does CLICK/TAP on LEFT SIDE ACTION AREA\n    // DOWN ARROW invokes menu, as does CLICK/TAP on RIGHT SIDE MENU AREA\n    const onKeyDown = useCallback(\n      (event: KeyboardEvent) => {\n        if (event.key === ' ' || event.key === 'Enter') {\n          setIsActive(true);\n        } else if (event.key == 'ArrowDown') {\n          setInitialFocus('firstItem');\n          !isDisabled && setIsMenuOpen((menuOpen: boolean) => !menuOpen);\n          // Prevent page scroll for down arrow, user definitely wanted to show menu in this case.\n          // Don't prevent other keypress defaults, as user may want to hold SPACE down to scroll page.\n          event.preventDefault();\n        }\n      },\n      [isDisabled, setIsMenuOpen, setIsActive, setInitialFocus]\n    );\n\n    const onKeyUp = useCallback(\n      (event: KeyboardEvent) => {\n        if (event.key === ' ' || event.key === 'Enter') {\n          !isDisabled && onAction && onAction();\n          setIsActive(false);\n        }\n      },\n      [isDisabled, onAction, setIsActive]\n    );\n\n    const { pressProps } = usePressClick(\n      () => {\n        setInitialFocus('firstItem');\n        setIsMenuOpen((menuOpen: boolean) => !menuOpen);\n      },\n      { isDisabled }\n    );\n\n    const { longPressProps } = useLongPress(\n      () => {\n        setInitialFocus('firstItem');\n        setIsMenuOpen((menuOpen: boolean) => !menuOpen);\n      },\n      { isDisabled }\n    );\n\n    const onBlur = useCallback(() => {\n      setIsActive(false);\n    }, [setIsActive]);\n\n    const menuHandler = () => {\n      setInitialFocus('menu');\n      setIsMenuOpen(!isMenuOpen);\n    };\n\n    const handleClose = (e: any) => {\n      //Focus has to be set on the launcher when menu is dismissed or\n      //item is \"selected\"\n      if (e.reason === 'dismissed' || e.reason === 'itemAction') {\n        rootButtonRef.current?.focus();\n      }\n      setIsMenuOpen(false);\n    };\n\n    const { classes, styles: themeStyles } = useComponentTheme<\n      SplitMenuButtonVariantOptions,\n      SplitMenuButtonStyles\n    >(SplitMenuButtonRedwoodTheme, {\n      styleVariant: variant\n    });\n\n    const dividerStyles = classNames([\n      themeStyles.divider,\n      isDisabled && themeStyles.disabledDivider\n    ]);\n\n    const globalEventProps = {\n      onBlur: propsOnBlur,\n      onFocus,\n      onMouseEnter,\n      onMouseLeave,\n      onTouchEnd,\n      onTouchStart\n    };\n\n    const customGlobalEventProps = {\n      onKeyDown: isDisabled ? undefined : onKeyDown,\n      onKeyUp: onKeyUp,\n      onBlur: onBlur,\n      ...longPressProps,\n      ...pressProps\n    };\n\n    const rootStyles = classNames([classes, cls]);\n    // Using Span for top button allows us to avoid :hover state rendering by\n    // taking advantage of :enabled not on spans\n    const rootButton = () => {\n      return (\n        <BaseButton\n          elementDetails={{ type: 'span' }}\n          ref={rootButtonRef}\n          isDisabled={isDisabled}\n          styling={['container', 'min']}\n          variant={variant}\n          size={size}\n          testId={testId}\n          aria-label={label}\n          aria-roledescription=\"split menu button, press down arrow to invoke menu\"\n          aria-describedby={ariaDescribedBy}\n          aria-expanded={isMenuOpen}>\n          <TabbableModeContext.Provider value={{ isTabbable: false }}>\n            <BaseButton\n              elementDetails={{ type: 'span', isFocusable: false }}\n              ref={actionButtonRef}\n              variant={variant}\n              styling={getActionButtonStyling(isActive)}\n              size={size}\n              isDisabled={isDisabled}\n              aria-hidden={true}\n              onAction={onAction}>\n              <Text truncation={'ellipsis'} weight={'inherit'}>\n                {label}\n              </Text>\n            </BaseButton>\n            <div class={`${dividerStyles}`} />\n            <BaseButton\n              elementDetails={{ type: 'span', isFocusable: false }}\n              variant={variant}\n              styling={getMenuButtonStyling(isMenuOpen)}\n              size={size}\n              isDisabled={isDisabled}\n              aria-hidden={true}\n              onAction={menuHandler}>\n              <ButtonLabelLayout\n                display=\"icons\"\n                startIcon={<MenuButtonDropdownIcon />}\n                size={size}\n                styling=\"embedded\"></ButtonLabelLayout>\n            </BaseButton>\n          </TabbableModeContext.Provider>\n        </BaseButton>\n      );\n    };\n\n    if (isDisabled) {\n      return (\n        <span role=\"toolbar\" class={rootStyles} style={styles}>\n          {rootButton()}\n        </span>\n      );\n    } else {\n      /*TODO: Remove this hardcoded offsetValue so we have dropdown offset only set on one single place.\n        Could be done via menu props or having a dropdownMenu component. JET-60595*/\n\n      /*TODO: Once menu expose a prop to set min width we would need to calculate offset width of button\n       so we set the correct min width since dropdown menus are 200px but if triggered element width is\n       bigger should be that size. JET-60745 */\n      return (\n        <span\n          role=\"toolbar\"\n          class={rootStyles}\n          {...mergeProps(globalEventProps, customGlobalEventProps)}\n          style={styles}>\n          {rootButton()}\n          <Menu\n            anchorRef={rootButtonRef}\n            isOpen={isMenuOpen}\n            onClose={handleClose}\n            initialFocus={initialFocus}>\n            {children}\n          </Menu>\n        </span>\n      );\n    }\n  }\n);\n\nfunction getMenuButtonStyling(isActive: boolean) {\n  return isActive ? menuButtonActiveStyling : menuButtonStyling;\n}\n\nfunction getActionButtonStyling(isActive: boolean) {\n  return isActive ? actionButtonActiveStyling : actionbuttonStyling;\n}\n\nSplitMenuButton.displayName = 'SplitMenuButton';\n"],"names":["menuButtonStyling","menuButtonActiveStyling","actionbuttonStyling","actionButtonActiveStyling","interpolations","Object","values","dimensionInterpolations","styleInterpolations","mergeInterpolations","SplitMenuButton","forwardRef","children","label","variant","isDisabled","size","testId","onAction","ariaDescribedBy","onBlur","propsOnBlur","onFocus","onMouseEnter","onMouseLeave","onTouchEnd","onTouchStart","props","ref","rootButtonRef","useRef","actionButtonRef","initialFocus","setInitialFocus","useState","useImperativeHandle","focus","current","blur","UNSAFE_DOM_ACCESS","click","isMenuOpen","setIsMenuOpen","isActive","setIsActive","class","cls","styles","onKeyDown","useCallback","event","key","menuOpen","preventDefault","onKeyUp","pressProps","usePressClick","longPressProps","useLongPress","menuHandler","handleClose","e","reason","classes","themeStyles","useComponentTheme","SplitMenuButtonRedwoodTheme","styleVariant","dividerStyles","classNames","divider","disabledDivider","globalEventProps","customGlobalEventProps","undefined","rootStyles","rootButton","_jsx","BaseButton","elementDetails","type","styling","_jsxs","TabbableModeContext","Provider","value","isTabbable","isFocusable","getActionButtonStyling","Text","truncation","weight","jsx","getMenuButtonStyling","ButtonLabelLayout","display","startIcon","MenuButtonDropdownIcon","role","style","mergeProps","Menu","anchorRef","isOpen","onClose","displayName"],"mappings":"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"}