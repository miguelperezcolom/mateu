{"version":3,"file":"useDnd-33ec1cdf.js","sources":["../../src/hooks/PRIVATE_useVisDnd/useDnd.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nimport { Dispatch, StateUpdater, useRef } from 'preact/hooks';\nimport type { CommonDndProps } from '#utils/UNSAFE_visTypes/common';\n\nexport type DragImageProps<DragStartDetail> = {\n  event: DragEvent;\n  target: HTMLElement;\n  context: DragStartDetail;\n};\n\ntype Props<DragStartDetail, DropDetail> = {\n  getDragContext: (target: HTMLElement, event: DragEvent) => DragStartDetail;\n  getDragImage: (props: DragImageProps<DragStartDetail>) => {\n    image: HTMLElement | SVGElement;\n    offSetX: number;\n    offSetY: number;\n    width: number;\n    height: number;\n  } | null;\n  getDropContext: (event: DragEvent) => DropDetail;\n  onPreDndStart?: (detail: DragStartDetail) => void;\n  setDatatipDisabled: Dispatch<StateUpdater<boolean>>;\n  showDropEffect?: (context: DropDetail) => void;\n  showRejectedDropEffect?: (event: DropDetail) => void;\n  clearDropEffect?: () => void;\n} & CommonDndProps<DragStartDetail, DropDetail>;\n\nexport const useDnd = <DragStartDetail, DropDetail>({\n  onDragStart,\n  onDrag,\n  onDragEnd,\n  onDragEnter,\n  onDragLeave,\n  onDragOver,\n  onDrop,\n  getDragContext,\n  getDropContext,\n  getDragImage,\n  onPreDndStart,\n  setDatatipDisabled,\n  showDropEffect = () => undefined,\n  showRejectedDropEffect = () => undefined,\n  clearDropEffect = () => undefined\n}: Props<DragStartDetail, DropDetail>) => {\n  const dragCandidate = useRef<HTMLElement | null>(null);\n  const dragImageRef = useRef<HTMLDivElement>(null);\n  const dndContent = <div ref={dragImageRef}></div>;\n  const onPointerDown = (event: PointerEvent) => {\n    dragCandidate.current = event.target as HTMLElement;\n  };\n\n  const onDndStart = (event: DragEvent) => {\n    const target = dragCandidate.current ? dragCandidate.current : (event.target as HTMLElement);\n    const context = getDragContext(target, event);\n    if (context) {\n      onPreDndStart && onPreDndStart(context);\n      setDatatipDisabled(true);\n      const dragImg = getDragImage({ event, target, context });\n      if (!dragImg) return;\n      const dragImage = dragImg.image;\n      dragImage.style.width = dragImg.width + 'px';\n      dragImage.style.height = dragImg.height + 'px';\n      // JET-69400 Drag and drop multiple nodes far apart shows wrong drag image\n      dragImage.style.left = -1 * dragImg.width + 'px';\n      dragImage.style.top = -1 * dragImg.height + 'px';\n      dragImage.style.position = 'absolute';\n      document.body.append(dragImage); // @HTMLUpdateOK will remove in next animation frame\n      event.dataTransfer?.setDragImage(dragImage, dragImg.offSetX, dragImg.offSetY);\n      window.requestAnimationFrame(() => {\n        document.body.removeChild(dragImage);\n      });\n      onDragStart && onDragStart(context);\n    } else {\n      event.preventDefault();\n    }\n  };\n\n  const onDndDrag = (event: DragEvent) => {\n    onDrag && onDrag({ event: event });\n  };\n\n  const onDndEnd = (event: DragEvent) => {\n    setDatatipDisabled(false);\n    onDragEnd && onDragEnd({ event: event });\n  };\n\n  const onDndEnter = (event: DragEvent) => {\n    const context = getDropContext(event);\n    if (onDragEnter && context) {\n      onDragEnter(context);\n      if (event.defaultPrevented) {\n        showDropEffect(context);\n      } else {\n        showRejectedDropEffect(context);\n      }\n    }\n  };\n\n  const onDndLeave = (event: DragEvent) => {\n    const context = getDropContext(event) as DropDetail;\n    onDragLeave && context && onDragLeave(context);\n    clearDropEffect();\n  };\n\n  const onDndOver = (event: DragEvent) => {\n    const context = getDropContext(event) as DropDetail;\n    if (onDragOver && context) {\n      onDragOver(context);\n      if (event.defaultPrevented) {\n        showDropEffect(context);\n      } else {\n        showRejectedDropEffect(context);\n      }\n    }\n  };\n\n  const onDndDrop = (event: DragEvent) => {\n    const context = getDropContext(event) as DropDetail;\n    onDrop && context && onDrop(context);\n    clearDropEffect();\n  };\n\n  return {\n    dragProps: {\n      onDragStart: onDndStart,\n      onDrag: onDndDrag,\n      onDragEnd: onDndEnd,\n      onPointerDown\n    },\n    dropProps: {\n      onDragEnter: onDndEnter,\n      onDragLeave: onDndLeave,\n      onDragOver: onDndOver,\n      onDrop: onDndDrop\n    },\n    content: dndContent\n  };\n};\n"],"names":["onDragStart","onDrag","onDragEnd","onDragEnter","onDragLeave","onDragOver","onDrop","getDragContext","getDropContext","getDragImage","onPreDndStart","setDatatipDisabled","showDropEffect","showRejectedDropEffect","clearDropEffect","dragCandidate","useRef","dragImageRef","dragProps","event","target","current","context","dragImg","dragImage","image","style","width","height","left","top","position","document","body","append","dataTransfer","setDragImage","offSetX","offSetY","window","requestAnimationFrame","removeChild","preventDefault","onPointerDown","dropProps","defaultPrevented","content","_jsx","ref"],"mappings":"8FAiCsB,EACpBA,cACAC,SACAC,YACAC,cACAC,cACAC,aACAC,SACAC,iBACAC,iBACAC,eACAC,gBACAC,qBACAC,iBAAiB,KAAe,EAChCC,yBAAyB,KAAe,EACxCC,kBAAkB,WAElB,MAAMC,EAAgBC,SAA2B,MAC3CC,EAAeD,SAAuB,MA6E5C,MAAO,CACLE,UAAW,CACTlB,YAzEgBmB,IAClB,MAAMC,EAASL,EAAcM,QAAUN,EAAcM,QAAWF,EAAMC,OAChEE,EAAUf,EAAea,EAAQD,GACvC,GAAIG,EAAS,CACXZ,GAAiBA,EAAcY,GAC/BX,GAAmB,GACnB,MAAMY,EAAUd,EAAa,CAAEU,QAAOC,SAAQE,YAC9C,IAAKC,EAAS,OACd,MAAMC,EAAYD,EAAQE,MAC1BD,EAAUE,MAAMC,MAAQJ,EAAQI,MAAQ,KACxCH,EAAUE,MAAME,OAASL,EAAQK,OAAS,KAE1CJ,EAAUE,MAAMG,MAAQ,EAAIN,EAAQI,MAAQ,KAC5CH,EAAUE,MAAMI,KAAO,EAAIP,EAAQK,OAAS,KAC5CJ,EAAUE,MAAMK,SAAW,WAC3BC,SAASC,KAAKC,OAAOV,GACrBL,EAAMgB,cAAcC,aAAaZ,EAAWD,EAAQc,QAASd,EAAQe,SACrEC,OAAOC,uBAAsB,KAC3BR,SAASC,KAAKQ,YAAYjB,EAAU,IAEtCxB,GAAeA,EAAYsB,EAC5B,MACCH,EAAMuB,gBACP,EAmDCzC,OAhDekB,IACjBlB,GAAUA,EAAO,CAAEkB,MAAOA,GAAQ,EAgDhCjB,UA7CciB,IAChBR,GAAmB,GACnBT,GAAaA,EAAU,CAAEiB,MAAOA,GAAQ,EA4CtCwB,cAhFmBxB,IACrBJ,EAAcM,QAAUF,EAAMC,MAAqB,GAiFnDwB,UAAW,CACTzC,YA5CgBgB,IAClB,MAAMG,EAAUd,EAAeW,GAC3BhB,GAAemB,IACjBnB,EAAYmB,GACRH,EAAM0B,iBACRjC,EAAeU,GAEfT,EAAuBS,GAE1B,EAoCClB,YAjCgBe,IAClB,MAAMG,EAAUd,EAAeW,GAC/Bf,GAAekB,GAAWlB,EAAYkB,GACtCR,GAAiB,EA+BfT,WA5Bec,IACjB,MAAMG,EAAUd,EAAeW,GAC3Bd,GAAciB,IAChBjB,EAAWiB,GACPH,EAAM0B,iBACRjC,EAAeU,GAEfT,EAAuBS,GAE1B,EAoBChB,OAjBea,IACjB,MAAMG,EAAUd,EAAeW,GAC/Bb,GAAUgB,GAAWhB,EAAOgB,GAC5BR,GAAiB,GAgBjBgC,QAzFiBC,EAAAA,IAAA,MAAA,CAAKC,IAAK/B,IA0F5B"}