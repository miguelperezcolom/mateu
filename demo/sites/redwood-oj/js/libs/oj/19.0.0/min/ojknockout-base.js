/**
 * @license
 * Copyright (c) 2014, 2025, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["exports","knockout","ojs/ojkoshared","ojs/ojcore","ojs/ojcustomelement-registry","ojs/ojdomutils","ojs/ojlogger","ojs/ojcustomelement-utils","ojs/ojmonitoring","ojs/ojbindpropagation","ojs/ojkeysetimpl","ojs/ojcontext","ojs/ojtemplateengine-ko","ojs/ojcore-base","ojs/ojknockouttemplateutils","ojs/ojresponsiveknockoututils"],function(e,t,n,i,r,s,o,a,d,l,u,h,c,p,f,g){"use strict";n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i,u=u&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u,h=h&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h,c=c&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c,p=p&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p,t.bindingHandlers._ojBindIf_V2_={init:function(e,n,i,r,s){let o,a;return t.computed(function(){const i=t.utils.unwrapObservable(n()),r=i?.ojDoNotUseProcessed,d=!!r&&i.nodes,l=r?!!t.utils.unwrapObservable(i.test):!!i,u=!a&&!d;if(l===o)return;let h;d?h=i.nodes:(u&&t.computedContext.getDependenciesCount()&&(a=t.utils.cloneNodes(t.virtualElements.childNodes(e),!0)),h=a),l?(u||t.virtualElements.setDomNodeChildren(e,t.utils.cloneNodes(h)),t.applyBindingsToDescendants(s,e)):t.virtualElements.emptyNode(e),o=l},null,{disposeWhenNodeIsRemoved:e}),{controlsDescendantBindings:!0}}},t.virtualElements.allowedBindings._ojBindIf_V2_=!0,n.addPostprocessor({nodeHasBindings:function(e,t){return i.BaseCustomElementBridge?t||1===e.nodeType&&r.isElementRegistered(e.nodeName):t},getBindingAccessors:function(e,t,n){if(1===e.nodeType){var i=e.nodeName;r.isElementRegistered(i)&&((n=n||{})._ojCustomElement=function(){const e=r.isComposite(i),t=r.isVComponent(i);return{skipThrottling:e||t}})}return n}});const m=function(e,t){this.Init&&this.Init(e,t)};var v,y,_;i.Object.createSubclass(m,i.Object,"oj.ComponentBinding"),i._registerLegacyNamespaceProp("ComponentBinding",m),m.deliverChanges=function(){n.getGlobalChangeQueue().deliverChanges()},m.__cloneIfArray=function(e){return Array.isArray(e)&&(e=e.slice()),e},m.__getKnockoutVersion=function(){return t.version},v="cleanExternalData",y=t.utils.domNodeDisposal,_=y[v],y[v]=function(e){var t=s?s.setInKoCleanExternal:null;t&&t(e);try{_(e)}finally{t&&t(null)}};const b=function(e,t){this.Init(e,t)};i.Object.createSubclass(b,i.Object,"ComponentBinding.ComponentChangeTracker"),b.prototype.Init=function(e,t){b.superclass.Init.call(this),this._updateCallback=e,this._queue=t,this._changes={},this._suspendCountMap={}},b.prototype.addChange=function(e,t){this._isSuspended(e)||this._disposed||(this._changes[e]=t,this._queue.registerComponentChanges(this))},b.prototype.dispose=function(){this._disposed=!0},b.prototype.resume=function(e){var t=this._suspendCountMap[e]||0;(t-=1)<0?o.error("ComponentChangeTracker suspendCount underflow"):0===t?delete this._suspendCountMap[e]:this._suspendCountMap[e]=t},b.prototype.suspend=function(e){var t=this._suspendCountMap[e]||0;this._suspendCountMap[e]=t+1},b.prototype.applyChanges=function(e){this._disposed||this._updateCallback(e)},b.prototype.flushChanges=function(){var e=this._changes;return this._changes={},e},b.prototype._isSuspended=function(e){return(this._suspendCountMap[e]||0)>=1};const C={};var E,D;i._registerLegacyNamespaceProp("__ExpressionUtils",C),E=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,D="_ko_property_writers",C.getPropertyWriterExpression=function(e){if(null==e||["true","false","null","undefined"].indexOf(e)>=0)return null;var t=(e=e.trim()).match(E);if(null===t)return null;var n=t[1]?"Object("+t[1]+")"+t[2]:e;return"{"+D+": function(v){"+n+"=v;}}"},C.getWriter=function(e){return e[D]};const N=function(e,i,s){var l=function(){if(s)return null;return new b(function(t){for(var n=Object.keys(t),i=0;i<n.length;i++){y(n[i])}try{e.setProperties(t)}finally{for(var r=0;r<n.length;r++){_(n[r])}}},n.getGlobalChangeQueue())}(),u={},h={},c={},p={},f="Changed";function g(e){return e.$current||e.$data}function v(t,n,i){var s=u[n];if(s||(s=function(e){var t,n=g(e),i=function(i){t&&t(i,n,e)};return i.setListener=function(e){t=e},i}(t),u[n]=s,e.addEventListener(n,s)),!(null==i||i instanceof Function)){var o=a.AttributeUtils.eventTypeToEventListenerProperty(n),d=`Invalid type '${typeof i}' found for attribute '${a.AttributeUtils.propertyNameToAttribute(o)}'. Expected value of type 'function'."`;if(r.isElementRegistered(e.tagName)){a.CustomElementUtils.getElementState(e).rejectBindingProvider(d)}throw new a.JetElementError(e,d)}s.setListener(i)}function y(e){var t=p[e]||0;t+=1,p[e]=t}function _(e){var t=p[e];t?(t-=1,p[e]=0===t?null:t):o.error("Property count undefrlow")}this.setupPropertyBinding=function(r,s,u,b,E){if(!u)return;var D=function(e,t){var n=e.split("."),i=t;n.shift();for(var r=0;r<n.length&&(i=i.properties);r++)i=i[n[r]];return i}(s,u);if(!D)return;var N=h[s];N&&(N.dispose(),h[s]=null);var A=c[s];if(A&&(e.removeEventListener(s+f,A),c[s]=null),u._domListener){var P=a.AttributeUtils.eventListenerPropertyToEventType(s);v(i,P,null)}let B,x,j;if(void 0===r){let e;E?i.$provided&&(e=i.$provided.get(E)):e=null,e&&(B=()=>t.unwrap(e))}else{const e=a.AttributeUtils.getExpressionInfo(r);x=e.expr,x&&(B=n.createEvaluator(x,i),j=e.downstreamOnly)}if(B){if(!u.readOnly){var w=!0;t.ignoreDependencies(function(){h[s]=t.computed(function(){var n,r,o,d=B(i),h=t.utils.unwrapObservable(d);if(u._domListener){var c=a.AttributeUtils.eventListenerPropertyToEventType(s);v(i,c,h)}else Array.isArray(h)&&(h=h.slice()),u._eventListener&&h&&h instanceof Function&&(r=h,o=g(n=i),h=function(e){r(e,o,n)}),!w&&l?l.addChange(s,h):function(t,n){y(t);try{e.setProperty(t,n)}catch(t){throw a.CustomElementUtils.getElementState(e).rejectBindingProvider(t),t}finally{_(t)}}(s,h),w&&b&&b(h)})}),w=!1}void 0!==x&&u.writeback&&!j&&(c[s]=function(r,s,a){var l=r.split("."),u=l[0],h=function(e){if(!function(e){return p[e]}(u)&&function(e,t){if(!e.subproperty)return!0;const n=e.subproperty.path.split("."),i=t.split("."),r=Math.min(i.length,n.length);for(let e=0;e<r;e++)if(i[e]!==n[e])return!1;return!0}(e.detail,r)){let u,h;t.ignoreDependencies(function(){for(var c=e.detail.value,p=1;p<l.length;p++){c=c[l[p]]}var f=a(i);if(t.isObservable(f))t.isWriteableObservable(f)?h=f:u="the observable is not writeable";else{var g=C.getPropertyWriterExpression(s);if(null!=g){const e=n.createEvaluator(g,i);h=C.getWriter(e(i))}else u="the expression is not a valid update target"}h?d.performMonitoredWriteback(r,h,e,m.__cloneIfArray(c)):u&&o.info("The expression '%s' for property '%s' was not updated because %s.",s,r,u)})}};return e.addEventListener(u+f,h),h}(s,x,B))}},this.teardown=function(){var t,n=Object.keys(h);for(t=0;t<n.length;t++){var i=h[n[t]];i&&i.dispose()}for(h={},n=Object.keys(c),t=0;t<n.length;t++){var r=n[t].split(".")[0];e.removeEventListener(r+f,c[r])}for(c={},n=Object.keys(u),t=0;t<n.length;t++){var s=n[t];e.removeEventListener(s,u[s])}u={},l&&l.dispose()}},A=function(){this._resolveWhenChildrenBindingsApplied=function(e,t){var n=this._getChildrenBindingsAppliedPromises(e);if("none"===t||0===n.length)a.CustomElementUtils.getElementState(e).resolveBindingProvider(this);else{for(var i=[];n.length>0;){var r=n.shift();("nearestCustomElement"===t||"immediate"===t&&!0===r.immediate)&&i.push(r.promiseCallback)}Promise.all(i).then(function(){this._resolveWhenChildrenBindingsApplied(e,t)}.bind(this))}},this._getChildrenBindingsAppliedPromises=function(e,t){return!e._whenChildrenBindingsApplied&&t&&Object.defineProperty(e,"_whenChildrenBindingsApplied",{value:[],enumerable:!1}),e._whenChildrenBindingsApplied||[]},this.__RegisterBindingAppliedPromiseForChildren=function(e,t){var n=null;if(e){var i=new Promise(function(e){n=e});this._getChildrenBindingsAppliedPromises(e,!0),e._whenChildrenBindingsApplied.push({immediate:t,promiseCallback:i})}return n},this.__NotifyBindingsApplied=function(e){var t=a.CustomElementUtils.getElementState(e).getTrackChildrenOption();this._resolveWhenChildrenBindingsApplied(e,t)},this.__NotifyBindingsDisposed=function(e){a.CustomElementUtils.getElementState(e).disposeBindingProvider(e)},this.__GetThrottlePromise=function(){return n.getGlobalChangeQueue().getThrottlePromise()},this.__ExtendBindingContext=function(e,t,i,r,s){return n.extendBindingContext(e,t,i,r,s)},this.__ContextFor=function(e){return e.__ojBindingContext?e.__ojBindingContext:t.contextFor(e)},this.__UnwrapObservable=function(e){return t.utils.unwrapObservable(e)},this.__IsObservable=function(e){return t.isObservable(e)},this.__KoComputed=function(e,n,i){return t.computed(e,n,i)},this.__KoIsInitial=function(){return t.computedContext.isInitial()},this.__CleanNode=function(e){t.cleanNode(e)}};A.getInstance=function(){return A._instance},A._instance=new A,oj._registerLegacyNamespaceProp("_KnockoutBindingProvider",A),function(){t.bindingHandlers._ojCustomElement={after:["attr"],init:function(d,u,h,c,p){var f,g;!p||!p.$provided||p.$provided instanceof Map||(p.$provided=new Map(Object.entries(p.$provided)));const m=r.getMetadata(d.tagName),v=m.properties||{},{provide:y,consume:_,cleanup:b}=function(e,t){const r=new Map,d=new Map,u=Object.create(null),h=l.getPropagationMetadataViaCache(e.localName,t);if(null!==h){const c=t.properties||{};for(const[t,[p,f]]of h){if(void 0!==p){const d=[],h=[];if(t===l.STATIC_PROPAGATION?p.forEach(e=>{r.set(e.name,e)}):p.forEach(e=>{const t=e.name;if(void 0===t)throw new Error("name attribute for the binding/provide metadata is required!");const n=e.default,i=s(e.transform,n);d.push(i),h.push({name:t,obs:i})}),h.length>0){const s=o(d);r.set(t,{set:s,vars:h});const l=i(s),p=t+n;e.addEventListener(p,l),u[p]=l;const f=a.AttributeUtils.propertyNameToAttribute(t);if(e.hasAttribute(f)){const n=e.getAttribute(f);a.AttributeUtils.getExpressionInfo(n).expr||s(a.AttributeUtils.attributeToPropertyValue(e,f,n,c[t]))}}}if(void 0!==f)if(t===l.CONSUMED_CONTEXT)d.set(t,f);else{const e=f.name;if(void 0===e)throw new Error("'name' property on the binding/consume metadata is required!");d.set(t,e)}}}function c(){Object.keys(u).forEach(t=>e.removeEventListener(t,u[t]))}return{provide:r,consume:d,cleanup:c}}(d,m);function C(){f&&(f.teardown(),f=null),g&&(d.removeEventListener(e,g),g=null),A.getInstance().__NotifyBindingsDisposed(d)}t.computed(function(){var n=u().skipThrottling;const i=t.computedContext.isInitial();i||C(),function(n,i){f=new N(d,p,n);var r={_domListener:!0};a.CustomElementUtils.getElementState(d).beginApplyingBindings();for(var s=d.attributes,o=0;o<s.length;o++){var u=s[o],h=a.AttributeUtils.attributeToPropertyName(u.nodeName);let e,t;const n=a.AttributeUtils.isEventListenerProperty(h)&&!v[h];if(!n){t=h.split(".")[0];const n=y.get(t);e=i&&n?n.set:void 0}f.setupPropertyBinding(u.value,h,n?r:v[t],e)}_.forEach((e,n)=>{if("string"!=typeof n||d.hasAttribute(a.AttributeUtils.propertyNameToAttribute(n))){if(n===l.CONSUMED_CONTEXT){const n=p.$provided,i=new Map;e.forEach(e=>{n&&n.has(e)&&i.set(e,t.unwrap(n.get(e)))}),d.setProperty("__oj_private_contexts",i)}}else{const t=y.get(n),r=i&&t?t.set:void 0;f.setupPropertyBinding(void 0,n,v[n],r,e)}}),g=function(e){var t=e.detail,n=t.attribute,i=a.AttributeUtils.attributeToPropertyName(n),s=a.AttributeUtils.isEventListenerProperty(i)&&!v[i]?r:v[i.split(".")[0]];f.setupPropertyBinding(t.value,i,s,void 0,_.get(i))},d.addEventListener(e,g)}(n,i)},null,{disposeWhenNodeIsRemoved:d}),t.utils.domNodeDisposal.addDisposeCallback(d,function(){C(),b()});const E=function(e,t){if(0===t.size)return e;const n=e.$provided,i=new Map(n);return t.forEach(e=>{if(e.vars){e.vars.forEach(e=>{const t=e.obs;i.set(e.name,t)})}else i.set(e.name,e.default)}),e.extend({$provided:i})}(p,y);return t.applyBindingsToDescendants(E,d),A.getInstance().__NotifyBindingsApplied(d),{controlsDescendantBindings:!0}}};const e="attribute-changed",n="Changed";function i(e){return t=>e(t.detail.value)}function s(e,n){const i=t.observable(n);return e?t.pureComputed({write:t=>i(e.hasOwnProperty(t)?e[t]:t),read:()=>i()}):i}function o(e){return t=>e.forEach(e=>e(t))}}(),function(){var e="_ojbindingsobj";function i(e,t,n,i){var r=a.KoBindingUtils.getExpressionForAttr(e,n,i);if(!r)return;return s(e,t,"ko "+("if"===t?"_ojBindIf_V2_":t)+":"+r)}function s(e,t,n){var i=e.tagName.toLowerCase(),r=a.KoBindingUtils.getNodeReplacementCommentStr(e),s=e.parentNode,o=document.createComment(r),d=document.createComment("/"+i);s.insertBefore(o,e),e[a.OJ_BIND_CONVERTED_NODE]=o;var l=document.createComment(n),u=document.createComment("/ko");s.insertBefore(l,e);var h,c=[o,l];if("if"===t)for(;e.childNodes.length>0;)h=e.childNodes[0],s.insertBefore(h,e),c.push(h);else if("_ojBindForEach_"===t)for(;e.childNodes.length>0;)h=e.childNodes[0],s.insertBefore(h,e),c.push(h);return s.insertBefore(u,e),c.push(u),s.replaceChild(d,e),c.push(d),c}function o(e,i,r,s){var o,d=a.AttributeUtils.getExpressionInfo(r).expr;if(null==d){var l=a.AttributeUtils.coerceValue(i,"class",r,"any");o=function(){return Array.isArray(l)?l.join(" "):l}}else{var u=n.createEvaluator(d,s).bind(null,s);o=t.pureComputed(function(){var e=t.unwrap(u());return Array.isArray(e)?e.join(" "):e})}e.css=o}function d(e,t,i,r,s){var o=a.AttributeUtils.getExpressionInfo(i).expr;return null==o?function(){return"object"===s?a.AttributeUtils.coerceValue(e,t,i,s):i}:n.createEvaluator(o,r).bind(null,r)}function l(e){return function(){for(var t={},n=Object.keys(e),i=0;i<n.length;i++){var r=n[i];t[r]=e[r]()}return t}}function u(t){if(1!==t.nodeType)return{};if(!t[e]){for(var n={},i=[],s=[],o=[],a=t.attributes,d=0;d<a.length;d++){var l=a[d],u=h(l.name);u&&("style"===u?n._STYLE_BIND=u:"style."===u.substring(0,6)?s.push(u):i.push(u)),r.isElementRegistered(t.nodeName)||"on-"!==l.name.substring(0,3)||o.push(l)}if(s.length){if(n._STYLE_BIND)throw new Error("Cannot have both style and style.* data bound attributes on "+t.tagName+" with id "+t.id);n._STYLE_BIND=s}i.length&&(n._ATTR_BIND=i),o.length&&(n._EVENT_BIND=o),Object.defineProperty(t,e,{value:n})}return t[e]}function h(e){return e&&":"===e.charAt(0)?e.slice(1):null}function c(e){return":"+e}n.registerPreprocessor("oj-bind-text",function(e){return i(e,"text","value",!0)}),n.registerPreprocessor("oj-bind-if",function(e){return i(e,"if","test",!1)}),n.registerPreprocessor("oj-bind-for-each",function(e){const t=a.KoBindingUtils.createBindForEachHandlerStr(e);if(!t)return;return s(e,"_ojBindForEach_",t)}),n.addPostprocessor({nodeHasBindings:function(e,t){var n=u(e);return t||null!=n._ATTR_BIND||null!=n._STYLE_BIND||null!=n._EVENT_BIND},getBindingAccessors:function(e,n,i){if(1===e.nodeType){i=i||{};var r,s,h=u(e),p=h._STYLE_BIND;if(p){if(i.style)throw new Error("Cannot have both style data-bind and JET style binding on "+e.tagName+" with id "+e.id);if("style"===p)i[p]=d(e,p,e.getAttribute(c(p)),n,"object");else{var f={};for(r=0;r<p.length;r++){s=p[r],f[a.AttributeUtils.attributeToPropertyName(s.substring(6))]=d(e,s,e.getAttribute(c(s)),n,"string")}i.style=l(f)}}var g=h._ATTR_BIND;if(g){if(i.attr)throw new Error("Cannot have both attr data-bind and JET attribute binding on "+e.tagName+" with id "+e.id);var m={};for(r=0;r<g.length;r++)"class"===(s=g[r])?o(i,e,e.getAttribute(c(s)),n):m[s]=d(e,s,e.getAttribute(c(s)),n,"string");i.attr=l(m)}var v=h._EVENT_BIND;if(v){var y=new N(e,n,!0);for(r=0;r<v.length;r++){var _=v[r],b=a.AttributeUtils.attributeToPropertyName(_.nodeName);y.setupPropertyBinding(_.value,b,{_domListener:!0})}t.utils.domNodeDisposal.addDisposeCallback(e,function(){y&&(y.teardown(),y=null)})}}return i}})}(),
/**
   * @license
   * Copyright (c) 2014, 2025, Oracle and/or its affiliates.
   * Licensed under The Universal Permissive License (UPL), Version 1.0
   * as shown at https://oss.oracle.com/licenses/upl/
   *
   * @license
   * Knockout Fast Foreach v0.6.0 (2016-07-28T11:02:54.197Z)
   * By: Brian M Hunt (C) 2015 | License: MIT
   *
   * Adds `fastForEach` to `ko.bindingHandlers`.
   *
   * Modification notice: The code is obtained from https://github.com/brianmhunt/knockout-fast-foreach
   * and modified by Oracle JET team to be included into Oracle JET project.
   * @ignore
   */
function(){var e=document&&"function"==typeof document.createDocumentFragment;function n(e,t,n){return{status:"added",value:e,index:t,key:n}}function i(e){return{status:"deleted",value:{},index:e}}function r(e,t){var n;if(e){var i=e.length;n=new Array(i);for(var r=0;r<i;r++)n[r]=t(e[r],r,e)}return n}var s=function(e,n,i){if(Array.isArray(n)){var r=document.createDocumentFragment();for(let e=0,t=n.length;e!==t;++e)r.appendChild(n[e]);if(t.virtualElements.insertAfter(e,r,i),p.Components)for(let e=0,t=n.length;e!==t;++e)p.Components.subtreeAttached(n[e])}else t.virtualElements.insertAfter(e,n,i),p.Components&&p.Components.subtreeAttached(n)},d="_ko_ffe_pending_delete_index",l="oj-bind-for-each: abandoned promise";function f(e,i,s){this.element=i.element||e,t.applyBindingsToDescendants(s,this.element),function(e){for(var n,i,r=t.virtualElements.childNodes(e),s=0;s<r.length;s++){var o=r[s];if(1===o.nodeType&&"template"===o.nodeName.toLowerCase()){var d=a.CustomElementUtils.getSlotAssignment(o);if(n||d&&""!==d){if(i||"noData"!==d){var l;switch(d){case"":l="Multiple default templates found: oj-bind-for-each requires a single default template element as its direct child";break;case"noData":l="Multiple noData templates found: oj-bind-for-each requires a single noData template element as its direct child";break;default:l="Unknown template slot detected - "+d+": oj-bind-for-each supports a single default template and a single noData template"}throw new Error(l)}i=o}else n=o}}if(!n)throw new Error("Default template not found: oj-bind-for-each requires a single default template element as its direct child");e._templateNode=n,e._noDataTemplateNode=i}(this.element),this.element._templateNode.__ojBindingContext=t.contextFor(this.element._templateNode),this.data=i.data,this.as=i.as,this.changeQueue=[],this.firstLastNodesList=[],this.indexesToDelete=[],this.rendering_queued=!1,this.pendingDeletes=[],this.headDataPromise=null,this.tailDataPromise=null,t.virtualElements.emptyNode(this.element),this._initChildrenBindingsAppliedPromise();var o=t.unwrap(this.data);o.fetchFirst?(this.currentDataProvider=o,this.fetchData()):this.onArrayChange(r(o,n)),this.addSubscriptions()}f.PENDING_DELETE_INDEX_KEY=d,f.prototype.addSubscriptions=function(){var e=t.isObservable(this.data);this.currentDataProvider?(this.dataMutateHandler=this.handleDataMutateEvent.bind(this),this.dataRefreshHandler=this.handleDataRefreshEvent.bind(this),this.currentDataProvider.addEventListener("mutate",this.dataMutateHandler),this.currentDataProvider.addEventListener("refresh",this.dataRefreshHandler),e&&(this.changeSubs=this.data.subscribe(this.onDataChange,this,"change"))):e&&(this.data.indexOf||(this.data=this.data.extend({trackArrayChanges:!0})),this.changeArraySubs=this.data.subscribe(this.onArrayDataChange,this,"arrayChange"),this.changeSubs=this.data.subscribe(this.onDataChange,this,"change"))},f.prototype.removeSubscriptions=function(){this.changeSubs&&this.changeSubs.dispose(),this.changeArraySubs&&this.changeArraySubs.dispose(),this.currentDataProvider&&(this.currentDataProvider.removeEventListener("mutate",this.dataMutateHandler),this.currentDataProvider.removeEventListener("refresh",this.dataRefreshHandler))},f.prototype.onArrayDataChange=function(e){this.arrayChangeSet=e},f.prototype.onDataChange=function(e){this.arrayChangeSet?(this.onArrayChange(this.arrayChangeSet),this.arrayChangeSet=null):(this.setData({data:this.data,dataProvider:e.fetchFirst?e:null}),this.recreateContent(e))},f.prototype.recreateContent=function(e){this.changeQueue=[],this.firstLastNodesList=[],this.indexesToDelete=[],this.rendering_queued=!1,this.pendingDeletes=[],this._noDataNodes=null,t.virtualElements.emptyNode(this.element),e.fetchFirst?this.fetchData():this.onArrayChange(r(e,n))},f.prototype.registerBusyState=function(){var e=this.element.parentNode;return h.getContext(e).getBusyContext().addBusyState({description:"oj-bind-for-each binding on a node with the Id "+e.id+"is loading data."})},f.prototype._initChildrenBindingsAppliedPromise=function(){var e=this.element._templateNode.__ojBindingContext.$current,t=e?{_nearestCustomParent:e._nearestCustomParent,_immediate:e._immediate}:null,n=function(e,t){for(var n=e.parentNode;n&&!a.ElementUtils.isValidCustomElementName(n.localName);)n=n.parentNode;return n||(n=t?t._nearestCustomParent:null),n}(this.element,t),i=function(e,t,n){var i=!1,r=!!n;return e.parentNode===t?i=!0:r&&!e.parentNode.parentNode&&(i=n._immediate),i}(this.element,n,t);this.trackingContext={_nearestCustomParent:n,_immediate:i},this._childrenBindingsPromiseResolver=A.getInstance().__RegisterBindingAppliedPromiseForChildren(n,i)},f.prototype._resolveChildrenBindingsAppliedPromise=function(){this._childrenBindingsPromiseResolver&&(this._childrenBindingsPromiseResolver(),this._childrenBindingsPromiseResolver=null)},f.prototype.resetChainIfCompleted=function(e){e===this.tailDataPromise&&(this.headDataPromise=null,this.tailDataPromise=null)},f.prototype.promiseRejectHelper=function(e,t,n){if(t(),this.resetChainIfCompleted(n),!e._CAUGHT_PROMISE_REJECTION&&e.message!==l){if(e instanceof Error)throw e._CAUGHT_PROMISE_REJECTION=!0,e;throw new Error(e)}o.info(e)},f.prototype.fetchData=function(){var e,t,i,r=this.registerBusyState(),s=this.currentDataProvider.fetchFirst({size:-1})[Symbol.asyncIterator](),o=function(a,d,u){return function(h){if(u.headDataPromise===i){for(var c=h.value,p=a.length,f=0;f<c.metadata.length&&f<c.data.length;f++)a.push(n(c.data[f],p,c.metadata[f].key)),p+=1;h.done?(d.call(u,a),r(),e(),u.resetChainIfCompleted(i)):s.next().then(o(a,d,u),function(e){r(),t(e),u.resetChainIfCompleted(i)})}else r(),t(new Error(l))}};(i=new Promise(function(n,a){e=n,t=a,s.next().then(o([],this.onArrayChange,this),function(e){r(),t(e),this.resetChainIfCompleted(i)}.bind(this))}.bind(this))).catch(function(e){if(e.message!==l){if(e instanceof Error)throw e._CAUGHT_PROMISE_REJECTION=!0,e;throw new Error(e)}}),this.headDataPromise=i,this.tailDataPromise=i},f.prototype.getIndexesForEvent=function(e,t){var n,i=[];if(Array.isArray(e))for(n=0;n<e.length;n++)i.push(e[n]);else if(t){var r=Array.isArray(t)?t.length:t.size,s=new u(t),o=new Map,a=0;for(n=0;n<this.firstLastNodesList.length&&a<r;n++){var d=this.firstLastNodesList[n].key,l=s.get(d);l!==s.NOT_A_KEY&&(o.set(l,n),a+=1)}t.forEach(function(e){i.push(o.get(e))})}return i},f.prototype.handleDataMutateEvent=function(e){var t,n,i={},r=this;this.tailDataPromise?(t=this.registerBusyState(),(n=this.tailDataPromise.then(function(){return t(),r.getDataMutationHelper(e,i)})).catch(function(e){r.promiseRejectHelper(e,t,n)})):(n=this.getDataMutationHelper(e,i),this.headDataPromise=n),this.tailDataPromise=n,i.head=this.headDataPromise,i.current=n},f.prototype.getDataMutationHelper=function(e,t){var r,s,o=e.detail.add,a=e.detail.remove,d=e.detail.update,u=o&&o.data,h=d&&d.data,c=()=>{if(h){var e=0,t=[],r=this.getIndexesForEvent(d.indexes,d.keys);d.keys.forEach(function(s){if(void 0!==r[e]){var o=h[e];t.push(i(r[e])),t.push(n(o,r[e],s))}e+=1}),this.onArrayChange(t)}},p=()=>{if(a){var e=this.getIndexesForEvent(a.indexes,a.keys);e=e.filter(function(e){return void 0!==e}),this.onArrayChange(e.map(i))}},f=()=>{if(u){var e=this.getIndexesForEvent(o.indexes,o.addBeforeKeys?o.addBeforeKeys:o.afterKeys),t=[],i=0;o.keys.forEach(function(r){var s=u[i];t.push(n(s,function(t){var n=e.length>t?e[t]:this.firstLastNodesList.length+t;return void 0===n?this.firstLastNodesList.length:n}(i),r)),i+=1},this),this.onArrayChange(t)}};if(d&&!Array.isArray(h)||o&&!Array.isArray(u)){var g=d&&!Array.isArray(h)?this.currentDataProvider.fetchByKeys({keys:d.keys}):Promise.resolve(),m=o&&!Array.isArray(u)?this.currentDataProvider.fetchByKeys({keys:o.keys}):Promise.resolve();r=this.registerBusyState(),(s=Promise.all([g,m]).then(e=>{if(t.head!==this.headDataPromise)throw r(),new Error(l);var n=e[0];n&&n.results.size>0&&(h=[...d.keys].map(e=>n.results.get(e).data)),c(),p();var i=e[1];i&&i.results.size>0&&(u=[...o.keys].map(e=>i.results.get(e).data)),f(),r(),this.resetChainIfCompleted(t.current)})).catch(e=>{this.promiseRejectHelper(e,r,t.current)})}else c(),p(),f();return s},f.prototype.handleDataRefreshEvent=function(){this.recreateContent(this.currentDataProvider)},f.prototype._addNoData=function(){0===this.firstLastNodesList.length&&this.element._noDataTemplateNode&&(this._noDataNodes=c.execute(this.element,this.element._noDataTemplateNode,{},null),this.insertAllAfter(this._noDataNodes))},f.prototype._removeNoData=function(){this._noDataNodes&&(this._noDataNodes.forEach(e=>{c.clean(e,this.element),e.parentNode.removeChild(e)}),this._noDataNodes=null)},f.prototype.onArrayChange=function(e){this._removeNoData();for(var t={added:[],deleted:[]},n="added",i="deleted",r=0,s=e.length;r<s;r++)if(t[n].length&&e[r].status===n){var o=t[n][t[n].length-1];(o.isBatch?o.index+o.values.length-1:o.index)+1===e[r].index?(o.isBatch||(o={isBatch:!0,status:n,index:o.index,values:[o.value],keys:[o.key]},t[n].splice(t[n].length-1,1,o)),o.values.push(e[r].value),o.keys.push(e[r].key)):t[e[r].status].push(e[r])}else t[e[r].status].push(e[r]);t[i].length>0&&(this.changeQueue.push.apply(this.changeQueue,t[i]),this.changeQueue.push({status:"clearDeletedIndexes"})),this.changeQueue.push.apply(this.changeQueue,t[n]),this.changeQueue.length>0&&!this.rendering_queued&&(this.rendering_queued=!0,this.processQueue()),this._addNoData(),this._resolveChildrenBindingsAppliedPromise()},f.prototype.processQueue=function(){var e=this,n=9007199254740991;t.utils.arrayForEach(this.changeQueue,function(t){"number"==typeof t.index&&(n=Math.min(n,t.index)),e[t.status](t)}),this.flushPendingDeletes(),this.rendering_queued=!1,this.updateIndexes(n),this.changeQueue=[]},f.prototype.added=function(e){for(var n=e.index,i=e.isBatch?e.values:[e.value],r=e.isBatch?e.keys:[e.key],s=this.getLastNodeBeforeIndex(n),o=[],a=0,d=i.length;a<d;++a){var l,u,h=this.getPendingDeleteFor(i[a]);h&&h.nodesets.length?(l=h.nodesets.pop(),u=h.currentChildContext):(u={data:i[a],index:n+a,observableIndex:t.observable()},Object.defineProperties(u,{_nearestCustomParent:{value:this.trackingContext._nearestCustomParent,enumerable:!1},_immediate:{value:this.trackingContext._immediate,enumerable:!1}}),l=c.execute(this.element,this.element._templateNode,u,this.as)),o.push.apply(o,Array.prototype.slice.call(l)),this.firstLastNodesList.splice(n+a,0,{first:l[0],last:l[l.length-1],key:r?r[a]:null,currentChildContext:u})}this.insertAllAfter(o,s)},f.prototype.getNodesForIndex=function(e){var t=[],n=this.firstLastNodesList[e].first,i=this.firstLastNodesList[e].last;for(t.push(n);n&&n!==i;)n=n.nextSibling,t.push(n);return t},f.prototype.getLastNodeBeforeIndex=function(e){return e<1||e-1>=this.firstLastNodesList.length?null:this.firstLastNodesList[e-1].last},f.prototype.insertAllAfter=function(t,n){var i,r=this.element;if(1===t.length)s(r,t[0],n);else if(e)s(r,t,n);else for(i=t.length-1;i>=0;--i){var o=t[i];if(!o)break;s(r,o,n)}return t},f.prototype.shouldDelayDeletion=function(e){return e&&("object"==typeof e||"function"==typeof e)},f.prototype.getPendingDeleteFor=function(e){var t=e&&e[d];return void 0===t?null:this.pendingDeletes[t]},f.prototype.getOrCreatePendingDeleteFor=function(e){var t=this.getPendingDeleteFor(e);return t||(t={data:e,nodesets:[]},e[d]=this.pendingDeletes.length,this.pendingDeletes.push(t),t)},f.prototype.deleted=function(e){if(this.shouldDelayDeletion(e.value)){var t=this.getOrCreatePendingDeleteFor(e.value);t.nodesets.push(this.getNodesForIndex(e.index)),t.currentChildContext=this.firstLastNodesList[e.index].currentChildContext}else this.removeNodes(this.getNodesForIndex(e.index));this.indexesToDelete.push(e.index)},f.prototype.removeNodes=function(e){if(e.length){(()=>{for(var t=e[0].parentNode,n=e.length-1;n>=0;--n)c.clean(e[n],this.element),t.removeChild(e[n])})()}},f.prototype.flushPendingDeletes=function(){for(var e=0,t=this.pendingDeletes.length;e!==t;++e){for(var n=this.pendingDeletes[e];n.nodesets.length;)this.removeNodes(n.nodesets.pop());n.data&&void 0!==n.data[d]&&delete n.data[d]}this.pendingDeletes=[]},f.prototype.clearDeletedIndexes=function(){for(var e=this.indexesToDelete.length-1;e>=0;--e)this.firstLastNodesList.splice(this.indexesToDelete[e],1);this.indexesToDelete=[]},f.prototype.updateIndexes=function(e){for(var t=e,n=this.firstLastNodesList.length;t<n;++t){var i=this.firstLastNodesList[t].currentChildContext;i&&i.observableIndex&&i.observableIndex(t)}},f.prototype.getData=function(){return{data:this.data,dataProvider:this.currentDataProvider}},f.prototype.setData=function(e){this.removeSubscriptions(),this.data=e.data,this.currentDataProvider=e.dataProvider,this.addSubscriptions()},t.bindingHandlers._ojBindForEach_={init:function(e,n,i,r,s){var o,a;return t.computed(function(){if(a=n(),o){var e,i,r=a.data,s=o.getData().data;if(t.ignoreDependencies(function(){e=t.unwrap(s),i=t.unwrap(r)}),o.setData({data:r,dataProvider:i.fetchFirst?i:null}),Array.isArray(e)&&Array.isArray(i)){var d=t.utils.compareArrays(e,i,{sparse:!0,dontLimitMoves:!0});o.onArrayChange(d)}else o.recreateContent(i)}},null,{disposeWhenNodeIsRemoved:e}),o=new f(e,a,s),t.utils.domNodeDisposal.addDisposeCallback(e,function(){o.removeSubscriptions()}),{controlsDescendantBindings:!0}}},t.virtualElements.allowedBindings._ojBindForEach_=!0}(),i._registerLegacyNamespaceProp("ResponsiveKnockoutUtils",g),i._registerLegacyNamespaceProp("KnockoutTemplateUtils",f),function(){function e(e,t,i){if("test"===t&&!e.hasAttribute(t))throw new Error("Missing the required 'test' attribute on <oj-if>");if(!e.hasAttribute(t))return null;const r=e.getAttribute(t),s=a.AttributeUtils.getExpressionInfo(r);return n.createEvaluator(s.expr?s.expr:r,i)}n.addPostprocessor({nodeHasBindings:function(e,t){return t||1===e.nodeType&&"oj-if"===e.nodeName.toLowerCase()},getBindingAccessors:function(n,i,r){let s=r;if(1===n.nodeType&&"oj-if"===n.localName){const r=e(n,"test",i),o=e(n,"oj-private-do-not-use",i);s=s||{},s._ojBindIf_V2_=()=>{const e=o?t.unwrap(o(i)):null;return e?{test:t.unwrap(r(i)),nodes:e,ojDoNotUseProcessed:!0}:t.unwrap(r(i))},s.style=()=>({display:"contents"})}return s}})}(),
/**
   * @license
   * Copyright (c) 2014, 2025, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * as shown at https://oss.oracle.com/licenses/upl/
   * @ignore
   */
e.ComponentBinding=m,e.ComponentChangeTracker=b,e.__ExpressionUtils=C,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ojknockout-base.js.map