{"version":3,"file":"useRovingTabIndexContainer-b11a404b.js","sources":["../../src/hooks/PRIVATE_useRovingTabIndexContainer/useRovingTabIndexContainer.tsx"],"sourcesContent":["import { useState, useRef } from 'preact/hooks';\nimport { useUser } from '../UNSAFE_useUser';\nimport { getClientHints } from '../../utils/PRIVATE_clientHints';\n\n/**\n * Utility hook for setting up roving tab indexes on children of the consuming parent container\n * For more details: https://www.w3.org/WAI/ARIA/apg/practices/keyboard-interface/#kbd_roving_tabindex\n * @param isDisabled boolean flag to communicate disabled state of consumer\n * @returns id of currently focused element, and props to be spread onto the consuming element\n */\nconst useRovingTabIndexContainer = (isDisabled?: boolean) => {\n  const rootRef = useRef<HTMLDivElement | null>(null);\n  const { direction } = useUser();\n  const isRtl = direction === 'rtl';\n  const [focusedId, setFocusedId] = useState<string | undefined>(undefined);\n  const [isShiftTabbing, setIsShiftTabbing] = useState(false); // shift tabbing is tracked in order to toggle wrapper out of the tab order\n  const clientHints = getClientHints();\n\n  const getRovingItems = () => {\n    return rootRef.current\n      ? Array.from(rootRef.current.querySelectorAll<HTMLElement>('[data-oj-roving-tabindex-item]'))\n      : [];\n  };\n\n  const handleKeyDown = (e: KeyboardEvent) => {\n    if (e.code === 'ArrowRight' || e.code === 'ArrowLeft') {\n      const items = getRovingItems();\n      if (items.length === 0) return;\n      const nextItem = getNextItem(items, e.code, focusedId, isRtl);\n      nextItem.focus();\n    } else if (e.shiftKey && e.code === 'Tab') {\n      setIsShiftTabbing(true);\n    }\n  };\n\n  // In Safari 16 and earlier, clicking on an HTML button element does not trigger a focus(in) event,\n  // and as such our handleFocus logic does not kick in and our focusedId state is never updated.\n  // To work around this, we manually update the focusedId in response to mouse downs. This has been fixed in Safari 17.\n  // This fix can be removed once Safari 18 is released.\n  const handleMouseDown = (e: MouseEvent) => {\n    const rovingItemId = getRovingItemId(e.target as HTMLElement, true);\n    if (rovingItemId) {\n      setFocusedId(rovingItemId);\n    }\n  };\n\n  const handleFocus = (e: FocusEvent) => {\n    if (e.target !== e.currentTarget) {\n      //focus has moved to one of the roving items\n      if (e.target) {\n        setFocusedId(getRovingItemId(e.target as HTMLElement));\n      }\n    } else {\n      //focus has moved to the container, and has to be passed onto the eligble item to receive focus\n      const items = getRovingItems();\n      if (items.length === 0) return;\n      const currentIndex = getCurrentRovingIndex(items, focusedId);\n      items[currentIndex].focus();\n    }\n  };\n\n  const rovingTabIndexContainerProps = {\n    ref: rootRef,\n    onBlur: () => setIsShiftTabbing(false),\n    onFocus: handleFocus,\n    onKeyDown: handleKeyDown,\n    ...(clientHints.browser === 'safari' && { onMouseDown: handleMouseDown }), // mouseDown handler needed for Safari 16\n    tabIndex: isShiftTabbing || isDisabled ? -1 : 0 // tab index is needed on the container in order to pass focus to the first child\n  };\n\n  return { focusedId, rovingTabIndexContainerProps };\n};\n\nconst getRovingItemId = (item: Element, useClosest = false) => {\n  if (useClosest) {\n    const ancestor = item.closest('data-oj-roving-tabindex-item');\n    if (ancestor) {\n      item = ancestor;\n    }\n  }\n\n  return item.getAttribute('data-oj-roving-tabindex-item') || undefined;\n};\n\nconst getCurrentRovingIndex = (items: HTMLElement[], focusedId: string | undefined) => {\n  const currentIndex = items.findIndex((item) => getRovingItemId(item) === focusedId);\n  return currentIndex === -1 ? 0 : currentIndex;\n};\n\nconst getNextItem = (\n  items: HTMLElement[],\n  eventCode: string,\n  focusedId: string | undefined,\n  isRtl: boolean\n) => {\n  const currentIndex = getCurrentRovingIndex(items, focusedId);\n  let nextIndex = -1;\n  if ((!isRtl && eventCode === 'ArrowRight') || (isRtl && eventCode === 'ArrowLeft')) {\n    nextIndex = currentIndex === items.length - 1 ? 0 : currentIndex + 1;\n  }\n  if ((!isRtl && eventCode === 'ArrowLeft') || (isRtl && eventCode === 'ArrowRight')) {\n    nextIndex = currentIndex === 0 ? items.length - 1 : currentIndex - 1;\n  }\n  return items[nextIndex];\n};\n\nexport { useRovingTabIndexContainer };\n"],"names":["getRovingItemId","item","useClosest","ancestor","closest","getAttribute","undefined","getCurrentRovingIndex","items","focusedId","currentIndex","findIndex","getNextItem","eventCode","isRtl","nextIndex","length","isDisabled","rootRef","useRef","direction","useUser","setFocusedId","useState","isShiftTabbing","setIsShiftTabbing","clientHints","getClientHints","getRovingItems","current","Array","from","querySelectorAll","rovingTabIndexContainerProps","ref","onBlur","onFocus","e","target","currentTarget","focus","onKeyDown","code","shiftKey","browser","onMouseDown","rovingItemId","tabIndex"],"mappings":"gHAUA,MA+DMA,EAAkB,CAACC,EAAeC,GAAa,KACnD,GAAIA,EAAY,CACd,MAAMC,EAAWF,EAAKG,QAAQ,gCAC1BD,IACFF,EAAOE,EAEV,CAED,OAAOF,EAAKI,aAAa,sCAAmCC,CAAS,EAGjEC,EAAwB,CAACC,EAAsBC,KACnD,MAAMC,EAAeF,EAAMG,WAAWV,GAASD,EAAgBC,KAAUQ,IACzE,OAAyB,IAAlBC,EAAsB,EAAIA,CAAY,EAGzCE,EAAc,CAClBJ,EACAK,EACAJ,EACAK,KAEA,MAAMJ,EAAeH,EAAsBC,EAAOC,GAClD,IAAIM,GAAa,EAOjB,QANMD,GAAuB,eAAdD,GAAgCC,GAAuB,cAAdD,KACtDE,EAAYL,IAAiBF,EAAMQ,OAAS,EAAI,EAAIN,EAAe,KAE/DI,GAAuB,cAAdD,GAA+BC,GAAuB,eAAdD,KACrDE,EAA6B,IAAjBL,EAAqBF,EAAMQ,OAAS,EAAIN,EAAe,GAE9DF,EAAMO,EAAU,+BA7FWE,IAClC,MAAMC,EAAUC,SAA8B,OACxCC,UAAEA,GAAcC,EAAAA,UAChBP,EAAsB,QAAdM,GACPX,EAAWa,GAAgBC,EAAQA,cAAqBjB,IACxDkB,EAAgBC,GAAqBF,EAAQA,UAAC,GAC/CG,EAAcC,EAAAA,iBAEdC,EAAiB,IACdV,EAAQW,QACXC,MAAMC,KAAKb,EAAQW,QAAQG,iBAA8B,mCACzD,GAwCAC,EAA+B,CACnCC,IAAKhB,EACLiB,OAAQ,IAAMV,GAAkB,GAChCW,QAlBmBC,IACnB,GAAIA,EAAEC,SAAWD,EAAEE,cAEbF,EAAEC,QACJhB,EAAatB,EAAgBqC,EAAEC,aAE5B,CAEL,MAAM9B,EAAQoB,IACd,GAAqB,IAAjBpB,EAAMQ,OAAc,OAExBR,EADqBD,EAAsBC,EAAOC,IAC9B+B,OACrB,GAODC,UAzCqBJ,IACrB,GAAe,eAAXA,EAAEK,MAAoC,cAAXL,EAAEK,KAAsB,CACrD,MAAMlC,EAAQoB,IACd,GAAqB,IAAjBpB,EAAMQ,OAAc,OACPJ,EAAYJ,EAAO6B,EAAEK,KAAMjC,EAAWK,GAC9C0B,OACV,MAAUH,EAAEM,UAAuB,QAAXN,EAAEK,MACzBjB,GAAkB,EACnB,KAkC2B,WAAxBC,EAAYkB,SAAwB,CAAEC,YA3BnBR,IACvB,MAAMS,EAAe9C,EAAgBqC,EAAEC,QAAuB,GAC1DQ,GACFxB,EAAawB,EACd,GAwBDC,SAAUvB,GAAkBP,GAAc,EAAI,GAGhD,MAAO,CAAER,YAAWwB,+BAA8B"}