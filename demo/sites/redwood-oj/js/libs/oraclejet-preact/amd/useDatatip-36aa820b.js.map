{"version":3,"file":"useDatatip-36aa820b.js","sources":["../../src/hooks/PRIVATE_useDatatip/useDatatip.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { ComponentChildren } from 'preact';\nimport { Layer } from '#UNSAFE_Layer';\nimport { Floating, Placement } from '#UNSAFE_Floating';\nimport { useRef, useState } from 'preact/hooks';\nimport { styles } from './themes/useDatatip.css';\nimport { useId } from '#hooks/UNSAFE_useId';\nimport { Property } from 'csstype';\nimport { DATATIP_OFFSET } from '#utils/UNSAFE_visUtils/datatipUtils';\nimport { useVisHover } from '#hooks/PRIVATE_useVisHover';\nimport { mergeProps } from '#utils/UNSAFE_mergeProps';\nexport type { Dimension } from '#utils/UNSAFE_visTypes/common';\n\ntype DatatipProps = {\n  /**\n   * The datatip content.\n   */\n  content?: ComponentChildren;\n\n  /**\n   * Whether the datatip is anchored to pointer or element.\n   *\n   */\n  anchor: 'element' | 'pointer';\n\n  /**\n   * The offset from the anchor element or pointer.\n   */\n  offset?: {\n    mainAxis?: number;\n    crossAxis?: number;\n  };\n\n  /**\n   * The border color of the datatip.\n   */\n  borderColor?: Property.BorderColor;\n\n  /**\n   * The placement of datatip from anchor point.\n   */\n  placement?: Placement;\n\n  /**\n   * The touch response value.\n   */\n  touchResponse: 'touchStart' | 'touchHold';\n\n  /**\n   * Whether datatip is disabled\n   */\n  isDisabled?: boolean;\n};\n\n/**\n * The hook to support custom datatip in visualization components.\n */\nexport function useDatatip({\n  content,\n  placement = 'top-end-corner',\n  offset,\n  borderColor,\n  anchor,\n  touchResponse,\n  isDisabled\n}: DatatipProps) {\n  const uniqueIdRef = useRef<string>(useId());\n  const [coords, setCoords] = useState({ x: 0, y: 0 });\n  const offsetValue = offset || { mainAxis: DATATIP_OFFSET, crossAxis: -1 * DATATIP_OFFSET };\n  const [isVisible, setIsVisible] = useState(false);\n\n  const targetRef = useRef<HTMLElement | null>(null);\n  const toggleTimeoutRef = useRef<ReturnType<typeof setTimeout>>();\n\n  const onHover = (event: PointerEvent) => {\n    setCoords({ x: event.clientX, y: event.clientY });\n    setIsVisible(true);\n  };\n\n  const onHoverEnter = (event: PointerEvent, currentTarget: HTMLElement) => {\n    if (\n      event.pointerType === 'touch' ||\n      event.eventPhase === Event.AT_TARGET ||\n      event.eventPhase === Event.BUBBLING_PHASE\n    ) {\n      setCoords({ x: event.clientX, y: event.clientY });\n      targetRef.current = currentTarget;\n      setIsVisible(true);\n    }\n  };\n\n  const onHoverLeave = () => {\n    toggleTimeoutRef.current = setTimeout(() => {\n      setIsVisible(false);\n    }, 20);\n  };\n\n  const hoverHandlers = useVisHover(onHover, onHoverEnter, onHoverLeave, touchResponse);\n\n  const onFocus = (event: FocusEvent) => {\n    if (event.eventPhase === Event.AT_TARGET || event.eventPhase === Event.BUBBLING_PHASE) {\n      targetRef.current = event.target as HTMLElement;\n      setIsVisible(true);\n    }\n  };\n\n  const onBlur = () => {\n    setIsVisible(false);\n  };\n\n  const onContentPointerEnter = () => {\n    clearTimeout(toggleTimeoutRef.current);\n  };\n\n  const onKeyUp = (event: KeyboardEvent) => {\n    if (\n      event.code === 'ArrowUp' ||\n      event.code === 'ArrowDown' ||\n      event.code === 'ArrowRight' ||\n      event.code === 'ArrowLeft' ||\n      event.code === 'Tab'\n    ) {\n      setIsVisible(true);\n    }\n  };\n\n  const onKeyDown = (event: KeyboardEvent) => {\n    if (event.code === 'Escape') {\n      event.preventDefault();\n      setIsVisible(false);\n    }\n  };\n\n  const anchorRef = anchor === 'element' ? targetRef : { current: coords };\n  const datatipContent =\n    isVisible && !!content && !isDisabled ? (\n      <Layer>\n        <Floating\n          anchorRef={anchorRef}\n          placement={placement}\n          offsetValue={offsetValue}\n          flipOptions={{\n            crossAxis: anchor === 'pointer' ? true : false,\n            mainAxis: anchor === 'pointer' ? true : false\n          }}\n          shiftOptions={{ crossAxis: true, mainAxis: true }}>\n          <div\n            role=\"tooltip\"\n            id={uniqueIdRef.current}\n            className={styles.visDatatipStyle}\n            style={{ borderColor }}\n            onPointerEnter={onContentPointerEnter}\n            onPointerLeave={onHoverLeave}>\n            {content}\n          </div>\n        </Floating>\n      </Layer>\n    ) : null;\n\n  return {\n    datatipContent,\n    datatipProps: {\n      'aria-describedby': datatipContent !== null ? uniqueIdRef.current : undefined,\n      ...mergeProps(hoverHandlers, {\n        onKeyUp,\n        onKeyDown,\n        onFocus,\n        onBlur\n      })\n    }\n  };\n}\n"],"names":["content","placement","offset","borderColor","anchor","touchResponse","isDisabled","uniqueIdRef","useRef","useId","coords","setCoords","useState","x","y","offsetValue","mainAxis","DATATIP_OFFSET","crossAxis","isVisible","setIsVisible","targetRef","toggleTimeoutRef","onHoverLeave","current","setTimeout","hoverHandlers","useVisHover","event","clientX","clientY","currentTarget","pointerType","eventPhase","Event","AT_TARGET","BUBBLING_PHASE","anchorRef","datatipContent","_jsx","Layer","children","Floating","flipOptions","shiftOptions","role","id","className","styles","visDatatipStyle","style","onPointerEnter","clearTimeout","onPointerLeave","datatipProps","undefined","mergeProps","onKeyUp","code","onKeyDown","preventDefault","onFocus","target","onBlur"],"mappings":"+VAgE2BA,QACzBA,EAAOC,UACPA,EAAY,iBAAgBC,OAC5BA,EAAMC,YACNA,EAAWC,OACXA,EAAMC,cACNA,EAAaC,WACbA,IAEA,MAAMC,EAAcC,EAAAA,OAAeC,EAAKA,UACjCC,EAAQC,GAAaC,EAAQA,SAAC,CAAEC,EAAG,EAAGC,EAAG,IAC1CC,EAAcb,GAAU,CAAEc,SAAUC,EAAcA,eAAEC,WAAY,EAAID,EAAAA,iBACnEE,EAAWC,GAAgBR,EAAQA,UAAC,GAErCS,EAAYb,SAA2B,MACvCc,EAAmBd,EAAAA,SAmBnBe,EAAe,KACnBD,EAAiBE,QAAUC,YAAW,KACpCL,GAAa,EAAM,GAClB,GAAG,EAGFM,EAAgBC,EAAAA,aAvBLC,IACfjB,EAAU,CAAEE,EAAGe,EAAMC,QAASf,EAAGc,EAAME,UACvCV,GAAa,EAAK,IAGC,CAACQ,EAAqBG,KAEjB,UAAtBH,EAAMI,aACNJ,EAAMK,aAAeC,MAAMC,WAC3BP,EAAMK,aAAeC,MAAME,iBAE3BzB,EAAU,CAAEE,EAAGe,EAAMC,QAASf,EAAGc,EAAME,UACvCT,EAAUG,QAAUO,EACpBX,GAAa,GACd,GASsDG,EAAclB,GAoCjEgC,EAAuB,YAAXjC,EAAuBiB,EAAY,CAAEG,QAASd,GAC1D4B,EACJnB,GAAenB,IAAYM,EACzBiC,EAAAA,IAACC,EAAAA,MACC,CAAAC,SAAAF,EAAAA,IAACG,EAAQA,SAAA,CACPL,UAAWA,EACXpC,UAAWA,EACXc,YAAaA,EACb4B,YAAa,CACXzB,UAAsB,YAAXd,EACXY,SAAqB,YAAXZ,GAEZwC,aAAc,CAAE1B,WAAW,EAAMF,UAAU,GAAMyB,SACjDF,EAAAA,WACEM,KAAK,UACLC,GAAIvC,EAAYiB,QAChBuB,UAAWC,EAAMA,OAACC,gBAClBC,MAAO,CAAE/C,eACTgD,eAzCoB,KAC5BC,aAAa9B,EAAiBE,QAAQ,EAyC9B6B,eAAgB9B,EAAYkB,SAC3BzC,QAIL,KAEN,MAAO,CACLsC,iBACAgB,aAAc,CACZ,mBAAuC,OAAnBhB,EAA0B/B,EAAYiB,aAAU+B,KACjEC,EAAAA,WAAW9B,EAAe,CAC3B+B,QAlDW7B,IAEE,YAAfA,EAAM8B,MACS,cAAf9B,EAAM8B,MACS,eAAf9B,EAAM8B,MACS,cAAf9B,EAAM8B,MACS,QAAf9B,EAAM8B,MAENtC,GAAa,EACd,EA0CGuC,UAvCa/B,IACE,WAAfA,EAAM8B,OACR9B,EAAMgC,iBACNxC,GAAa,GACd,EAoCGyC,QAnEWjC,IACXA,EAAMK,aAAeC,MAAMC,WAAaP,EAAMK,aAAeC,MAAME,iBACrEf,EAAUG,QAAUI,EAAMkC,OAC1B1C,GAAa,GACd,EAgEG2C,OA7DS,KACb3C,GAAa,EAAM,KAgEvB"}