define(['exports', 'preact/jsx-runtime', 'preact', 'preact/compat', 'preact/hooks', './mergeProps-bcfa6a92', './TabbableModeContext-a9c97640', './useTabbableMode-df433329', './keys-4755c121', './collectionUtils-26e6c87c', './useCurrentKey-2f1ca19e', './useCollectionFocusRing-35d278f5', './useTabbableModeSet-290ab1cf', './useSwatchSelection-fd837ce5', './LoadMoreCollection-3ac9e69e', './PRIVATE_BaseSwatchView/themes/BaseSwatchViewStyles.css', './classNames-08d99695', './logger-0f873e29', './tabbableUtils-9101c0e5', './useId-c9578d26', './useResizeObserver-25032462', './FocusTrap-d06ac102', './Flex-4bc3a394'], (function(e,t,r,s,a,o,c,n,i,l,u,d,h,b,f,y,w,g,m,p,x,v,C){"use strict";const E=s.memo((function({children:e,context:r,isTabbable:s,isFocused:o,isFocusRingVisible:n,focusBehavior:i,setIsFocusBehaviorValid:l,updateSwatchSize:u}){const d=a.useRef(null),h=r.metadata.key,b=o&&n,f=y.multiVariantStyles({itemFocused:"swatch"===i&&b?"isItemFocused":"isNotItemFocused",itemInGridLayout:"isNotInGridLayout"}),C=w.classNames([y.styles.itemStyle,f]),E=a.useCallback((e=>{u?.(e.contentRect.width,e.contentRect.height)}),[u]),R=a.useRef(null);x.useResizeObserver(u?d:R,E),a.useLayoutEffect((()=>{if("content"===i&&b){const e=d.current?.firstElementChild?.firstElementChild,t=m.allTabbableElements(e,!0,!0);0===t.length||t.length>1?(g.warn(`${t.length} focusable elements are detected in the swatch. 'content' focusBehavior is intended only for use when the swatch has single focusable element. Please specify one focusable element in the swatch or switch the focusBehavior to 'swatch'.`),l?.(!1)):t[0].focus()}}),[i,b,l]);const S=e(r);return t.jsx("div",{id:p.useId(),ref:d,class:C,role:"gridcell","data-oj-key":h,onKeyDown:e=>{"swatch"!==i||!s||"ArrowDown"!==e.key&&"ArrowUp"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation()},..."number"==typeof h&&{"data-oj-key-type":"number"},children:t.jsx(c.TabbableModeContext.Provider,{value:{isTabbable:s},children:t.jsx(v.FocusTrap,{isDisabled:!s,restoreFocusRef:!1,children:S})})})}),((e,t)=>!(!e||!t)&&(e.children===t.children&&e.isTabbable===t.isTabbable&&e.isFocused===t.isFocused&&e.isFocusRingVisible===t.isFocusRingVisible&&e.focusBehavior===t.focusBehavior&&l.compareListItemContext(e.context,t.context))));function R({children:e}){return t.jsx(C.Flex,{wrap:"wrap",gap:["2x","2x"],children:e})}const S={all:!1,keys:new Set},T=s.forwardRef((({children:e,data:s,onLoadMore:c=()=>{},hasMore:w=!1,getRowKey:g,currentKey:m,onCurrentKeyChange:p,selectedKeys:x=S,onSelectionChange:v,viewportConfig:C,focusBehavior:T="swatch","aria-label":k,"aria-labelledby":F,columns:M,swatchSize:K,updateSwatchSize:I},B)=>{const L=a.useRef(null);a.useImperativeHandle(B,(()=>L.current),[L]);const A=a.useRef(),P=a.useRef(),V=w||!s||M<1?-1:Math.ceil(s?.length/M),j=M<1?-1:M,[D,N]=a.useState(!0),O=D?T:"swatch",z=a.useRef(!1),_=a.useRef(!1),[U,G]=h.useTabbableModeSet(L,(e=>l.keyExtractor(e,l.ITEM_SELECTOR)),m,p),{currentKeyProps:H}=u.useCurrentKey((e=>l.keyExtractor(e,l.ITEM_SELECTOR)),!0,l.getPrevNextKeyByCount(s,g,m,-M),l.getPrevNextKeyByCount(s,g,m,M),l.getPrevNextKeyByCount(s,g,m,-1),l.getPrevNextKeyByCount(s,g,m,1),m,p),[$,q]=d.useCollectionFocusRing(L,["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"]);a.useEffect((()=>{if(null!=m&&L.current){const e=l.findElementByKey(L.current,m,l.ITEM_SELECTOR);if(e){if("swatch"===O){const t=e.closest("[role=gridcell]"),r=L.current.getAttribute("aria-activedescendant");t&&r!==t.id&&(L.current.setAttribute("aria-activedescendant",t.id),z.current=!0)}z.current&&(e.scrollIntoView({block:"nearest"}),z.current=!1)}}}),[m,s,O]);const J=a.useCallback((e=>{v&&(!1===e.value.all&&e.value.keys.size>0&&(A.current=Array.from(e.value.keys.values()).pop()),v(e))}),[A,v]),{selectionProps:Q}=b.useSwatchSelection((e=>e===L.current?void 0===m?null:m:l.keyExtractor(e,l.ITEM_SELECTOR)),x,!1,"toggle",J),W=a.useCallback((()=>{_.current||(_.current=!0,c())}),[_,c]);a.useEffect((()=>{_.current=!1}),[s,w]);const X=a.useCallback((e=>{const t=g(e.data);return{index:e.index,data:e.data,metadata:{key:t},selector:void 0}}),[g]),{tabbableModeProps:Y}=n.useTabbableMode();C=l.getViewportConfig(L,C);const Z=t.jsx("div",{role:"row",children:t.jsx(R,{children:t.jsx(f.LoadMoreCollection,{data:s,hasMore:w,onLoadMore:W,loadMoreThreshold:12,viewportConfig:C,children:r=>{const s=X(r),a=U(s.metadata.key),o=m===s.metadata.key&&!a,c=o&&$;return(r=>t.jsx(E,{context:r,isTabbable:a,isFocused:o,isFocusRingVisible:c,focusBehavior:O,..."content"===T&&{setIsFocusBehaviorValid:N},...0===s.index&&!K.width&&{updateSwatchSize:I},children:e},s.metadata.key))(s)}})})});return t.jsx("div",{...o.mergeProps(H,q,Y,Q,{onFocus:()=>{if(!i.isKeyDefined(m)&&p&&U(void 0)&&L.current){const e=P.current||l.getFirstVisibleKey(L.current,l.ITEM_SELECTOR);i.isKeyDefined(e)&&p({value:e})}},onPointerDown:e=>{const t=l.keyExtractor(e.target,l.ITEM_SELECTOR);i.isKeyDefined(t)&&(P.current=t)},onKeyDown:e=>{"content"===O&&"Tab"===e.key&&L.current?.focus({preventScroll:!0});(e.metaKey||e.ctrlKey)&&e.shiftKey&&["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)&&(z.current=!0)}},{..."swatch"===O&&G}),ref:L,role:"grid",className:y.styles.baseStyle,"aria-label":k,"aria-labelledby":F,"aria-multiselectable":"false","aria-rowcount":V,"aria-colcount":j,children:s?.length||w?Z:t.jsx(r.Fragment,{})})}));e.BaseSwatchView=T,e.getColCount=(e,t,r)=>{if(!t||!r)return 0;const s=Math.floor((r+e)/(e+t));return Math.max(1,s)}}));
//# sourceMappingURL=BaseSwatchView-4d204ce0.js.map
