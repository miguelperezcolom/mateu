define(['exports', 'preact/jsx-runtime', 'preact/hooks', 'preact/compat', './refUtils-77e97004', './Layer-dc3c1ac9', './LayerHost-7d4aa6d3', './Modal-8d647f76', './FocusTrap-d06ac102', './tabbableUtils-9101c0e5', './positionUtils-6e4daa31', './clientHints-6d361eaa', './useOutsideClick-9c4ceb18', './useAnimation-5a74955f', './useUser-988f7da2', './useTestId-a2e433c2', './useSwipe-d22a98f1', './useComponentTheme-5aa41a8f', './colors-17f17162', './mergeInterpolations-9ede4cf7', './UNSAFE_DrawerPopup/themes/redwood/DrawerPopupTheme'], (function(e,t,n,r,o,s,a,i,u,l,c,d,m,f,p,b,h,g,v,y,w){"use strict";const E="0px",O=250,k=r.forwardRef((({children:e,isOpen:r=!1,autoFocusRef:a,placement:k="start",modality:C="modal",onClose:R,onTransitionEnd:x,"aria-label":A,"aria-labelledby":T,"aria-describedby":F,testId:P,...D},S)=>{const[I,M]=n.useState(r?"initial":"unmounted"),j=n.useRef(r?"initial":"unmounted"),U=e=>{j.current=e,M(e)},[H,L]=n.useState("hidden"),[N,W]=n.useState(!r),[X,Y]=n.useState("overlay"),z=n.useRef("unmounted"),$=n.useRef(null),K=n.useRef(null),B=n.useMemo((()=>o.mergeRefs($,S)),[$,S]),_="bottom"===k,q=n.useRef(!1),G={opening:()=>_?{from:{translateY:Z()},to:{translateY:E},options:{duration:O}}:{from:{translateX:V()},to:{translateX:E},options:{duration:O}},closing:()=>_?{from:{translateY:E},to:{translateY:Z()},options:{duration:O}}:{from:{translateX:E},to:{translateX:V()},options:{duration:O}}},J=b.useTestId(P),{direction:Q}=p.useUser(),V=()=>{return`${"right"===c.normalizePosition(k,Q)?"":"-"}${e=$.current,Math.round(e.getBoundingClientRect().width)}px`;var e},Z=()=>{return`${e=$.current,Math.round(e.offsetHeight)}px`;var e},ee=n.useCallback((()=>{$.current?.style?.removeProperty("transform")}),[]),{nodeRef:te}=f.useAnimation(I,{animationStates:G,isAnimatedOnMount:!0,onAnimationEnd:()=>{if("opening"===I)ee(),(()=>{if($.current){const e=l.getAutofocusFocusables($.current);if(e.length>0)return void l.focusOn(e[0]);l.focusWithin($.current)}})(),x?.(!0);else if(!r){const e=l.getActiveElement();q.current=$.current?.contains(e)||e===document.body||!1,te(null),L("hidden"),U("unmounted"),x?.(!1)}}});n.useEffect((()=>("unmounted"!==I||r||I===z.current?"unmounted"===I&&r?U("initial"):"initial"===I&&r?(te($.current),W(!1),U("opening")):"opening"===I&&r?L("visible"):r||"unmounted"===I||(W(!0),"unmounted"!==j.current&&U("closing")):q.current&&(l.focusOnElementOrNearestAncestor(K.current),q.current=!1),()=>{z.current=I})),[r,I,te]),n.useEffect((()=>()=>{$.current?.contains(l.getActiveElement())&&setTimeout((()=>{l.focusOnElementOrNearestAncestor(K.current)}),0)}),[]),n.useEffect((()=>{if("opening"===I&&(K.current=l.getActiveElement(),"modeless"===C&&K.current?.addEventListener("keydown",ne)),"closing"===I&&"modeless"===C)return()=>{K.current?.removeEventListener("keydown",ne)}}),[C,I]);const ne=e=>{K.current===l.getActiveElement()&&"F6"===e.code&&(e.preventDefault(),e.stopPropagation(),l.focusWithin($.current))},re=n.useCallback((e=>{const t=K.current;switch(e.code){case"Escape":R?.({reason:"escapeKey"});break;case"F6":if("modeless"===C){e.preventDefault(),e.stopPropagation(),t&&l.focusOn(t);break}}}),[R,C]),oe=n.useCallback((()=>{R?.({reason:"outsideClick"})}),[R]),se=[$];K.current&&K.current!==document.body&&se.push(K),m.useOutsideClick({isDisabled:N,ref:se,handler:oe});const ae=d.getClientHints(),ie=n.useCallback((()=>"ios"===ae.platform?document.documentElement.clientWidth:window.innerWidth),[ae.platform]),ue=n.useCallback((()=>{const e=ie();"overlay"===X&&e<600&&Y("fullOverlay"),"fullOverlay"===X&&e>600&&Y("overlay")}),[ie,X]);n.useEffect((()=>{if($.current&&"opening"===I){const e=new ResizeObserver((()=>{ue()}));return e.observe(document.body),()=>{e.unobserve(document.body)}}}),[I,ue]);const le=n.useCallback((()=>{R?.({reason:"swipe"})}),[R]),ce=n.useCallback((e=>{const t=e.direction;"ltr"===Q&&("start"===k&&"left"===t||"end"===k&&"right"===t)&&le(),"rtl"===Q&&("start"===k&&"right"===t||"end"===k&&"left"===t)&&le(),"bottom"===k&&"down"===t&&le()}),[Q,k,le]),{swipeProps:de}=h.useSwipe(ce,{threshold:50,maximumTime:750,tolerance:40}),{classes:me}=g.useComponentTheme(w.DrawerPopupRedwoodTheme,{placement:_?k:"rtl"===Q?"start"===k?"right":"left":"start"===k?"left":"right",visibility:H,displayModeHorizontal:["start","end"].indexOf(k)>-1?X:void 0}),fe=[...Object.values(v.colorInterpolations)],pe=y.mergeInterpolations(fe),{...be}=pe(D),he=()=>t.jsx(u.FocusTrap,{autoFocusRef:a,restoreFocusRef:!1,children:t.jsx("div",{ref:B,className:me,style:be,tabIndex:-1,role:"dialog",onKeyDown:re,"aria-label":A,"aria-labelledby":T,"aria-describedby":F,...de,...J,children:e})}),ge="unmounted"!==I;return ge?"modal"===C?t.jsx(i.Modal,{isOpen:ge,children:he()}):t.jsx(s.Layer,{children:he()}):null}));e.DrawerPopup=k}));
//# sourceMappingURL=DrawerPopup-8d62ed90.js.map
