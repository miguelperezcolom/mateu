/**
 * @license
 * Copyright (c) %FIRSTYEAR% %CURRENTYEAR%, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define("oj-c/hooks/UNSAFE_useDataProvider/utils",["require","exports"],(function(require,e){"use strict";function t(e,t,a,s){const o=[...s];return e.forEach(((e,s)=>{const n={data:t[s],key:a[s]?.key,metadata:a[s]};e>=0?o.splice(e,0,n):o.push(n)})),o}async function a(e,t){const a=[],s=(await e.fetchByKeys({keys:t})).results;for(const e of t)if(s.has(e)){const t=s.get(e);a.push({...t,key:e})}return a}function s(e,t){return e.has(t)?e.get(t):-1}function o(e,t){const a=[...t];return e.sort(((e,t)=>t-e)),e.forEach((e=>{e<a.length&&a.splice(e,1)})),a}Object.defineProperty(e,"__esModule",{value:!0}),e.getUpdatedItemsFromMutationDetail=async function(e,n,r){const{add:i,remove:c,update:d}=e??{},u=new Map;for(const[e,t]of n.entries())u.set(t.key,e);let l=[...n];c&&(l=function(e,t,a){const{indexes:n,keys:r}=e;let i=[...t];n?.length?i=o(n,i):r?.size&&(i=function(e,t,a){const n=[];return e.forEach((e=>{const t=s(a,e);-1!==t&&n.push(t)})),o(n,t)}(r,i,a));return i}(c,l,u));i&&(l=await async function(e,o,n,r){const{addBeforeKeys:i,data:c,indexes:d,keys:u,metadata:l}=e;let f=[...o],h=c||[],p=l||[];if(0===h.length&&u?.size){const e=await a(r,u)??[];h=e.map((e=>e.data)),p=e.map((e=>e.metadata))}0===p.length&&u?.size&&(p=[...u].map((e=>({key:e}))));h.length&&(f=d?.length?t(d,h,p,f):i?.length?function(e,a,o,n){const r=[],i=[];return e.forEach((e=>{r.push(s(n,e)),i.push({key:e})})),t(r,a,i,o)}(i,h,f,n):function(e,a,s){return t(new Array(e.length).fill(-1),e,a,s)}(h,p,f));return f}(i,l,u,r));d&&(l=await async function(e,t,o,n){const{data:r,indexes:i,keys:c,metadata:d}=e;let u=[...t],l=r||[],f=d||[];if(0===l.length&&c?.size){const e=await a(n,c)??[];l=e.map((e=>e.data)),f=e.map((e=>e.metadata))}0===f.length&&c?.size&&(f=[...c].map((e=>({key:e}))));l.length&&(i?.length?u=function(e,t,a,s){const o=[...s];return e.forEach(((e,s)=>{if(o[e]){const n={data:t[s],key:a[s]?.key,metadata:a[s]};o.splice(e,1,n)}})),o}(i,l,f,u):c?.size&&(u=function(e,t,a,o,n){const r=[...o];return e.forEach((e=>{const o=s(n,e),i={data:t[o],key:a[o]?.key,metadata:a[o]};o>=0&&r.splice(o,1,i)})),r}(c,l,f,u,o)));return u}(d,l,u,r));return l}})),define("oj-c/hooks/UNSAFE_useDataProvider/DataProviderHandler",["require","exports","./utils"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DataProviderHandler=void 0;e.DataProviderHandler=class{constructor(e,a,s){this.handleMutateEvent=async e=>{const{detail:a}=e,s=this.addBusyState("updating data from mutation event"),o=await(0,t.getUpdatedItemsFromMutationDetail)(a,this.currentData,this.dataProvider);s?.(),this.currentData=o,this.callback?.onDataUpdated?.(o)},this.handleRefreshEvent=()=>{this._fetchDataAndNotify()},this.addBusyState=a,this.callback=s,this.dataProvider=e,this.currentData=[],e.addEventListener("refresh",this.handleRefreshEvent),e.addEventListener("mutate",this.handleMutateEvent),this._fetchDataAndNotify()}destroy(){this.callback=void 0,this.currentData=[],this.dataProvider.removeEventListener("refresh",this.handleRefreshEvent),this.dataProvider.removeEventListener("mutate",this.handleMutateEvent)}async _fetchData(){const e=[],t=this.dataProvider.fetchFirst({size:-1});for await(const a of t){const t=a.data.map(((e,t)=>({data:e,key:a.metadata[t].key,metadata:a.metadata[t]})));e.push(...t)}return this.currentData=e.slice(),e}async _fetchDataAndNotify(){const e=this.addBusyState("fetching data"),t=await this._fetchData();this.callback?.onDataUpdated?.(t),e()}}})),
/**
 * @license
 * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define("oj-c/hooks/UNSAFE_useDataProvider/useDataProvider",["require","exports","preact/hooks","./DataProviderHandler"],(function(require,e,t,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.useDataProvider=function({addBusyState:e,data:s}){const[o,n]=(0,t.useState)([]),r=(0,t.useRef)();return(0,t.useEffect)((()=>(void 0!==s&&(r.current=new a.DataProviderHandler(s,e,{onDataUpdated:n})),()=>{r.current?.destroy(),r.current=void 0})),[s,e]),{data:o}}})),define("oj-c/message-toast/message-toast",["require","exports","preact/jsx-runtime","@oracle/oraclejet-preact/translationBundle","@oracle/oraclejet-preact/UNSAFE_MessageToast","@oracle/oraclejet-preact/hooks/UNSAFE_useMessagesContext","oj-c/hooks/UNSAFE_useDataProvider/useDataProvider","ojs/ojvcomponent","preact/hooks","ojs/ojcontext","css!oj-c/message-toast/message-toast-styles.css"],(function(require,e,t,a,s,o,n,r,i,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MessageToast=void 0;const d=(0,r.registerCustomElement)("oj-c-message-toast",(function({data:e,detailTemplateValue:a,iconTemplateValue:d,messageTemplates:u,offset:l=0,position:f="bottom",onOjClose:h}){const p=(0,i.useRef)((0,r.getUniqueId)()),m=(0,i.useRef)(),[y,g]=(0,i.useState)(e),[v,j]=(0,i.useState)(0),D=(0,i.useCallback)(((e="MessageToast: busyState")=>m.current?c.getContext(m.current).getBusyContext().addBusyState({description:e}):()=>{}),[]);e!=y&&(g(e),j((e=>e+1)));const{data:k}=(0,n.useDataProvider)({data:e,addBusyState:D}),P=`messageToastLayer_${p.current}`,E=(0,i.useMemo)((()=>({addBusyState:D,UNSAFE_messagesLayerId:P})),[D,P]);return(0,t.jsx)(r.Root,{ref:m,"data-oj-messages-layer-id":P,children:(0,t.jsx)(o.MessagesContext.Provider,{value:E,children:(0,t.jsx)(s.MessageToast,{data:k,detailRendererKey:a,iconRendererKey:d,offset:l,onClose:h,position:f,renderers:u},v)})})}),"MessageToast",{properties:{data:{type:"DataProvider"},detailTemplateValue:{type:"string|function"},iconTemplateValue:{type:"string|function"},offset:{type:"number|object"},position:{type:"string",enumValues:["top","bottom","top-start","top-end","bottom-start","bottom-end","top-left","top-right","bottom-left","bottom-right"]}},extension:{_DYNAMIC_SLOT:{prop:"messageTemplates",isTemplate:1}},events:{ojClose:{}}},{offset:0,position:"bottom"},{"@oracle/oraclejet-preact":a.default});e.MessageToast=d})),define("oj-c/message-toast",["require","exports","oj-c/message-toast/message-toast"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MessageToast=void 0,Object.defineProperty(e,"MessageToast",{enumerable:!0,get:function(){return t.MessageToast}})}));
//# sourceMappingURL=message-toast.js.map