define(['exports', 'preact/jsx-runtime', 'preact/hooks', './clientUtils-df9caee0', './useVisDragModeControls-f3a420dc', './hooks/PRIVATE_useChartMarquee/themes/useChartMarquee.css', './eventsUtils-5fb81c3e', './accUtils-acd70e81'], (function(e,t,n,r,o,i,a,s){"use strict";function c(e,t){return"zoom"===e||"select"===e?"crosshair":"pan"===e?t?"grabbing":"grab":void 0}function u(e,t,n){return e>=n.x&&e<=n.x+n.width&&t>=n.y&&t<=n.y+n.height}function h(e,t,n,r,o){return!(u(e,t,n)||u(e,t,r)||u(e,t,o))}function x({x1:e,y1:n,width:r,height:o}){return t.jsxs(t.Fragment,{children:[t.jsx("rect",{x:e,y:n,width:r,height:o,class:i.styles.visMarquee,"data-oj-private-object":"marquee"}),t.jsx("rect",{x:e+1,y:n+1,width:Math.max(0,r-2),height:Math.max(0,o-2),class:i.styles.visMarqueeInnerArea})]})}e.useChartMarquee=function({rootRef:e,plotAreaSpace:i,xSpace:s,ySpace:f,dragMode:l,chartWidth:d,isMultiSelection:m,onViewportChange:M,isZoomScroll:g,xScale:y,selectedIds:p,getDataById:v,onSelectionChange:w,isRtl:S,xAxisInfo:C}){const P=r.isTouch(),b=n.useRef(!1),z=n.useRef(0),{min:R,max:j,viewportMax:q,viewportMin:A,minAxisExtent:B}=C,D=n.useRef(),I=function(e,t,n){return!(!n||!e||"user"!==t&&"pan"!==t)}(g,l,P),E=function(e,t,n){return!!e&&(t&&"zoom"===n||!t&&"user"===n)}(g,P,l),T=function(e,t,n,r){return!!e&&(t||"user"!==r&&"select"!==r?"user"===r||n&&"select"===r:n)}(m,g,P,l),{dragButtonDivRef:U,toggleButtonContent:V,userDragMode:k}=o.useVisDragModeControls({componentWidth:d,plotAreaSpace:i,isRtl:S,showPanButton:I,showZoomButton:E,showSelectButton:T,dragMode:l}),[H,K]=n.useState(!1),W=n.useRef(!1),[X,Y]=n.useState(),Z=n.useRef(new Set),F=function(e,t,n,r,o,i){return null!=o&&e?o:"user"!==r||n?n?"off":r:t?"pan":i?"select":"off"}(I&&"pan"===k||T&&"select"===k||E&&"zoom"===k,g,P,l,k,m),L=function(e,t,n,r,o,i){if(e&&t){const a=n.x+n.width,s=n.y+n.height;let c=Math.max(Math.min(e.x,t.x),n.x),h=Math.min(Math.max(e.x,t.x),a),x=Math.max(Math.min(e.y,t.y),n.y);const f=Math.min(Math.max(e.y,t.y),s);let l=Math.abs(h-c),d=Math.abs(f-x);return u(e.x,e.y,r)||i?(x=n.y,d=n.height):u(e.x,e.y,o)&&(c=n.x,h=a,l=n.width),{x1:c,y1:x,width:l,height:d,x2:h,y2:f}}}(D.current,X,i,s,f,"zoom"===F);let O;const _="select"===F&&L?(e,t)=>{if(D.current?.isMeta&&p?.has(e))return!0;const{x1:n,x2:r,y1:o,y2:i}=L,{x:a,y:s}=t;return u(a,s,{x:n,width:r-n,y:o,height:i-o})?(Z.current?.add(e),!0):(Z.current?.delete(e),!1)}:void 0;return!L||"zoom"!==F&&"select"!==F||(O=t.jsx(x,{...L})),{ignoreSelectPointerUp:("pan"===F||"zoom"===F)&&W.current,cursor:c(F,H),yAxisCursor:"zoom"!==F?c(F,H):"initial",marqueeContent:O,toggleButtonContent:!H&&(!P&&b.current||P)&&V,isPointInsideMarquee:_,dragMode:F,marqueeProps:"off"!=l?{onPointerDown:e=>{if(U?.current?.contains(e.target))return;const t=e.offsetX,n=e.offsetY;K(!0),h(t,n,i,s,f)||"zoom"===F&&u(t,n,f)||(D.current={x:t,y:n})},onPointerMove:t=>{if(!H)return;W.current=!0,t.metaKey&&D.current&&(D.current.isMeta=!0);const n=t.offsetX,r=t.offsetY;if(h(n,r,i,s,f)||"zoom"===F&&u(n,r,f))return;const o=a.getElementData(e,t.target),c=o?.ojPrivateObject;if(!("window"===c||"leftHandle"===c||"rightHandle"===c)&&"pan"===F&&M&&(!P||P&&1===z.current)){const e=y.invert(n)-y.invert(X?.x||D.current?.x),t=q-A;let r=A-e,o=q-e;r<R&&(r=R,o=r+t),o>j&&(o=j,r=o-t),r!=A&&o!=q&&Math.abs(o-r)>=B&&M({xMin:r,xMax:o})}Y({x:n,y:r})},onPointerUp:e=>{if(K(!1),Y(void 0),D.current=void 0,W.current=!1,!U.current?.contains(e.target)&&L){if("zoom"===F){const{x1:e,x2:t}=L;let n=Math.min(y.invert(e),y.invert(t)),r=Math.max(y.invert(e),y.invert(t));if(Math.abs(r-n)<B){const e=(n+r)/2;n=Math.max(R,e-B/2),r=Math.min(j,n+B)}M?.({xMin:n,xMax:r})}if("select"===F){const t=[...new Set([...Z.current,...e.metaKey&&p||new Set])],n=t.map((e=>v(e)));w?.({ids:t,data:n}),Z.current=new Set}}},onPointerLeave:e=>{b.current=!1,L&&P&&"off"!=F&&e.currentTarget.setPointerCapture(e.pointerId)},onPointerEnter:()=>{b.current=!0},onTouchEnd:e=>{K(!1),Y(void 0),D.current=void 0,z.current=e.touches.length},onTouchStart:e=>{z.current=e.touches.length}}:{}}}}));
//# sourceMappingURL=useChartMarquee-84054198.js.map
