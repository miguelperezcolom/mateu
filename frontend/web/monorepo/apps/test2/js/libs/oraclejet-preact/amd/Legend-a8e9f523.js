define(['exports', 'preact/jsx-runtime', 'preact/hooks', './useLegendContextMenu-acabb503', './useVisEvents-3839d74f', './useLegendDnd-daee983e', './mergeProps-bcfa6a92', './useItemFocus-75d6510d', './PRIVATE_BaseLegend/themes/LegendStyles.css', './useCssVars-d782da3d', './classNames-08d99695', './useTestId-a2e433c2', './useVisTouchResponse-88a7bb09', './stringUtils-4ffd9d59', 'preact/compat', './TrackResizeContainer-a4999df9', './useTextDimensions-f254e8f5', './hooks/PRIVATE_useVisDnd/themes/VisDndStyles.css', './LegendRendered-d8626509'], (function(e,t,n,s,i,o,a,d,r,l,m,g,h,c,u,I,x,f,y){"use strict";function v(e,t){const{itemIdx:n}=e;return-1==n?t[t.length-1]:t[n]}function p(e,t){let n=e.itemIdx;return-1==n&&(n=t.length-1),n=Math.min(t.length-1,n+1),"off"!==t[n].actionable?{sectionIdx:0,itemIdx:n}:n===t.length-1?(n-=1,{sectionIdx:0,itemIdx:n}):p({sectionIdx:0,itemIdx:n},t)}function D(e,t){let n=e.itemIdx;return-1==n&&(n=t.length-1),n=Math.max(0,n-1),"off"!==t[n].actionable?{sectionIdx:0,itemIdx:n}:D({sectionIdx:0,itemIdx:n},t)}function b(e){return{getItem:t=>v(t,e),getDetailFromInfo:t=>{if(!t||0===e.length)return{itemId:void 0,data:void 0};const n=v(t,e);return{itemId:n.id,data:n}},getPrevItemInfo:t=>D(t,e),getNextItemInfo:t=>p(t,e)}}const S=({width:e,getTextDimensions:t,resolvedVars:n,orientation:s,legendFontStylesObj:i={},symbolWidth:o,items:a})=>{let d=0,r=0,l=0,m=!1;const g=e;if(!Object.keys(n).length||!t)return;const h=parseFloat(n.unit),{maxItemWidth:c,maxItemHeight:u,horizontalSectionWidth:I}=R(a,h,t,i,o);l=I,d=c,r=u,m=I>g;return{totalWidth:l,maxItemWidth:Math.min(d,g),maxItemHeight:r,itemsPerRow:"vertical"===s?1:Math.max(1,Math.floor(g/d)),isWrapped:m}},R=(e,t,n,s,i,o)=>{let a=0,d=0,r=0,l=0,m=0;return l=i?1.5*t+i:4*t,m=o?o+1.7*t:2.5*t+1.7*t,e?.forEach((e=>{const i=e,{width:o,height:g}=n(i.text,s),h=2.5*t+o;r+=l+h,a=Math.max(a,l+h),d=Math.max(d,g,m)})),{maxItemWidth:a,maxItemHeight:d,horizontalSectionWidth:r}};const M=u.forwardRef((({orientation:e="horizontal",items:v,isReadOnly:p=!0,onItemAction:D,onItemHover:R,onItemFocus:M,testId:W,contextMenuConfig:C,hideAndShowBehavior:P="off",hoverBehavior:F="none",halign:T="start",valign:L="top",...V},H=null)=>{const{isGetPreferredSizeReady:w,width:j,height:E}=n.useContext(y.LegendRenderedContext),{textMeasureContent:O,getTextDimensions:z}=x.useTextDimensions(),{resolvedVars:A,cssContent:N}=l.useCssVars(o.legendVars),B=o.getLegendTextStyle({fontStyle:V.textFontStyle,fontSize:V.textFontSize?.toString(),fontWeight:V.textFontWeight?.toString(),fontFamily:V.textFontFamily},A),k=n.useRef(null);u.useImperativeHandle(H,(()=>({_getPreferredSize:(t,n)=>function(e,t,n,s,i,a,d,r,l){if(!l)return;const m=S({width:e,getTextDimensions:l,resolvedVars:s,orientation:i,legendFontStylesObj:a,symbolWidth:d,symbolHeight:r,items:n}),{itemsPerCol:g,itemsPerRow:h}=o.getGridNums(n.length,m,i),c=parseFloat(s.unit),u=Math.min(e,1===g?m.totalWidth:h?m.maxItemWidth*h:m.totalWidth),I=.8*c,x=1.5*c,f=g?m.maxItemHeight*g+(g-1)*I+x:m.maxItemHeight+x,y=Math.min(t,f);return{width:Math.ceil(u),height:Math.ceil(y)}}(t,n,v,A,e,B,V.symbolWidth,V.symbolHeight,z)})),[z,A,e,B,V.symbolWidth,V.symbolHeight,v]),z&&null!=A.unit&&null!=A.fontSize&&w?.(!0);const $=g.useTestId(W),G=void 0!==$["data-testid"],_=n.useRef(),{getItem:U,getDetailFromInfo:q,getPrevItemInfo:K,getNextItemInfo:J}=b(v),Q=o.getIsLegendItemActionable(v,p),X=v.length>0,{touchResponse:Y,touchResponseStyle:Z}=h.useVisTouchResponse({type:"touchStart"}),{focusedItemInfo:ee,hoveredItemInfo:te,onContextMenuDismissed:ne,activeId:se,eventsProps:ie}=i.useVisEvent(Y,!p,Q,((e,t,n)=>o.getKeyUpHandler(e,t,n,null!=V.hiddenIds)),q,K,J,D,R,M,o.isEqualItem,o.getItemInfo,{itemIdx:0,sectionIdx:0},null!=V.hiddenIds),{focusedItemRef:oe}=d.useItemFocus(ee),ae=o.getDatatipText(v,U,ee,te),[de,re]=n.useState(!1),{datatipContent:le,datatipProps:{"aria-describedby":me,...ge}}=s.useLegendDatatip({text:ae,rootDimsRef:_,focusedItemInfo:ee,focusedItemRef:oe,touchResponse:Y,isDisabled:de}),he=o.getAriaProps(p,V["aria-label"],V.hiddenIds,c.l([V["aria-describedby"],me]),V["aria-labelledby"]),{contextMenuContent:ce,contextMenuProps:ue}=s.useLegendContextMenu({rootRef:k,contextMenuConfig:X?C:void 0,focusedItemInfo:ee,items:v,isReadOnly:p,onContextMenuDismissed:ne}),[Ie,xe]=n.useState(),{draggable:fe,dndProps:ye,dndContent:ve}=o.useLegendDnd({onDrag:V.onDrag,onDragStart:V.onDragStart,onDragEnd:V.onDragEnd,onDragEnter:V.onDragEnter,onDragLeave:V.onDragLeave,onDragOver:V.onDragOver,onDrop:V.onDrop,items:v,setDragOver:xe,setDatatipDisabled:re,itemDraggable:V.itemDraggable}),pe=a.mergeProps(ie,ge,ue,ye),{legendStyle:De,renderedLegendStyle:be}=r.styles;return t.jsxs(t.Fragment,{children:[!w&&t.jsx(I.TrackResizeContainer,{width:j?`${j}px`:"100%",height:E?`${E}px`:"100%",class:m.classNames([r.styles.flexStyle,r.styles[`${T}HAlign`],r.styles[`${L}VAlign`]]),children:function(i){const a=n.useMemo((()=>S({width:i,getTextDimensions:z,resolvedVars:A,orientation:e,legendFontStylesObj:B,symbolWidth:V.symbolWidth,symbolHeight:V.symbolHeight,items:v})),[i]),{itemsPerCol:d,itemsPerRow:r}=o.getGridNums(v.length,a);return t.jsxs(t.Fragment,{children:[t.jsx("div",{ref:k,tabIndex:p?void 0:0,role:"application",draggable:fe,class:m.classNames([De,be,Ie?f.styles.dndDragOverHTMLStyle:!1===Ie?f.styles.dndRejectedStyle:void 0]),style:Z,...$,...he,...pe,"aria-activedescendant":se,children:t.jsx(s.BaseLegend,{...V,focusedItemRef:oe,items:v,isReadOnly:p,orientation:e,sectionIdx:0,itemsPerRow:r,itemsPerCol:d,itemWidth:a?.isWrapped?a?.maxItemWidth:void 0,focusedItemInfo:ee,hoveredItemInfo:te,activeId:se,hideAndShowBehavior:P,hoverBehavior:F,isTestEnv:G})}),le,ce,ve]})}}),O,N]})}));e.Legend=M}));
//# sourceMappingURL=Legend-a8e9f523.js.map
