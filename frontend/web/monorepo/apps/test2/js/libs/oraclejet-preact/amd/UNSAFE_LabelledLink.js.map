{"version":3,"file":"UNSAFE_LabelledLink.js","sources":["../../src/UNSAFE_LabelledLink/HiddenLabel.tsx","../../src/UNSAFE_LabelledLink/useLabelledLinkTheme.ts","../../src/UNSAFE_LabelledLink/LabelledLink.tsx","../../src/UNSAFE_LabelledLink/useLabelledLinkAria.ts"],"sourcesContent":["import { HiddenAccessible } from '#UNSAFE_HiddenAccessible';\nimport { Label } from '#UNSAFE_Label/Label';\n\ntype Props = {\n  children: string;\n  id?: string;\n};\n\nexport const HiddenLabel = ({ children, id }: Props) => (\n  <HiddenAccessible isHidden>\n    <Label id={id}>{children}</Label>\n  </HiddenAccessible>\n);\n","import { useComponentTheme } from '#hooks/UNSAFE_useComponentTheme';\nimport { classNames } from '#utils/UNSAFE_classNames';\nimport { textInterpolations } from '#utils/UNSAFE_interpolations/text';\nimport { mergeInterpolations } from '#utils/UNSAFE_mergeInterpolations';\nimport { LabelledLinkVariantOptions } from './themes/LabelledLinkStyles.css';\nimport { LabelledLinkRedwoodTheme } from './themes/redwood/LabelledLinkTheme';\n\ntype UseLabelledLinkThemeProps = {\n  hasInsideLabel?: boolean;\n  isFormLayout?: boolean;\n  isFormReadonly?: boolean;\n  textAlign?: 'start' | 'end' | 'right';\n};\n\nexport function useLabelledLinkTheme({\n  hasInsideLabel,\n  isFormLayout,\n  isFormReadonly,\n  textAlign\n}: UseLabelledLinkThemeProps) {\n  // Style interpolations for text align\n  const interpolations = [...Object.values(textInterpolations)];\n  const styleInterpolations = mergeInterpolations<UseLabelledLinkThemeProps>(interpolations);\n\n  // Calculate the style interpolation classes\n  const { class: styleInterpolationClasses } = styleInterpolations({ textAlign });\n  // Calculate the theme classes\n  const { classes: themeClasses } = useComponentTheme<LabelledLinkVariantOptions>(\n    LabelledLinkRedwoodTheme,\n    {\n      formLayout: isFormLayout ? 'isFormLayout' : 'notFormLayout',\n      readonlyForm: isFormReadonly ? 'isReadonlyForm' : 'notReadonlyForm',\n      insideLabel: hasInsideLabel ? 'hasInsideLabel' : 'noInsideLabel'\n    }\n  );\n  // merge all the classes\n  const classes = classNames([styleInterpolationClasses, themeClasses]);\n\n  return { classes };\n}\n","import { useCallback, useRef, useState } from 'preact/hooks';\nimport { detectTruncation } from '#utils/PRIVATE_truncationUtils';\nimport { Label } from '#UNSAFE_Label/Label';\nimport { Link } from '#UNSAFE_Link';\nimport { Text } from '#UNSAFE_Text';\nimport { ReadonlyTextField } from '#UNSAFE_TextField';\nimport { InlineUserAssistance, UserAssistanceDensityType } from '#UNSAFE_UserAssistance';\nimport { View } from '#UNSAFE_View';\nimport { useFocusWithin } from '#hooks/UNSAFE_useFocusWithin';\nimport { useFormContext } from '#hooks/UNSAFE_useFormContext';\nimport { useFormFieldContextProps } from '#hooks/UNSAFE_useFormFieldContextProps';\nimport { FormFieldContext } from '#hooks/UNSAFE_useFormFieldContext';\nimport { useTextField } from '#hooks/UNSAFE_useTextField';\nimport { Size } from '#utils/UNSAFE_size';\nimport { LayoutColumnSpan } from '#utils/UNSAFE_styles/Layout';\nimport { ComponentProps } from 'preact';\nimport { HiddenLabel } from './HiddenLabel';\nimport { useLabelledLinkAria } from './useLabelledLinkAria';\nimport { useLabelledLinkTheme } from './useLabelledLinkTheme';\n\ntype PickedLinkProps = Pick<\n  ComponentProps<typeof Link>,\n  'aria-describedby' | 'href' | 'onClick' | 'target'\n>;\n\nexport type LabelledLinkProps = PickedLinkProps & {\n  /**\n   * Specifies the text that should appear in the field. If this property\n   * is not provided, then the URL provided using the `href` property\n   * will be used as the text in the field.\n   */\n  children?: string;\n\n  /**\n   * Specifies how many columns to span in a FormLayout with direction === 'row'\n   */\n  columnSpan?: LayoutColumnSpan;\n\n  /**\n   * Specifies the label associated with the field.\n   */\n  label: string;\n\n  /**\n   * Specifies where the label is positioned relative to the field.\n   * @default 'inside'\n   */\n  labelEdge?: 'inside' | 'start' | 'top' | 'none';\n\n  /**\n   * Specifies the width of the label when <code>labelEdge</code> is <code>\"start\"</code>.\n   */\n  labelStartWidth?: Size;\n\n  /**\n   * Specifies how to align text within the field.\n   */\n  textAlign?: 'start' | 'end' | 'right';\n\n  /**\n   * The component does not support any assistive text. But, this property can be used to specify\n   * whether or not the component should reserve space to be consistent with the other form components\n   * in the Form Layout. It can be set to:\n   * <ul>\n   * <li><code>'efficient'</code>: Reserve space to prevent layout reflow.</li>\n   * <li><code>'reflow'</code>: Do not reserve space.</li>\n   * <li><code>'compact'</code>: Do not reserve space. </li>\n   * </ul>\n   */\n  userAssistanceDensity?: UserAssistanceDensityType;\n};\n\n/**\n * LabelledLink component can be used to render a readonly form control field that\n * has a link for its content.\n */\nexport const LabelledLink = ({\n  'aria-describedby': ariaDescribedBy,\n  children,\n  columnSpan,\n  href,\n  label,\n  labelEdge: propLabelEdge,\n  labelStartWidth: propLabelStartWidth,\n  onClick: propOnClick,\n  target,\n  textAlign: propTextAlign,\n  userAssistanceDensity: propUserAssistanceDensity\n}: LabelledLinkProps) => {\n  // Consume the form context to get the default values\n  const {\n    isFormLayout,\n    isReadonly: isFormReadonly,\n    labelEdge: formLabelEdge,\n    labelStartWidth: formLabelStartWidth,\n    textAlign: formTextAlign,\n    userAssistanceDensity: formUserAssistanceDensity\n  } = useFormContext();\n\n  // default to FormContext values if component properties are not specified\n  const labelEdge = propLabelEdge ?? formLabelEdge;\n  const labelStartWidth = propLabelStartWidth ?? formLabelStartWidth;\n  // JET-72775 - Form control alignment in tables\n  // We do not have an embedded mode, so always default to 'start' if no text align is set\n  const textAlign = propTextAlign ?? formTextAlign ?? 'start';\n  const userAssistanceDensity = propUserAssistanceDensity ?? formUserAssistanceDensity;\n\n  // We will use the URL as text if the link text is not provided as a child\n  const linkText = children ?? href;\n\n  // Calculate the text field related props\n  const {\n    baseId,\n    formFieldContext: textFieldFormFieldContext,\n    labelProps,\n    inputProps,\n    userAssistanceProps\n  } = useTextField({\n    ariaDescribedBy,\n    isReadonly: true,\n    labelEdge,\n    value: linkText\n  });\n\n  // Track pointer down so we know if we gained focus from keyboard or mouse.\n  const recentPointerRef = useRef<boolean>(false);\n  const pointerDownTimerRef = useRef<ReturnType<typeof setTimeout> | undefined>();\n  const onPointerDown = () => {\n    recentPointerRef.current = true;\n    clearTimeout(pointerDownTimerRef.current);\n    pointerDownTimerRef.current = setTimeout(() => {\n      recentPointerRef.current = false;\n    }, 300);\n  };\n\n  // Truncated tooltips act differently for LabelledLink, so handle it here. We don't want to\n  // show the tooltip when the link is clicked (thereby focusing the field), and if the user\n  // tabbed onto the link and activated it with the keyboard, we want to close the tooltip.\n  const labelRef = labelProps['labelRef'];\n  const linkWasActivatedRef = useRef<boolean>(false);\n  const [showTruncatedTooltip, setShowTruncatedTooltip] = useState(false);\n  const onBlurWithin = useCallback(() => {\n    setShowTruncatedTooltip(false);\n  }, []);\n  const onFocusWithin = useCallback(() => {\n    // Ignore the focus event the first time we see it after the link was activated.\n    // For instance if the link was clicked and opened a new browser tab, we don't want\n    // to show the tooltip again when they return to the current tab.\n    if (linkWasActivatedRef.current) {\n      linkWasActivatedRef.current = false;\n      return;\n    }\n    // We only calculate isTruncated if focus was gained through keyboard interaction.\n    const isTruncated =\n      labelEdge === 'inside' && !recentPointerRef.current ? detectTruncation(labelRef) : false;\n    setShowTruncatedTooltip(isTruncated);\n  }, [labelEdge, labelRef]);\n  const {\n    focusProps: { onFocusIn: onFocus, onFocusOut: onBlur }\n  } = useFocusWithin({\n    isDisabled: false,\n    onBlurWithin,\n    onFocusWithin\n  });\n  const formFieldContext = useFormFieldContextProps({\n    ...textFieldFormFieldContext,\n    hasTruncatedLabel: showTruncatedTooltip\n  });\n  const onClick = useCallback(\n    (event: Event) => {\n      setShowTruncatedTooltip(false);\n      linkWasActivatedRef.current = true;\n      propOnClick?.(event);\n    },\n    [propOnClick]\n  );\n\n  // Create the label component and the fieldLabelProps\n  const labelComp = <Label {...labelProps}>{label}</Label>;\n  const fieldLabelProps = {\n    label: labelEdge !== 'none' ? labelComp : undefined,\n    labelEdge: labelEdge !== 'none' ? labelEdge : undefined,\n    labelStartWidth: labelEdge !== 'none' ? labelStartWidth : undefined,\n    labelText: labelEdge === 'inside' ? label : undefined\n  };\n\n  // save space for user assistance if density is 'efficient', even though we don't\n  // render user assistance for readonly fields for now.\n  const inlineUserAssistance =\n    userAssistanceDensity === 'efficient' ? (\n      <InlineUserAssistance\n        userAssistanceDensity={userAssistanceDensity}\n        {...userAssistanceProps}\n      />\n    ) : undefined;\n\n  // Get the theme classes\n  const { classes } = useLabelledLinkTheme({\n    hasInsideLabel: labelEdge === 'inside',\n    isFormLayout,\n    isFormReadonly,\n    textAlign\n  });\n\n  // Get the aria props\n  const hasEmptyLabel = label === '';\n  const hasHiddenLabel = labelEdge === 'none';\n  const { containerAria, hiddenLabelAria, linkAria } = useLabelledLinkAria({\n    'aria-describedby': inputProps['aria-describedby'],\n    baseId,\n    hasEmptyLabel,\n    hasHiddenLabel,\n    labelId: labelProps.id\n  });\n\n  return (\n    <FormFieldContext.Provider value={formFieldContext}>\n      <ReadonlyTextField\n        columnSpan={columnSpan}\n        role=\"presentation\"\n        inlineUserAssistance={inlineUserAssistance}\n        {...fieldLabelProps}\n        mainContent={\n          <div\n            onBlur={onBlur}\n            onFocus={onFocus}\n            onPointerDown={onPointerDown}\n            class={classes}\n            {...containerAria}>\n            {hasHiddenLabel && <HiddenLabel {...hiddenLabelAria}>{label}</HiddenLabel>}\n            {/**\n             * The containing div is a flexbox. So, the text-align will not work for the link\n             * content. So, we wrap the link in a 100% block. This way the text align will\n             * work as the link is now inside a block and not flexbox.\n             */}\n            <View width=\"100%\">\n              <Link href={href} target={target} onClick={onClick} {...linkAria}>\n                <Text size=\"md\" variant=\"inherit\">\n                  {linkText}\n                </Text>\n              </Link>\n            </View>\n          </div>\n        }\n      />\n    </FormFieldContext.Provider>\n  );\n};\n","import { useAccessibleContext } from '#hooks/UNSAFE_useAccessibleContext';\nimport { classNames as mergeIds } from '#utils/UNSAFE_classNames';\n\ntype UseLabelledLinkAriaProps = {\n  'aria-describedby'?: string;\n  baseId: string;\n  hasEmptyLabel: boolean;\n  hasHiddenLabel: boolean;\n  labelId?: string;\n};\n\nexport function useLabelledLinkAria({\n  'aria-describedby': ariaDescribedBy,\n  baseId,\n  hasEmptyLabel,\n  hasHiddenLabel,\n  labelId: propLabelId\n}: UseLabelledLinkAriaProps) {\n  const containerId = `${baseId}--container`;\n  const labelId = propLabelId ?? `${baseId}--hidden-label`;\n\n  // JET-52089: add unsafe API for specifying an external label which is added to ariaLabelledBy on the input or div,\n  // only when labelEdge is 'none' and label is ''. Since ariaLabelledBy takes precedence over all other\n  // kinds of labels, this helps to ensure we don't override a meaningful label.\n  const { UNSAFE_ariaLabelledBy } = useAccessibleContext();\n  const ariaLabelledBy = mergeIds([\n    labelId,\n    hasEmptyLabel && hasHiddenLabel && UNSAFE_ariaLabelledBy,\n    containerId\n  ]);\n\n  return {\n    containerAria: {\n      id: containerId\n    },\n    hiddenLabelAria: hasHiddenLabel\n      ? {\n          id: labelId\n        }\n      : {},\n    linkAria: {\n      'aria-describedby': ariaDescribedBy,\n      'aria-labelledby': ariaLabelledBy\n    }\n  };\n}\n"],"names":["HiddenLabel","children","id","_jsx","HiddenAccessible","isHidden","Label","useLabelledLinkTheme","hasInsideLabel","isFormLayout","isFormReadonly","textAlign","interpolations","Object","values","textInterpolations","styleInterpolations","mergeInterpolations","class","styleInterpolationClasses","classes","themeClasses","useComponentTheme","LabelledLinkRedwoodTheme","formLayout","readonlyForm","insideLabel","classNames","ariaDescribedBy","columnSpan","href","label","labelEdge","propLabelEdge","labelStartWidth","propLabelStartWidth","onClick","propOnClick","target","propTextAlign","userAssistanceDensity","propUserAssistanceDensity","isReadonly","formLabelEdge","formLabelStartWidth","formTextAlign","formUserAssistanceDensity","useFormContext","linkText","baseId","formFieldContext","textFieldFormFieldContext","labelProps","inputProps","userAssistanceProps","useTextField","value","recentPointerRef","useRef","pointerDownTimerRef","labelRef","linkWasActivatedRef","showTruncatedTooltip","setShowTruncatedTooltip","useState","onBlurWithin","useCallback","onFocusWithin","current","isTruncated","detectTruncation","focusProps","onFocusIn","onFocus","onFocusOut","onBlur","useFocusWithin","isDisabled","useFormFieldContextProps","hasTruncatedLabel","event","labelComp","jsx","fieldLabelProps","undefined","labelText","inlineUserAssistance","InlineUserAssistance","hasEmptyLabel","hasHiddenLabel","containerAria","hiddenLabelAria","linkAria","labelId","propLabelId","containerId","UNSAFE_ariaLabelledBy","useAccessibleContext","mergeIds","useLabelledLinkAria","FormFieldContext","Provider","ReadonlyTextField","role","mainContent","_jsxs","jsxs","onPointerDown","clearTimeout","setTimeout","View","width","Link","Text","size","variant"],"mappings":"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"}