/**
 * @license
 * Copyright (c) 2014, 2025, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["exports","ojs/ojdataprovider"],function(t,e){"use strict";class s{constructor(){this._responseTimes=[{time:900,count:0},{time:720,count:0},{time:600,count:0},{time:450,count:0},{time:360,count:0},{time:300,count:0}],this._requestTime={time:250,count:0},this._lastRequestTime=0}debounce(t,e){const s=this.GetDebounceTime(e);return(...e)=>{window.setTimeout(()=>{t(...e)},s)}}recordResponseTime(t,e){const s=Math.min(e,5),i=this._responseTimes[s];0===i.count?i.time=t:i.time=(i.time*i.count+t)/(i.count+1),i.count+=1}recordRequestTime(){const t=Date.now(),e=this._lastRequestTime;if(this._lastRequestTime=t,0===e)return;const s=t-e;if(s>1e3)return;const i=this._requestTime;0===i.count?i.time=s:i.time=(i.time*i.count+s)/(i.count+1),i.count+=1}_getResponseTime(t){const e=Math.min(t,5);return this._responseTimes[e].time}_getRequestTime(){return this._requestTime.time}GetDebounceTime(t){const e=this._getResponseTime(t),s=1.2*this._getRequestTime();if(e<s)return 0;return(1+(e-s)/e)*s}}var i;class r{constructor(t,e,s){this._isFirstNext=!0,this.dataProvider=t,this.debouncer=e,this.params=s}next(){if(this._isFirstNext){this.debouncer.recordRequestTime(),this._isFirstNext=!1;const t=this.params?.filterCriterion?.text,s=(e,s)=>{if(this.params?.signal?.aborted)return void s(this.params?.signal?.reason);const i=this.dataProvider.fetchFirst(this.params);this._asyncIterator=i[Symbol.asyncIterator]();const r=Date.now();this._asyncIterator.next().then(s=>{const i=Date.now();this.debouncer.recordResponseTime(i-r,t?t.length:0),e(s)},s)},i=(e,i)=>new Promise((e,i)=>{this.debouncer.debounce(s,t?t.length:0)(e,i)}).then(e,i);return e.wrapWithAbortHandling(this.params?.signal,i,!1)}return this._asyncIterator.next()}}class n{constructor(t,e,s){this[i]=()=>new r(this.dataProvider,this.debouncer,this.params),this.dataProvider=t,this.debouncer=e,this.params=s}}i=Symbol.asyncIterator;t.Debouncer=s,t.DebouncingDataProviderView=class{constructor(t){this._debouncer=new s,this.dataProvider=t}fetchFirst(t){return new n(this.dataProvider,this._debouncer,t)}fetchByKeys(t){return this.dataProvider.fetchByKeys(t)}containsKeys(t){return this.dataProvider.containsKeys(t)}fetchByOffset(t){return this.dataProvider.fetchByOffset(t)}getTotalSize(){return this.dataProvider.getTotalSize()}isEmpty(){return this.dataProvider.isEmpty()}getCapability(t){return this.dataProvider.getCapability(t)}addEventListener(t,e){this.dataProvider.addEventListener(t,e)}removeEventListener(t,e){this.dataProvider.removeEventListener(t,e)}dispatchEvent(t){return this.dataProvider.dispatchEvent(t)}},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ojdebouncingdataproviderview.js.map