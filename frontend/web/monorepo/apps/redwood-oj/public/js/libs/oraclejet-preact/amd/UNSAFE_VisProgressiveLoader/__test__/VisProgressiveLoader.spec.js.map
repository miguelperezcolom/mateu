{"version":3,"file":"VisProgressiveLoader.spec.js","sources":["../../../../src/UNSAFE_VisProgressiveLoader/__test__/VisProgressiveLoader.spec.tsx"],"sourcesContent":["import { render, screen, waitFor } from '@testing-library/preact';\nimport { expect } from 'chai';\nimport { VisProgressiveLoader } from '../';\nimport { matchTranslationBundle } from '../../utils/UNSAFE_matchTranslationBundle';\nimport { RootEnvironmentProvider } from '../../UNSAFE_Environment';\nimport type { RootEnvironment } from '../../UNSAFE_Environment';\n\nconst ariaLabel = 'ariaLabel';\nconst ariaDescribeId = 'ariaDescribeId';\nconst ariaLabelledId = 'ariaLabelledId';\nconst componentText = 'Dummy Component';\n\ndescribe('Test VisProgressiveLoader component', () => {\n  it('render (loading)', async function () {\n    await setupVisProgressiveLoader(true);\n    // There's a delay before loading indicator is shown\n    await waitFor(() => {\n      // The dummy component doesn't have role application\n      // During loading, the container should have role application\n      const target = screen.getByRole('application');\n      expect(target).not.null;\n    });\n  });\n\n  it('live region text (loading)', async function () {\n    const locale = matchTranslationBundle(['en'], new Set(['en-US', 'en']));\n    const { default: translations } = await import(`../../resources/nls/${locale}/bundle.ts`);\n\n    await setupVisProgressiveLoader(true);\n    // There's a delay before loading indicator is shown\n    await waitFor(() => {\n      // The dummy component doesn't have role application\n      // During loading, the container should have role application\n      const target = screen.getByRole('application');\n      expect(target).not.null;\n    });\n    await waitFor(() => {\n      const loadingText = screen.getByText(translations.vis_stateLoading());\n      expect(loadingText).not.null;\n    });\n  });\n\n  it('render (loaded)', async function () {\n    await setupVisProgressiveLoader(false);\n    const compText = await screen.findByText(componentText);\n    expect(compText).not.null;\n  });\n\n  it('live region text (loaded)', async function () {\n    const locale = matchTranslationBundle(['en'], new Set(['en-US', 'en']));\n    const { default: translations } = await import(`../../resources/nls/${locale}/bundle.ts`);\n\n    await setupVisProgressiveLoader(false);\n    const loadedText = await screen.findByText(translations.vis_stateLoaded());\n    expect(loadedText).not.null;\n  });\n\n  it('aria-label, aria-labelledBy and aria-describedBy is set', async function () {\n    await setupVisProgressiveLoader(true, ariaDescribeId, ariaLabelledId, ariaLabel);\n    await waitFor(() => {\n      const target = screen.getByRole('application');\n      expect(target?.getAttribute('aria-label')).equal(ariaLabel);\n    });\n    const target = screen.getByRole('application');\n    expect(target?.getAttribute('aria-labelledby')).equal(ariaLabelledId);\n    expect(target?.getAttribute('aria-describedby')).contains(ariaDescribeId);\n  });\n});\n\nconst setupVisProgressiveLoader = async (\n  isLoading?: boolean,\n  describedBy?: string,\n  labelledBy?: string,\n  label?: string\n) => {\n  const locale = matchTranslationBundle(['en'], new Set(['en-US', 'en']));\n  const { default: translations } = await import(`../../resources/nls/${locale}/bundle.ts`);\n  const env: Partial<RootEnvironment> = {\n    translations: { '@oracle/oraclejet-preact': translations }\n  };\n  const visProgressiveLoader = (\n    <VisProgressiveLoader\n      role=\"application\"\n      type=\"bar\"\n      isLoading={isLoading ?? true}\n      width=\"100x\"\n      height=\"100x\"\n      aria-label={label}\n      aria-describedby={describedBy}\n      aria-labelledby={labelledBy}>\n      <div style={{ width: '100%', height: '100%' }}>{componentText}</div>\n    </VisProgressiveLoader>\n  );\n\n  return render(\n    <RootEnvironmentProvider environment={env}>{visProgressiveLoader}</RootEnvironmentProvider>\n  );\n};\n"],"names":["ariaLabel","ariaDescribeId","ariaLabelledId","componentText","describe","it","async","setupVisProgressiveLoader","waitFor","target","screen","getByRole","expect","not","null","locale","matchTranslationBundle","Set","default","translations","__variableDynamicImportRuntime0__","loadingText","getByText","vis_stateLoading","compText","findByText","__variableDynamicImportRuntime1__","loadedText","vis_stateLoaded","getAttribute","equal","contains","isLoading","describedBy","labelledBy","label","__variableDynamicImportRuntime2__","env","visProgressiveLoader","_jsx","VisProgressiveLoader","role","type","width","height","children","style","render","RootEnvironmentProvider","environment"],"mappings":"uxDAOA,MAAMA,EAAY,YACZC,EAAiB,iBACjBC,EAAiB,iBACjBC,GAAgB,kBAEtBC,SAAS,uCAAuC,KAC9CC,GAAG,oBAAoBC,uBACfC,IAA0B,SAE1BC,EAAOA,SAAC,KAGZ,MAAMC,EAASC,EAAAA,OAAOC,UAAU,eAChCC,EAAAA,OAAOH,GAAQI,IAAIC,IAAI,GAE3B,IAEAT,GAAG,8BAA8BC,iBAC/B,MAAMS,EAASC,yBAAuB,CAAC,MAAO,IAAIC,IAAI,CAAC,QAAS,SACxDC,QAASC,i6KAAuBC,CAAO,uBAAuBL,qBAEhER,IAA0B,SAE1BC,EAAOA,SAAC,KAGZ,MAAMC,EAASC,EAAAA,OAAOC,UAAU,eAChCC,EAAAA,OAAOH,GAAQI,IAAIC,IAAI,UAEnBN,EAAOA,SAAC,KACZ,MAAMa,EAAcX,EAAAA,OAAOY,UAAUH,EAAaI,oBAClDX,EAAAA,OAAOS,GAAaR,IAAIC,IAAI,GAEhC,IAEAT,GAAG,mBAAmBC,uBACdC,IAA0B,GAChC,MAAMiB,QAAiBd,EAAAA,OAAOe,WAAWtB,IACzCS,EAAAA,OAAOY,GAAUX,IAAIC,IACvB,IAEAT,GAAG,6BAA6BC,iBAC9B,MAAMS,EAASC,yBAAuB,CAAC,MAAO,IAAIC,IAAI,CAAC,QAAS,SACxDC,QAASC,i6KAAuBO,CAAO,uBAAuBX,qBAEhER,IAA0B,GAChC,MAAMoB,QAAmBjB,EAAMA,OAACe,WAAWN,EAAaS,mBACxDhB,EAAAA,OAAOe,GAAYd,IAAIC,IACzB,IAEAT,GAAG,2DAA2DC,uBACtDC,IAA0B,EAAMN,EAAgBC,EAAgBF,SAChEQ,EAAOA,SAAC,KACZ,MAAMC,EAASC,EAAAA,OAAOC,UAAU,eAChCC,EAAMA,OAACH,GAAQoB,aAAa,eAAeC,MAAM9B,EAAU,IAE7D,MAAMS,EAASC,EAAAA,OAAOC,UAAU,eAChCC,EAAMA,OAACH,GAAQoB,aAAa,oBAAoBC,MAAM5B,GACtDU,EAAMA,OAACH,GAAQoB,aAAa,qBAAqBE,SAAS9B,EAC5D,GAAE,IAGJ,MAAMM,GAA4BD,MAChC0B,EACAC,EACAC,EACAC,KAEA,MAAMpB,EAASC,yBAAuB,CAAC,MAAO,IAAIC,IAAI,CAAC,QAAS,SACxDC,QAASC,i6KAAuBiB,CAAO,uBAAuBrB,eAChEsB,EAAgC,CACpClB,aAAc,CAAE,2BAA4BA,IAExCmB,EACJC,EAAAA,IAACC,EAAoBA,qBACnB,CAAAC,KAAK,cACLC,KAAK,MACLV,UAAWA,IAAa,EACxBW,MAAM,OACNC,OAAO,OAAM,aACDT,EAAK,mBACCF,EAAW,kBACZC,EACjBW,SAAAN,EAAAA,IAAA,MAAA,CAAKO,MAAO,CAAEH,MAAO,OAAQC,OAAQ,iBAAWzC,OAIpD,OAAO4C,EAAMA,OACXR,MAACS,EAAAA,wBAAwB,CAAAC,YAAaZ,EAAMQ,SAAAP,IAC7C"}