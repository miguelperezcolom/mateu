{"version":3,"file":"PieChart.spec.js","sources":["../../../../src/UNSAFE_PieChart/__test__/PieChart.spec.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { render, screen, fireEvent, waitFor } from '@testing-library/preact';\nimport { expect } from 'chai';\nimport { PieChart } from '../';\nimport { ComponentProps } from 'preact/compat';\nimport { MenuItem } from '#UNSAFE_Menu';\nimport { matchTranslationBundle } from '#utils/UNSAFE_matchTranslationBundle';\nimport { RootEnvironment, RootEnvironmentProvider } from '#UNSAFE_Environment';\nimport { queryAllBy } from '#utils/PRIVATE_visTestUtils/domUtil';\nimport {\n  getTestContextMenuForNoData,\n  getTestContextMenuViaKeyboard,\n  getTestContextMenuViaMouse\n} from '#utils/PRIVATE_visTestUtils/contextMenuUtils';\nimport { setupUseTextDimensionsDependenciesMock } from '#/../test/mocks/mockUseTextDimensionsDependencies';\nconst pieData = [\n  { id: 1, value: 5 },\n  { id: 2, value: 4 },\n  { id: 3, value: 4 }\n];\n\ntype PieDataItem = (typeof pieData)[0];\n\ntype actionListenerType = {\n  clicked: boolean;\n  id?: number;\n  ids?: number[];\n};\ntype PieChartProps = ComponentProps<typeof PieChart<PieDataItem['id'], PieDataItem>>;\n\ndescribe('Test PieChart component', () => {\n  beforeEach(() => {\n    setupUseTextDimensionsDependenciesMock(window);\n  });\n\n  it('render', async function () {\n    render(\n      <PieChart data={pieData} width={'400px'} height={'400px'} aria-label=\"pie chart label\" />\n    );\n    const ariaText = screen.getAllByLabelText('pie chart label');\n    expect(ariaText).not.null;\n\n    const ariaRole = screen.getByRole('application');\n    expect(ariaRole).not.null;\n  });\n  if (typeof jest === 'undefined') {\n    it('trigger context menu on mouse right click with correct context', async () => {\n      const config: ComponentProps<typeof PieChart>['contextMenuConfig'] = {\n        // The menu items returned by itemsRenderer must be valid children for the Menu component\n        itemsRenderer: () => {\n          return (\n            <>\n              <MenuItem label=\"MenuItem1\"></MenuItem>\n              <MenuItem label=\"MenuItem2\"></MenuItem>\n              <MenuItem label=\"MenuItem3\"></MenuItem>\n            </>\n          );\n        }\n      };\n      await setupPieChart({ contextMenuConfig: config });\n      const pieChart = screen.getByRole('application');\n      expect(pieChart).not.null;\n      getTestContextMenuViaMouse(pieChart);\n    });\n\n    it('trigger context menu from Keyboard (shift + f10) with correct context', async () => {\n      let type: string | undefined, menuContext;\n\n      const config: ComponentProps<typeof PieChart>['contextMenuConfig'] = {\n        // The menu items returned by itemsRenderer must be valid children for the Menu component\n        itemsRenderer: (context) => {\n          type = context.type;\n          menuContext = context;\n          return (\n            <>\n              <MenuItem label=\"MenuItem1\"></MenuItem>\n              <MenuItem label=\"MenuItem2\"></MenuItem>\n              <MenuItem label=\"MenuItem3\"></MenuItem>\n            </>\n          );\n        }\n      };\n\n      await setupPieChart({ contextMenuConfig: config });\n      const pieChart = screen.getByRole('application');\n      getTestContextMenuViaKeyboard(pieChart, menuContext, type);\n    });\n\n    it('should not trigger context menu when there is no data ', async () => {\n      const config: ComponentProps<typeof PieChart>['contextMenuConfig'] = {\n        // The menu items returned by itemsRenderer must be valid children for the Menu component\n        itemsRenderer: () => {\n          return (\n            <>\n              <MenuItem label={`MenuItem1`}></MenuItem>\n              <MenuItem label={`MenuItem2`}></MenuItem>\n              <MenuItem label={`MenuItem2`}></MenuItem>\n            </>\n          );\n        }\n      };\n\n      await setupPieChart({ contextMenuConfig: config, data: [] });\n      const pieChart = screen.getByRole('application');\n      getTestContextMenuForNoData(pieChart);\n    });\n    it('drilling with selection none', async function () {\n      const actionListenerObj: actionListenerType = { clicked: false, id: undefined };\n      const onItemDrill: PieChartProps['onItemDrill'] = (detail) => {\n        actionListenerObj.clicked = true;\n        actionListenerObj.id = detail.id;\n      };\n      const { container } = await setupPieChart({ onItemDrill, drilling: 'on' });\n      const root = container as HTMLElement;\n      const pieSlices = queryAllBy('data-oj-private-item-index');\n      const firstItem = pieSlices(root, '0')[0];\n\n      // expect(activeElement?.getAttribute('data-oj-private-item-index')).to.equal(item);\n      fireEvent.pointerUp(firstItem);\n      await waitFor(() => expect(actionListenerObj.clicked).equals(true));\n      await waitFor(() => expect(actionListenerObj.id).equals(1));\n    });\n  }\n});\n\nconst setupPieChart = async (options?: Partial<PieChartProps>) => {\n  const defaultProps = {\n    data: pieData,\n    width: '400px' as const,\n    height: '400px' as const,\n    ariaLabel: 'pie chart label'\n  };\n  const locale = matchTranslationBundle(['en'], new Set(['en-US', 'en']));\n  const { default: translations } = await import(`../../resources/nls/${locale}/bundle.ts`);\n  const env: Partial<RootEnvironment> = {\n    translations: { '@oracle/oraclejet-preact': translations }\n  };\n  const pieChartProps = { ...defaultProps, ...options };\n\n  return render(\n    <RootEnvironmentProvider environment={env}>\n      <PieChart {...pieChartProps} />\n    </RootEnvironmentProvider>\n  );\n};\n"],"names":["pieData","id","value","describe","beforeEach","setupUseTextDimensionsDependenciesMock","window","it","async","render","_jsx","PieChart","data","width","height","ariaText","screen","getAllByLabelText","expect","not","null","ariaRole","getByRole","jest","config","itemsRenderer","_jsxs","_Fragment","children","MenuItem","label","jsx","setupPieChart","contextMenuConfig","pieChart","context","actionListenerObj","clicked","undefined","container","onItemDrill","detail","drilling","root","firstItem","queryAllBy","pieSlices","fireEvent","pointerUp","waitFor","equals","options","defaultProps","ariaLabel","locale","matchTranslationBundle","Set","default","translations","__variableDynamicImportRuntime0__","env","pieChartProps","RootEnvironmentProvider","environment"],"mappings":"gwOAsBA,MAAMA,GAAU,CACd,CAAEC,GAAI,EAAGC,MAAO,GAChB,CAAED,GAAI,EAAGC,MAAO,GAChB,CAAED,GAAI,EAAGC,MAAO,IAYlBC,SAAS,2BAA2B,KAClCC,YAAW,KACTC,EAAsCA,uCAACC,OAAO,IAGhDC,GAAG,UAAUC,iBACXC,EAAAA,OACEC,EAAAA,IAACC,EAAAA,UAASC,KAAMZ,GAASa,MAAO,QAASC,OAAQ,qBAAoB,qBAEvE,MAAMC,EAAWC,EAAAA,OAAOC,kBAAkB,mBAC1CC,EAAAA,OAAOH,GAAUI,IAAIC,KAErB,MAAMC,EAAWL,EAAAA,OAAOM,UAAU,eAClCJ,EAAAA,OAAOG,GAAUF,IAAIC,IACvB,IACoB,oBAATG,OACThB,GAAG,kEAAkEC,UACnE,MAAMgB,EAA+D,CAEnEC,cAAe,IAEXC,OACEC,EAAAA,SAAA,CAAAC,SAAA,CAAAlB,EAAAA,IAACmB,EAAQA,SAAA,CAACC,MAAM,cAChBpB,EAAAqB,IAACF,WAAQ,CAACC,MAAM,cAChBpB,MAACmB,EAAAA,SAAQ,CAACC,MAAM,wBAKlBE,GAAc,CAAEC,kBAAmBT,IACzC,MAAMU,EAAWlB,EAAAA,OAAOM,UAAU,eAClCJ,EAAAA,OAAOgB,GAAUf,IAAIC,IAAI,IAI3Bb,GAAG,yEAAyEC,UAG1E,MAAMgB,EAA+D,CAEnEC,cAAgBU,GAIZT,OACEC,EAAAA,SAAA,CAAAC,SAAA,CAAAlB,EAAAA,IAACmB,EAAQA,SAAA,CAACC,MAAM,cAChBpB,EAAAqB,IAACF,WAAQ,CAACC,MAAM,cAChBpB,MAACmB,EAAAA,SAAQ,CAACC,MAAM,wBAMlBE,GAAc,CAAEC,kBAAmBT,IACxBR,EAAMA,OAACM,UAAU,cAAe,IAInDf,GAAG,0DAA0DC,UAC3D,MAAMgB,EAA+D,CAEnEC,cAAe,IAEXC,OACEC,EAAAA,SAAA,CAAAC,SAAA,CAAAlB,EAAAqB,IAACF,WAAQ,CAACC,MAAO,cACjBpB,EAAAA,IAACmB,EAAAA,SAAQ,CAACC,MAAO,cACjBpB,EAAAA,IAACmB,EAAAA,SAAQ,CAACC,MAAO,wBAMnBE,GAAc,CAAEC,kBAAmBT,EAAQZ,KAAM,KACtCI,EAAMA,OAACM,UAAU,cAAe,IAGnDf,GAAG,gCAAgCC,iBACjC,MAAM4B,EAAwC,CAAEC,SAAS,EAAOpC,QAAIqC,IAK9DC,UAAEA,SAAoBP,GAAc,CAAEQ,YAJOC,IACjDL,EAAkBC,SAAU,EAC5BD,EAAkBnC,GAAKwC,EAAOxC,EAAE,EAEuByC,SAAU,OAC7DC,EAAOJ,EAEPK,EADYC,aAAW,6BACXC,CAAUH,EAAM,KAAK,GAGvCI,YAAUC,UAAUJ,SACdK,EAAOA,SAAC,IAAM/B,EAAAA,OAAOkB,EAAkBC,SAASa,QAAO,WACvDD,EAAOA,SAAC,IAAM/B,EAAAA,OAAOkB,EAAkBnC,IAAIiD,OAAO,IAC1D,IACD,IAGH,MAAMlB,GAAgBxB,MAAO2C,IAC3B,MAAMC,EAAe,CACnBxC,KAAMZ,GACNa,MAAO,QACPC,OAAQ,QACRuC,UAAW,mBAEPC,EAASC,yBAAuB,CAAC,MAAO,IAAIC,IAAI,CAAC,QAAS,SACxDC,QAASC,i6KAAuBC,CAAO,uBAAuBL,eAChEM,EAAgC,CACpCF,aAAc,CAAE,2BAA4BA,IAExCG,EAAgB,IAAKT,KAAiBD,GAE5C,OAAO1C,EAAMA,OACXC,EAAAqB,IAAC+B,EAAuBA,wBAAA,CAACC,YAAaH,EACpChC,SAAAlB,EAAAqB,IAACpB,EAAQA,SAAK,IAAAkD,MAEjB"}