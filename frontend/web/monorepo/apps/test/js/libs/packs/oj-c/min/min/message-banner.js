/**
 * @license
 * Copyright (c) %FIRSTYEAR% %CURRENTYEAR%, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define("oj-c/hooks/UNSAFE_useDataProvider/utils",["require","exports"],(function(require,e){"use strict";function t(e,t,a,s){const n=[...s];return e.forEach(((e,s)=>{const r={data:t[s],key:a[s]?.key,metadata:a[s]};e>=0?n.splice(e,0,r):n.push(r)})),n}async function a(e,t){const a=[],s=(await e.fetchByKeys({keys:t})).results;for(const e of t)if(s.has(e)){const t=s.get(e);a.push({...t,key:e})}return a}function s(e,t){return e.has(t)?e.get(t):-1}function n(e,t){const a=[...t];return e.sort(((e,t)=>t-e)),e.forEach((e=>{e<a.length&&a.splice(e,1)})),a}Object.defineProperty(e,"__esModule",{value:!0}),e.getUpdatedItemsFromMutationDetail=async function(e,r,o){const{add:i,remove:c,update:d}=e??{},u=new Map;for(const[e,t]of r.entries())u.set(t.key,e);let l=[...r];c&&(l=function(e,t,a){const{indexes:r,keys:o}=e;let i=[...t];r?.length?i=n(r,i):o?.size&&(i=function(e,t,a){const r=[];return e.forEach((e=>{const t=s(a,e);-1!==t&&r.push(t)})),n(r,t)}(o,i,a));return i}(c,l,u));i&&(l=await async function(e,n,r,o){const{addBeforeKeys:i,data:c,indexes:d,keys:u,metadata:l}=e;let f=[...n],h=c||[],p=l||[];if(0===h.length&&u?.size){const e=await a(o,u)??[];h=e.map((e=>e.data)),p=e.map((e=>e.metadata))}0===p.length&&u?.size&&(p=[...u].map((e=>({key:e}))));h.length&&(f=d?.length?t(d,h,p,f):i?.length?function(e,a,n,r){const o=[],i=[];return e.forEach((e=>{o.push(s(r,e)),i.push({key:e})})),t(o,a,i,n)}(i,h,f,r):function(e,a,s){return t(new Array(e.length).fill(-1),e,a,s)}(h,p,f));return f}(i,l,u,o));d&&(l=await async function(e,t,n,r){const{data:o,indexes:i,keys:c,metadata:d}=e;let u=[...t],l=o||[],f=d||[];if(0===l.length&&c?.size){const e=await a(r,c)??[];l=e.map((e=>e.data)),f=e.map((e=>e.metadata))}0===f.length&&c?.size&&(f=[...c].map((e=>({key:e}))));l.length&&(i?.length?u=function(e,t,a,s){const n=[...s];return e.forEach(((e,s)=>{if(n[e]){const r={data:t[s],key:a[s]?.key,metadata:a[s]};n.splice(e,1,r)}})),n}(i,l,f,u):c?.size&&(u=function(e,t,a,n,r){const o=[...n];return e.forEach((e=>{const n=s(r,e),i={data:t[n],key:a[n]?.key,metadata:a[n]};n>=0&&o.splice(n,1,i)})),o}(c,l,f,u,n)));return u}(d,l,u,o));return l}})),define("oj-c/hooks/UNSAFE_useDataProvider/DataProviderHandler",["require","exports","./utils"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DataProviderHandler=void 0;e.DataProviderHandler=class{constructor(e,a,s){this.handleMutateEvent=async e=>{const{detail:a}=e,s=this.addBusyState("updating data from mutation event"),n=await(0,t.getUpdatedItemsFromMutationDetail)(a,this.currentData,this.dataProvider);s?.(),this.currentData=n,this.callback?.onDataUpdated?.(n)},this.handleRefreshEvent=()=>{this._fetchDataAndNotify()},this.addBusyState=a,this.callback=s,this.dataProvider=e,this.currentData=[],e.addEventListener("refresh",this.handleRefreshEvent),e.addEventListener("mutate",this.handleMutateEvent),this._fetchDataAndNotify()}destroy(){this.callback=void 0,this.currentData=[],this.dataProvider.removeEventListener("refresh",this.handleRefreshEvent),this.dataProvider.removeEventListener("mutate",this.handleMutateEvent)}async _fetchData(){const e=[],t=this.dataProvider.fetchFirst({size:-1});for await(const a of t){const t=a.data.map(((e,t)=>({data:e,key:a.metadata[t].key,metadata:a.metadata[t]})));e.push(...t)}return this.currentData=e.slice(),e}async _fetchDataAndNotify(){const e=this.addBusyState("fetching data"),t=await this._fetchData();this.callback?.onDataUpdated?.(t),e()}}})),
/**
 * @license
 * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define("oj-c/hooks/UNSAFE_useDataProvider/useDataProvider",["require","exports","preact/hooks","./DataProviderHandler"],(function(require,e,t,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.useDataProvider=function({addBusyState:e,data:s}){const[n,r]=(0,t.useState)([]),o=(0,t.useRef)();return(0,t.useEffect)((()=>(void 0!==s&&(o.current=new a.DataProviderHandler(s,e,{onDataUpdated:r})),()=>{o.current?.destroy(),o.current=void 0})),[s,e]),{data:n}}})),define("oj-c/message-banner/message-banner",["require","exports","preact/jsx-runtime","@oracle/oraclejet-preact/translationBundle","@oracle/oraclejet-preact/UNSAFE_MessageBanner","@oracle/oraclejet-preact/hooks/UNSAFE_useMessagesContext","ojs/ojvcomponent","preact/hooks","../hooks/UNSAFE_useDataProvider/useDataProvider","ojs/ojcontext","css!oj-c/message-banner/message-banner-styles.css"],(function(require,e,t,a,s,n,r,o,i,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MessageBanner=void 0;const d={error:0,warning:1,info:2,confirmation:3,none:4},u=Object.keys(d).length,l=({data:e},{data:t})=>{const a=e.severity?d[e.severity]:u,s=t.severity?d[t.severity]:u;if(a!==s)return a-s;if(e.timestamp&&t.timestamp){const a=new Date(e.timestamp).valueOf();return new Date(t.timestamp).valueOf()-a}return 0};const f=(0,r.registerCustomElement)("oj-c-message-banner",(function({data:e,detailTemplateValue:a,messageTemplates:d,type:u="section",sorting:f="severity",onOjClose:h}){const p=(0,o.useRef)(e),y=(0,o.useRef)(),[m,v]=(0,o.useState)(0),g=(0,o.useCallback)(((e="MessageBanner: busyState")=>y.current?c.getContext(y.current).getBusyContext().addBusyState({description:e}):()=>{}),[]),D=(0,o.useMemo)((()=>({addBusyState:g})),[g]);e!=p.current&&(v((e=>e+1)),p.current=e);const{data:k}=(0,i.useDataProvider)({data:e,addBusyState:g}),j=(0,o.useMemo)((()=>{if("off"===f)return k;return[...k].sort(l)}),[k,f]);return(0,t.jsx)(r.Root,{ref:y,children:(0,t.jsx)(n.MessagesContext.Provider,{value:D,children:(0,t.jsx)(s.MessageBanner,{data:j,detailRendererKey:a,renderers:d,variant:u,onClose:h},`dp-${m}`)})})}),"MessageBanner",{properties:{data:{type:"DataProvider"},type:{type:"string",enumValues:["page","section"]},detailTemplateValue:{type:"string|function"},sorting:{type:"string",enumValues:["off","severity"]}},extension:{_DYNAMIC_SLOT:{prop:"messageTemplates",isTemplate:1}},events:{ojClose:{}}},{type:"section",sorting:"severity"},{"@oracle/oraclejet-preact":a.default});e.MessageBanner=f})),define("oj-c/message-banner",["require","exports","oj-c/message-banner/message-banner"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MessageBanner=void 0,Object.defineProperty(e,"MessageBanner",{enumerable:!0,get:function(){return t.MessageBanner}})}));
//# sourceMappingURL=message-banner.js.map