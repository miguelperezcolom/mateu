define(['exports', 'preact/jsx-runtime', 'preact', 'preact/compat', 'preact/hooks', './mergeProps-bcfa6a92', './keys-4755c121', './collectionUtils-26e6c87c', './ReorderableContext-6d10a1b7', './useNavigation-a6a2218f', './LayerHost-7d4aa6d3', './useSelection-87a6bea9', 'css!./DragAndDropStyles.styles.css', 'css!./ReorderableItemStyles.styles.css', './Selector-470f114d', './HiddenAccessible-037ef42d', './LoadMoreCollection-3ac9e69e', './PRIVATE_BaseCardView/themes/BaseCardViewStyles.css', './classNames-08d99695', './refUtils-77e97004', './logger-0f873e29', './tabbableUtils-9101c0e5', './useId-c9578d26', './useAnimation-5a74955f', './useResizeObserver-25032462', './TabbableModeContext-a9c97640', './FocusTrap-d06ac102', './useUser-988f7da2', './useReorderableItem-013ac2e8', './useReorderableContext-a5453bd7', './Grid-2ddec30a', './Flex-4bc3a394', './PRIVATE_BaseCardView/themes/BaseCardViewContract.css', './Skeleton-a7e166a0', 'module', './useAddBusyState-8ed5cc58'], (function(e,t,r,s,o,n,a,i,l,c,d,u,y,m,h,g,f,x,p,b,S,v,C,R,w,I,A,E,T,j,L,k,O,K,B,P){"use strict";function M({currentKey:e,children:r,dragKey:s,setDragKey:n,onReorder:l,rootRef:c,gutterSize:d,columns:u,context:y}){const m=o.useRef(null),h=1===u,g=y.index%u==0,f=y.index%u==u-1,b=x.multiVariantStyles({itemOverlayFront:d}),S=x.multiVariantStyles({itemOverlayFrontVertical:d}),v={itemOverlayFront:h?S:b,itemOverlayRear:h?x.styles.itemOverlayRearVertical:x.styles.itemOverlayRear,itemDragger:x.styles.itemDragger},C=o.useCallback((()=>m?.current?.closest(i.ITEM_SELECTOR)),[]),R=o.useCallback((e=>{e.dataTransfer?.setData("text/cardview-items-key",JSON.stringify(y.metadata.key))}),[y.metadata.key]),{rootProps:w,isDragged:I,overlayZoneBeforeProps:A,overlayZoneAfterProps:L}=T.useReorderableItem({isDisabled:!l,dragKey:s,setDragKey:n,onReorder:l,rootRef:c,ref:m,getItem:C,setTransferData:R,itemStyles:v,itemSelector:i.ITEM_SELECTOR,isVertical:h}),{currentItemKey:k}=j.useReorderableContext();o.useEffect((()=>{e===y.metadata.key&&(k.current=e)}),[e,y,k]);const{direction:O}=E.useUser(),K="rtl"===O,B=p.classNames([A?.class,!h&&!K&&g&&x.styles.itemOverlayFrontEdge,!h&&K&&f&&x.styles.itemOverlayFrontEdge]),P=p.classNames([L?.class,!h&&!K&&f&&x.styles.itemOverlayRearEdge,!h&&K&&g&&x.styles.itemOverlayRearEdge]);return t.jsxs("div",{...w,children:[r,!I&&a.isKeyDefined(s)&&t.jsxs(t.Fragment,{children:[t.jsx("div",{...A,class:B}),t.jsx("div",{...L,class:P})]})]})}const V=e=>({animationStates:{slideUp:{from:{translateY:"50px"},to:{translateY:"0px"},options:{duration:300,delay:50*e,easing:[0,0,.2,1]}},slideDown:{from:{translateY:"-50px"},to:{translateY:"0"},options:{duration:300,delay:50*e,easing:[0,0,.2,1]}}},isAnimatedOnMount:!0}),D=(e,t,r)=>({animationStates:{opacity:{from:{opacity:0},to:{opacity:1},options:{duration:150,delay:50*e,easing:"linear"}}},isAnimatedOnMount:!0,onAnimationEnd:()=>{r?.(),t.current&&clearTimeout(t.current)}}),F=s.memo((function({children:e,context:r,isTabbable:s,isFocused:n,isFocusRingVisible:a,isSelected:i,selectionMode:l,focusBehavior:c,setIsFocusBehaviorValid:d,initialAnimation:u,isGridLayout:y,updateCardSize:m,reorderItemProps:h,onAnimationBusyStart:g,onAnimationBusyEnd:f}){const E=o.useRef(null),T=o.useRef(),j=r.metadata.key,L=r.index,k=n&&a,O=x.multiVariantStyles({itemFocused:"card"===c&&k?"isItemFocused":"isNotItemFocused",itemInitialOpacity:u?"isTransparent":"isNotTransparent",itemInGridLayout:y?"isInGridLayout":"isNotInGridLayout"}),K=p.classNames([x.styles.itemStyle,O]),B=o.useCallback((e=>{m?.(e.contentRect.width,e.contentRect.height)}),[m]),P=o.useRef(null);w.useResizeObserver(m?E:P,B),o.useLayoutEffect((()=>{if("content"===c&&k){const e=E.current?.firstElementChild?.firstElementChild,t=v.allTabbableElements(e,!0,!0);0===t.length||t.length>1?(S.warn(`${t.length} focusable elements are detected in the card. 'content' focusBehavior is intended only for use when the card has single focusable element. Please specify one focusable element in the card or switch the focusBehavior to 'card'.`),d?.(!1)):t[0].focus()}}),[c,k,d]);const{nodeRef:F,controller:_}=R.useAnimation(u||"none",V(L)),{nodeRef:z,controller:N}=R.useAnimation(u?"opacity":"none",D(L,T,f));u&&g?.(),o.useEffect((()=>{void 0!==u&&(T.current=setTimeout((()=>{_.cancel(),N.cancel(),E.current&&(E.current.style.opacity="1"),f?.()}),1e3))}),[N,_,u,f]);const U=o.useMemo((()=>void 0===u?b.mergeRefs(E):b.mergeRefs(E,F,z)),[E,F,z,u]),Y=h?t.jsx(M,{...h,context:r,children:e(r)}):e(r);return t.jsx("div",{id:C.useId(),ref:U,class:K,role:"gridcell","data-oj-key":j,onKeyDown:e=>{"card"!==c||!s||"ArrowDown"!==e.key&&"ArrowUp"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation()},"aria-selected":"none"===l?void 0:i,..."number"==typeof j&&{"data-oj-key-type":"number"},children:t.jsx(I.TabbableModeContext.Provider,{value:{isTabbable:s},children:t.jsx(A.FocusTrap,{isDisabled:!s,restoreFocusRef:!1,children:Y})})})}),((e,t)=>{return!(!e||!t)&&(e.children===t.children&&e.isTabbable===t.isTabbable&&e.isFocused===t.isFocused&&e.isFocusRingVisible===t.isFocusRingVisible&&e.isSelected===t.isSelected&&e.initialAnimation===t.initialAnimation&&e.focusBehavior===t.focusBehavior&&i.compareListItemContext(e.context,t.context)&&(r=e.reorderItemProps,s=t.reorderItemProps,r?.currentKey===s?.currentKey&&r?.dragKey===s?.dragKey&&r?.columns===s?.columns));var r,s}));function _({children:e,layout:r,gutterSize:s,columns:o}){const n=O.cardViewVars.gutterSize[s];return"grid"===r?o<1?null:t.jsx(L.Grid,{gridTemplateColumns:`repeat(${o}, 1fr)`,gap:n,children:e}):t.jsx(k.Flex,{wrap:"wrap",gap:n,children:e})}function z({children:e}){const[s,n]=o.useState(!1);return o.useEffect((()=>{setTimeout((()=>{n(!0)}),50)}),[]),s?t.jsx(r.Fragment,{children:e}):t.jsx("div",{class:f.LOADMORE_STYLE_CLASS})}const N=(e,r=25,s,o,n=!0)=>{const a=s||("flex"===e?"80x":"100%"),i=o||"85x";return[...Array(r)].map(((e,r)=>t.jsx(K.Skeleton,{width:a,height:i,borderRadius:"6px"},n&&`${r}${(new Date).getTime()}`)))},U=e=>t.jsx(z,{children:N(e.layout)}),Y=e=>{const r=[t.jsx("div",{class:f.LOADMORE_STYLE_CLASS,children:N(e.layout,1)}),...N(e.layout,24)];return t.jsx(z,{children:r})},H=()=>t.jsx("div",{class:f.LOADMORE_STYLE_CLASS}),G=e=>{if(e.colCount<1||null==e.cardWidth||null==e.cardHeight)return t.jsx(H,{});{const r=[],s=e.colCount-e.totalCount%e.colCount,o=s===e.colCount,n=`calc(${e.cardWidth}px)`,a=e.cardHeight?`calc(${e.cardHeight}px)`:"85x",i="flex"===e.layout?n:"100%",l="flex"===e.layout||o?a:"100%",c=t.jsx("div",{class:f.LOADMORE_STYLE_CLASS,children:N(e.layout,1,i,l)});return r.push(c),r.push(N(e.layout,s-1,i,l)),o||r.push(N(e.layout,e.colCount,i,a)),t.jsx(z,{children:r})}},$={all:!1,keys:new Set},W={xs:12,sm:16,md:24,lg:48,xl:64},Z=s.forwardRef((({children:e,data:s,onLoadMore:d=()=>{},hasMore:y=!1,getRowKey:m,currentItemOverride:p,onPersistCurrentItem:b,selectionMode:S="none",selectedKeys:v=$,onSelectionChange:C,onReorder:R,viewportConfig:w,focusBehavior:I="card","aria-label":A,"aria-labelledby":E,"aria-describedby":j,initialAnimation:L="slideUp",gutterSize:k="sm",columns:O,layout:K,cardSize:B,updateCardSize:M,skeletonRenderer:V},D)=>{const N=o.useRef(null);o.useImperativeHandle(D,(()=>N.current),[N]);const H=o.useRef(),Z=W[k],ee={layout:K,columns:O,gutterSize:k},{onBusyStart:te,onBusyEnd:re}=P.useAddBusyState("handling initial animation"),se=o.useRef(!0);o.useEffect((()=>{null!=B.height&&null!=B.width&&(se.current=!1)}),[B]);const oe="none"===S?void 0:"multiple"===S,ne=s?s.length:-1,[ae,ie]=o.useState(!0),le=ae?I:"card",ce=o.useRef(!1),de=null!=R,ue=o.useRef(!1),ye={ArrowUp:e=>i.getPrevNextKeyByCount(s,m,e,-O),ArrowDown:e=>i.getPrevNextKeyByCount(s,m,e,O),ArrowLeft:e=>i.getPrevNextKeyByCount(s,m,e,-1),ArrowRight:e=>i.getPrevNextKeyByCount(s,m,e,1)},{navigationProps:me,currentKey:he,isCurrentItemOverridden:ge,showFocusRing:fe,isCurrentTabbableKey:xe}=c.useNavigation(s,N,J,ye,p,b,w,void 0,"multiple"!==S,"card"===le,"card"===le,!1),pe=o.useCallback((e=>{C&&(!1===e.value.all&&e.value.keys.size>0&&(H.current=Array.from(e.value.keys.values()).pop()),C(e))}),[H,C]),be=o.useCallback((e=>{if(s&&C){const t=i.handleSelectionRange(e,s,m);Array.isArray(t)&&("shiftSpace"===e.eventType?H.current=e.value.start:H.current=e.value.end,C({value:{all:!1,keys:new Set(t)},target:null}))}}),[s,C,m]),{selectionProps:Se}=u.useSelection((e=>e===N.current?void 0===he?null:he:i.keyExtractor(e,i.ITEM_SELECTOR)),v,S,!1,"toggle",pe,H.current,he,((e,t)=>i.getPrevNextKeyByCount(s,m,e,t?-O:O)),((e,t)=>i.getPrevNextKeyByCount(s,m,e,t?-1:1)),(e=>{if(N.current){const t=i.findElementByKey(N.current,e,i.ITEM_SELECTOR);t&&t.scrollIntoView({block:"nearest"})}}),be),{reorderProps:ve,reorderItemProps:Ce,reorderContext:Re,reorderInstructionsId:we,reorderInstructions:Ie}=(({currentKey:e,onReorder:t,gutterSize:r,columns:s,rootRef:n,scrollCurrItemIntoView:a})=>{const l=null!=t,[c,d]=o.useState(void 0),{reorderProps:u,reorderContext:y,reorderInstructionsId:m,reorderInstructions:h}=T.useReorderable({onReorder:t,rootRef:n,itemSelector:i.ITEM_SELECTOR,isDisabled:!l,columns:s});return l?{reorderProps:{...u,onDragOver:e=>{i.dragToScroll(e,void 0!==c,n.current),a.current=!1}},reorderItemProps:{currentKey:e,dragKey:c,setDragKey:d,onReorder:t,rootRef:n,gutterSize:r,columns:s},reorderContext:y,reorderInstructionsId:m,reorderInstructions:h}:{reorderProps:u,reorderContext:y,reorderInstructionsId:m,reorderInstructions:h}})({currentKey:he,onReorder:R,gutterSize:k,columns:O,rootRef:N,scrollCurrItemIntoView:ce}),Ae=de&&t.jsx(t.Fragment,{children:t.jsx("span",{id:we,children:t.jsx(g.HiddenAccessible,{children:Ie})})});o.useEffect((()=>{if(de&&null!=he&&N.current){const e=i.findElementByKey(N.current,he,i.ITEM_SELECTOR);e&&ce.current&&!ge&&(e.scrollIntoView({block:"nearest"}),ce.current=!1)}}),[he,s,de,ge]);const Ee=o.useCallback((()=>{ue.current||(ue.current=!0,d())}),[ue,d]);o.useEffect((()=>{ue.current=!1}),[s,y]);const Te=o.useCallback((e=>{const r=m(e.data),s="multiple"===S?()=>t.jsx(h.Selector,{onChange:C,rowKey:r,selectedKeys:v}):void 0;return{index:e.index,data:e.data,metadata:{key:r},selector:s,isSelected:a.containsKey(v,r)}}),[S,v,C,m]),je=o.useCallback(((e,r)=>{const o=[];if(e){const e={loadingStatus:"initial"};o.push(t.jsx("div",{class:f.LOADMORE_STYLE_CLASS,children:r(e)})),o.push(q(e,24,r))}else{if(0===O)return null;const e=O-s.length%O,n=e===O,a={loadingStatus:"loadMore",height:"flex"===K||n?Q(B.height):"100%",width:"flex"===K?Q(B.width):"100%"};o.push(t.jsx("div",{class:f.LOADMORE_STYLE_CLASS,children:r(a)})),o.push(Array(q(a,e-1,r))),n||o.push(q(a,O,r))}return t.jsx(z,{children:o})}),[B,O,s,K]),Le=s?!s.length&&y?V?je(!0,V):t.jsx(Y,{layout:K}):V?je(!1,V):t.jsx(G,{layout:K,colCount:O,totalCount:s.length,cardWidth:B.width,cardHeight:B.height}):null;w=i.getViewportConfig(N,w);const ke=t.jsx("div",{role:"row",children:t.jsx(_,{...ee,children:t.jsx(f.LoadMoreCollection,{data:s,hasMore:y,onLoadMore:Ee,loadMoreIndicator:Le,loadMoreThreshold:Z+4,viewportConfig:w,children:r=>{const o=Te(r),n=xe(o.metadata.key),a=he===o.metadata.key&&!n,i=a&&fe,l=o.isSelected,c=!!s&&o.index===s.length-1;return(r=>t.jsx(F,{context:r,isTabbable:n,isFocused:a,isFocusRingVisible:i,isGridLayout:"grid"===K,isSelected:l,selectionMode:S,focusBehavior:le,...0===o.index&&se.current&&{onAnimationBusyStart:te},...c&&se.current&&{onAnimationBusyEnd:re},..."content"===I&&{setIsFocusBehaviorValid:ie},...se.current&&{initialAnimation:L},...0===o.index&&!B.width&&{updateCardSize:M},...de&&{reorderItemProps:Ce},children:e},o.metadata.key))(o)}})})}),Oe=t.jsx(_,{...ee,children:V?X(V):t.jsx(U,{layout:K})});return t.jsxs("div",{...n.mergeProps(me,Se,ve,{onKeyDown:e=>{"content"===le&&"Tab"===e.key&&N.current?.focus({preventScroll:!0});de&&(e.metaKey||e.ctrlKey)&&e.shiftKey&&["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)&&(ce.current=!0)}}),ref:N,role:"grid",class:x.styles.baseStyle,tabIndex:0,"aria-label":A,"aria-labelledby":E,"aria-describedby":de?we+" "+j:j,"aria-multiselectable":oe,"aria-rowcount":1,"aria-colcount":ne,children:[t.jsx(l.ReorderableContext.Provider,{value:Re,children:s?s.length||y?ke:t.jsx(r.Fragment,{}):Oe}),Ae]})})),J=e=>e.id,X=e=>t.jsx(z,{children:q({loadingStatus:"initial"},25,e)}),q=(e,t,r)=>Array(t).fill(r(e)),Q=e=>`calc(${e}px)`,ee=Z;e.BaseCardView=ee,e.getColCount=(e,t,r)=>{if(!t||!r)return 0;const s=Math.floor((r+e)/(e+t));return Math.max(1,s)},e.gutterSizeToPX=W}));
//# sourceMappingURL=BaseCardView-bc694015.js.map
