{"version":3,"file":"useOutsideClick-9c4ceb18.js","sources":["../../src/hooks/UNSAFE_useOutsideClick/useOutsideClick.ts"],"sourcesContent":["/**\n * `useClickOutside` hook for capturing clicking outside of an element\n */\nimport type { RefObject } from 'preact';\nimport { useEffect, useRef } from 'preact/hooks';\nimport { coerceArray } from '../../utils/UNSAFE_arrayUtils';\nimport { LOGICAL_PARENT } from '../../UNSAFE_Layer/Layer';\nimport { MODAL_OVERLAY, BackdropElement } from '#UNSAFE_Modal/hooks/useModal';\n\ntype Props = {\n  /**\n   * If true outside click is disabled\n   */\n  isDisabled?: boolean;\n  /**\n   * Reference to element or array of elements relative to which outside click is performed\n   */\n  ref: RefObject<HTMLElement> | RefObject<HTMLElement>[];\n  /**\n   * Outside click callback\n   */\n  handler?: (event: MouseEvent) => void;\n};\n\n/**\n * Checks if the mouse event target is inside of any of the specified containers, or if it\n * occurs in a layer whose 'logicalParent' belongs to one of the containers.\n *\n * @param event a mouse event associated with the potential \"outside click\" action\n * @param ref an array of references to elements that are considered \"inside\"\n * @returns 'true' if the event occurs \"outside\" of the specified list of containers\n */\nconst isPointOutside = (event: Event, ref: RefObject<HTMLElement>[]) => {\n  const target = event.target as HTMLElement;\n\n  // if the event has no target, consider it \"inside\"\n  if (!target) {\n    return false;\n  }\n\n  const doc = getDocument(target);\n  if (!doc.contains(target)) {\n    return false;\n  }\n\n  // if the target is contained in any of the target containers, it is not \"outside\"\n  if (ref.some((elRef: RefObject<HTMLElement>) => elRef.current?.contains(target))) {\n    return false;\n  }\n\n  const findLogicalParent = (elem: Element): Element | null => {\n    let elemParent = elem.parentElement as any;\n    while (elemParent) {\n      if (elemParent[LOGICAL_PARENT]) {\n        return elemParent[LOGICAL_PARENT];\n      }\n      elemParent = elemParent.parentElement;\n    }\n    return null;\n  };\n\n  const parentLayerContainsTarget = (element: HTMLElement | null, target: Node): boolean => {\n    const parentLayer = element?.closest('[data-oj-layer]');\n    if (parentLayer && parentLayer.contains(target)) {\n      return true;\n    }\n    return false;\n  };\n\n  // Check if the target is logically owned by any of the refs\n  let logicalParent = findLogicalParent(target);\n  while (logicalParent) {\n    if (ref.some((elRef: RefObject<HTMLElement>) => elRef.current?.contains(logicalParent))) {\n      return false;\n    }\n    logicalParent = findLogicalParent(logicalParent);\n  }\n\n  // if the click target is a modal overlay and it is part of target's modal layer\n  // then it's an outside click. Otherwise, treat the click as an \"inside\" click because\n  // it is a click on another modal overlay which must be above our elem\n  if ((target as BackdropElement)[MODAL_OVERLAY]) {\n    if (\n      !ref.some((elRef: RefObject<HTMLElement>) => {\n        const modalParent = elRef.current?.closest('[data-oj-layer=\"modal\"]');\n        return modalParent && modalParent.contains(target);\n      })\n    ) {\n      return false;\n    } else {\n      return true;\n    }\n  }\n\n  // if the target is a child of a modal layer other than any of the refs,\n  // the click occurs in another modal layer which must be above our elem\n  const modalParent = target.closest('[data-oj-layer=\"modal\"]');\n  if (\n    modalParent &&\n    !ref.some((elRef: RefObject<HTMLElement>) => modalParent.contains(elRef.current))\n  ) {\n    return false;\n  }\n\n  // lastly, look for target's parent based purely on the layer hierarchy\n  if (\n    ref.some((elRef: RefObject<HTMLElement>) => parentLayerContainsTarget(elRef.current, target))\n  ) {\n    return false;\n  }\n\n  return true;\n};\n\nconst getDocument = (node?: Node): Document => node?.ownerDocument ?? document;\n\nexport const useOutsideClick = ({ isDisabled: disabled = false, ref, handler }: Props) => {\n  // use ref to store mutable data and not cause a re-render\n  const mouseDownTargetRef = useRef<EventTarget | null>(null);\n\n  useEffect(() => {\n    const refs = coerceArray(ref);\n    if (\n      !handler ||\n      disabled ||\n      (refs.length > 0 && refs.findIndex((elRef) => elRef.current === null) > -1)\n    )\n      return;\n    const onMouseDown = (event: MouseEvent) => {\n      mouseDownTargetRef.current = event.target;\n    };\n\n    const onMouseUp = (event: MouseEvent) => {\n      if (mouseDownTargetRef.current === event.target && isPointOutside(event, refs)) {\n        handler?.(event);\n      }\n      mouseDownTargetRef.current = null;\n    };\n    const firstElRef = refs[0];\n    const doc = getDocument(firstElRef.current!);\n    if (doc) {\n      doc.addEventListener('mousedown', onMouseDown, true);\n      doc.addEventListener('mouseup', onMouseUp, true);\n\n      return () => {\n        doc.removeEventListener('mousedown', onMouseDown, true);\n        doc.removeEventListener('mouseup', onMouseUp, true);\n      };\n    }\n    return undefined;\n  }, [disabled, handler, ref]);\n};\n"],"names":["getDocument","node","ownerDocument","document","isDisabled","disabled","ref","handler","mouseDownTargetRef","useRef","useEffect","refs","coerceArray","length","findIndex","elRef","current","onMouseDown","event","target","onMouseUp","contains","some","findLogicalParent","elem","elemParent","parentElement","LOGICAL_PARENT","logicalParent","MODAL_OVERLAY","modalParent","closest","element","parentLayer","parentLayerContainsTarget","isPointOutside","firstElRef","doc","addEventListener","removeEventListener"],"mappings":"qIAgCA,MAkFMA,EAAeC,GAA0BA,GAAMC,eAAiBC,2BAEvC,EAAGC,WAAYC,GAAW,EAAOC,MAAKC,cAEnE,MAAMC,EAAqBC,SAA2B,MAEtDC,EAAAA,WAAU,KACR,MAAMC,EAAOC,cAAYN,GACzB,IACGC,GACDF,GACCM,EAAKE,OAAS,GAAKF,EAAKG,WAAWC,GAA4B,OAAlBA,EAAMC,WAAqB,EAEzE,OACF,MAAMC,EAAeC,IACnBV,EAAmBQ,QAAUE,EAAMC,MAAM,EAGrCC,EAAaF,IACbV,EAAmBQ,UAAYE,EAAMC,QArGxB,EAACD,EAAcZ,KACpC,MAAMa,EAASD,EAAMC,OAGrB,IAAKA,EACH,OAAO,EAIT,IADYnB,EAAYmB,GACfE,SAASF,GAChB,OAAO,EAIT,GAAIb,EAAIgB,MAAMP,GAAkCA,EAAMC,SAASK,SAASF,KACtE,OAAO,EAGT,MAAMI,EAAqBC,IACzB,IAAIC,EAAaD,EAAKE,cACtB,KAAOD,GAAY,CACjB,GAAIA,EAAWE,EAAAA,gBACb,OAAOF,EAAWE,EAAAA,gBAEpBF,EAAaA,EAAWC,aACzB,CACD,OAAO,IAAI,EAYb,IAAIE,EAAgBL,EAAkBJ,GACtC,KAAOS,GAAe,CACpB,GAAItB,EAAIgB,MAAMP,GAAkCA,EAAMC,SAASK,SAASO,KACtE,OAAO,EAETA,EAAgBL,EAAkBK,EACnC,CAKD,GAAKT,EAA2BU,EAAAA,eAC9B,QACGvB,EAAIgB,MAAMP,IACT,MAAMe,EAAcf,EAAMC,SAASe,QAAQ,2BAC3C,OAAOD,GAAeA,EAAYT,SAASF,EAAO,IAWxD,MAAMW,EAAcX,EAAOY,QAAQ,2BACnC,QACED,IACCxB,EAAIgB,MAAMP,GAAkCe,EAAYT,SAASN,EAAMC,YAOxEV,EAAIgB,MAAMP,GA7CsB,EAACiB,EAA6Bb,KAC9D,MAAMc,EAAcD,GAASD,QAAQ,mBACrC,SAAIE,IAAeA,EAAYZ,SAASF,GAG5B,EAwCgCe,CAA0BnB,EAAMC,QAASG,KAK5E,EAsB4CgB,CAAejB,EAAOP,IACvEJ,IAAUW,GAEZV,EAAmBQ,QAAU,IAAI,EAE7BoB,EAAazB,EAAK,GAClB0B,EAAMrC,EAAYoC,EAAWpB,SACnC,OAAIqB,GACFA,EAAIC,iBAAiB,YAAarB,GAAa,GAC/CoB,EAAIC,iBAAiB,UAAWlB,GAAW,GAEpC,KACLiB,EAAIE,oBAAoB,YAAatB,GAAa,GAClDoB,EAAIE,oBAAoB,UAAWnB,GAAW,EAAK,QANvD,CASgB,GACf,CAACf,EAAUE,EAASD,GAAK"}