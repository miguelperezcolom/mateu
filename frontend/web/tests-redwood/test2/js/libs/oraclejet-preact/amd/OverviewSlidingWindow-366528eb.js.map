{"version":3,"file":"OverviewSlidingWindow-366528eb.js","sources":["../../src/PRIVATE_VisOverview/OverviewSlidingWindow.tsx","../../src/PRIVATE_VisOverview/useOverviewEvents.ts"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { useRef } from 'preact/hooks';\nimport { OverviewProps } from './overview.types';\nimport { styles } from './themes/VisOverview.css';\nimport { useOverviewEvents } from './useOverviewEvents';\nimport { OverviewHorizontalDragHandleIcon } from '#PRIVATE_ThemedIcons/OverviewHorizontalDragHandleIcon';\nimport { isTouch } from '#utils/UNSAFE_visUtils/clientUtils';\n\nconst OVERVIEW_HANDLE_SIZE = 16;\nconst OVERVIEW_HANDLE_ACTIVATION_SIZE = isTouch() ? 30 : 10;\n\nexport function OverviewSlidingWindow({\n  x,\n  width,\n  height,\n  y,\n  windowX,\n  windowHeight,\n  windowWidth,\n  windowY,\n  hasHandles,\n  onWindowDimsChange\n}: OverviewProps) {\n  const rootRef = useRef(null);\n  const overviewProps = useOverviewEvents({\n    x,\n    y,\n    width,\n    height,\n    windowHeight,\n    windowWidth,\n    windowX,\n    windowY,\n    rootRef,\n    onWindowDimsChange\n  });\n  const handleIconY = windowY + 0.5 * (windowHeight - OVERVIEW_HANDLE_SIZE);\n  return (\n    <g ref={rootRef} {...(hasHandles ? overviewProps : {})}>\n      <rect x={x} y={y} width={width} height={height} fill=\"transparent\"></rect>\n      <rect\n        data-oj-private-object=\"window\"\n        cursor=\"move\"\n        x={windowX}\n        y={windowY}\n        height={windowHeight - 1}\n        width={windowWidth - 1}\n        class={styles.overviewWindow}></rect>\n      {hasHandles && (\n        <>\n          <g transform={`translate(${windowX} ${handleIconY})`}>\n            <OverviewHorizontalDragHandleIcon color=\"primary\" />\n          </g>\n\n          <g\n            transform={`translate(${windowX + windowWidth - OVERVIEW_HANDLE_SIZE} ${handleIconY})`}>\n            <OverviewHorizontalDragHandleIcon color=\"primary\" />\n          </g>\n\n          <rect\n            x={windowX}\n            y={windowY}\n            height={windowHeight}\n            width={OVERVIEW_HANDLE_ACTIVATION_SIZE}\n            strokeWidth=\"1\"\n            data-oj-private-object=\"leftHandle\"\n            fill=\"transparent\"\n            stroke=\"transparent\"\n            cursor=\"col-resize\"></rect>\n          <rect\n            x={windowX + windowWidth - OVERVIEW_HANDLE_ACTIVATION_SIZE}\n            y={windowY}\n            strokeWidth=\"1\"\n            height={windowHeight}\n            data-oj-private-object=\"rightHandle\"\n            width={OVERVIEW_HANDLE_ACTIVATION_SIZE}\n            stroke=\"transparent\"\n            fill=\"transparent\"\n            cursor=\"col-resize\"></rect>\n        </>\n      )}\n    </g>\n  );\n}\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { getElementData } from '#utils/UNSAFE_visUtils';\nimport type { RefObject } from 'preact';\nimport { useRef, useCallback, useState } from 'preact/hooks';\n\nconst OVERVIEW_MIN_SIZE = 20;\n\ntype Props = {\n  /**\n   * The width of the overview.\n   */\n  width: number;\n\n  /**\n   * The height of the overview.\n   */\n  height: number;\n\n  /**\n   * The x coordinate of the overview.\n   */\n  x: number;\n\n  /**\n   * The y coordinate of the overview.\n   */\n  y: number;\n\n  /**\n   * The x2 coordinate of the overview window.\n   */\n  windowX: number;\n\n  /**\n   * The y2 coordinate of the overview window.\n   */\n  windowY: number;\n\n  /**\n   * The height of the overview window.\n   */\n  windowHeight: number;\n\n  /**\n   * The width of the overview window.\n   */\n  windowWidth: number;\n\n  /**\n   * The rootRef.\n   */\n  rootRef: RefObject<HTMLDivElement>;\n\n  /**\n   * The callback to call when window dims change.\n   */\n\n  onWindowDimsChange?: ({ deltaWidth, deltaX }: { deltaX: number; deltaWidth: number }) => void;\n};\n\nexport function useOverviewEvents({\n  x,\n  width,\n  windowX,\n  windowWidth,\n  rootRef,\n  windowHeight,\n  windowY,\n  onWindowDimsChange\n}: Props) {\n  const pointerDownPointRef = useRef<{ x: number; y: number }>();\n  const [lastPoint, setLastPoint] = useState<{ x: number; y: number }>();\n\n  const onPointerDown = useCallback(\n    (event: PointerEvent) => {\n      pointerDownPointRef.current = { x: event.offsetX, y: event.offsetY };\n      (event.target as Element).setPointerCapture(event.pointerId);\n      setLastPoint({ x: event.offsetX, y: event.offsetY });\n    },\n    [pointerDownPointRef]\n  );\n\n  const onPointerUp = useCallback(\n    (event: PointerEvent) => {\n      const { offsetX: clickX, offsetY: clickY } = event;\n      const isPointerUpFar =\n        Math.abs(pointerDownPointRef.current!.x - clickX) > OVERVIEW_MIN_SIZE / 4;\n      pointerDownPointRef.current = undefined;\n      setLastPoint(undefined);\n      if (\n        (clickX <= windowX + windowWidth &&\n          clickX >= windowX &&\n          clickY <= windowY + windowHeight &&\n          clickY >= windowY) ||\n        isPointerUpFar\n      ) {\n        return;\n      }\n\n      const newX = Math.min(x + width - windowWidth, Math.max(clickX - windowWidth / 2, x));\n\n      onWindowDimsChange?.({ deltaX: newX - windowX, deltaWidth: 0 });\n    },\n    [pointerDownPointRef, windowHeight, windowX, windowY, windowWidth, width, x, onWindowDimsChange]\n  );\n\n  const onPointerMove = useCallback(\n    (event: PointerEvent) => {\n      const targetType = getElementData(rootRef, event.target as HTMLElement)?.['ojPrivateObject'];\n      if (\n        !pointerDownPointRef.current ||\n        event.target == null ||\n        targetType == null ||\n        lastPoint == null\n      ) {\n        return;\n      }\n\n      let deltaX = 0;\n      let deltaWidth = 0;\n      if (targetType === 'window') {\n        const delta = event.offsetX - lastPoint.x;\n        deltaX = Math.min(x + width - windowWidth, Math.max(x, windowX + delta)) - windowX;\n      } else if (\n        targetType === 'leftHandle' &&\n        event.offsetX <= windowX + windowWidth - OVERVIEW_MIN_SIZE / 2 &&\n        event.offsetX > x\n      ) {\n        deltaX = Math.max(x, windowX + event.offsetX - lastPoint.x) - windowX;\n        deltaWidth = -1 * deltaX;\n      } else if (\n        targetType === 'rightHandle' &&\n        event.offsetX >= windowX + OVERVIEW_MIN_SIZE / 2 &&\n        event.offsetX < x + width\n      ) {\n        deltaWidth = Math.min(event.offsetX - lastPoint.x, x + width - windowX);\n      }\n      setLastPoint({ x: event.offsetX, y: event.offsetY });\n      onWindowDimsChange?.({ deltaX, deltaWidth });\n      event.stopPropagation();\n    },\n    [pointerDownPointRef, rootRef, x, lastPoint, width, windowX, windowWidth, onWindowDimsChange]\n  );\n\n  return {\n    onPointerDown,\n    onPointerUp,\n    onPointerMove\n  };\n}\n"],"names":["OVERVIEW_HANDLE_ACTIVATION_SIZE","isTouch","x","width","height","y","windowX","windowHeight","windowWidth","windowY","hasHandles","onWindowDimsChange","rootRef","useRef","overviewProps","pointerDownPointRef","lastPoint","setLastPoint","useState","onPointerDown","useCallback","event","current","offsetX","offsetY","target","setPointerCapture","pointerId","onPointerUp","clickX","clickY","isPointerUpFar","Math","abs","OVERVIEW_MIN_SIZE","undefined","newX","min","max","deltaX","deltaWidth","onPointerMove","targetType","getElementData","delta","stopPropagation","useOverviewEvents","handleIconY","_jsxs","ref","children","_jsx","fill","jsx","cursor","class","styles","overviewWindow","_Fragment","transform","OverviewHorizontalDragHandleIcon","SvgDragH","color","strokeWidth","stroke"],"mappings":"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"}