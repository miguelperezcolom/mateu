/**
 * @license
 * Copyright (c) 2014, 2025, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["exports","ojs/ojcore","jquery","ojs/ojlogger","ojdnd","ojs/ojlistview"],function(t,e,i,r,s,n){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var a="default"in i?i.default:i;const o=function(t){this.listview=t};e._registerLegacyNamespaceProp("ListViewDndContext",o),e.Object.createSubclass(o,e.Object,"oj.ListViewDndContext"),o.C_KEY=67,o.V_KEY=86,o.X_KEY=88,o.CUT_COMMAND="cut",o.COPY_COMMAND="copy",o.PASTE_COMMAND="paste",o.PASTE_BEFORE_COMMAND="pasteBefore",o.PASTE_AFTER_COMMAND="pasteAfter",o.prototype.reset=function(){this._unsetSelectionDraggable(),this.m_itemsDragged=null,this.m_dragImage=null,this.m_currentDragItem=null,this.m_dragItems=null,this.m_contextMenuItem=null,this.m_cachedOffset=null,this.m_dropTarget=null,this.m_firstDropTarget=null},o.prototype._getDndOptions=function(t){var e=this.listview.GetOption("dnd");return null!=e&&e[t]?e[t].items:null},o.prototype._getDragOptions=function(){return this._getDndOptions("drag")},o.prototype._getDropOptions=function(){return this._getDndOptions("drop")},o.prototype.IsItemReOrdering=function(){return"enabled"===this._getDndOptions("reorder")},o.prototype.GetDragAffordanceClass=function(){return"oj-listview-drag-handle"},o.prototype.GetDragImageClass=function(){return"oj-listview-drag-image"},o.prototype.GetDragItemClass=function(){return"oj-listview-drag-item"},o.prototype.GetCutStyleClass=function(){return"oj-listview-cut"},o.prototype.GetCommandPrefix=function(){return"oj-listview-"},o.prototype._findItem=function(t){return a(t).get(0).classList.contains("oj-listview-first-drop-target")?a(this.m_dropTargetElem):this.listview.FindItem(t)},o.prototype._getSelectedItems=function(t){var e=[];if(this.listview._isSelectionEnabled())for(var i=this.listview.GetOption("selection"),r=0;r<i.length;r++){var s=this.listview.FindElementByKey(i[r]);null==s||this.listview.SkipFocus(a(s))||e.push(s)}else{var n=this._getActiveItem();null!=n&&e.push(n)}return!t&&null!=this.m_contextMenuItem&&this.m_contextMenuItem.length>0&&(this.listview.element.get(0).contains(this.m_contextMenuItem.get(0))?-1===e.indexOf(this.m_contextMenuItem.get(0))&&(e=[this.m_contextMenuItem.get(0)]):this.m_contextMenuItem=null),e},o.prototype._getActiveItem=function(){return null==this.listview.m_active?null:this.listview.m_active.elem[0]},o.prototype.itemRenderComplete=function(t,e){a(t).hasClass(this.listview.getItemStyleClass())||(t=t.firstElementChild);var i=a(t).find("."+this.GetDragAffordanceClass());null!=i&&i.length>0&&this.listview._isTouchSupport()&&i.attr("draggable","true"),i.attr("tabindex","-1")},o.prototype._unsetSelectionDraggable=function(){this.m_draggableSelection&&a.each(this.m_draggableSelection,function(t,e){a(e).removeClass("oj-draggable"),this.listview._isTouchSupport()&&a(e).removeAttr("draggable")}.bind(this))},o.prototype.setSelectionDraggable=function(){var t=[];this._unsetSelectionDraggable();for(var e=this.listview.GetOption("selection"),i=0;i<e.length;i++){var r=this.listview.FindElementByKey(e[i]);null==r||this.listview.SkipFocus(a(r))||(t.push(r),a(r).addClass("oj-draggable"),this.listview._isTouchSupport()&&a(r).attr("draggable","true"))}this.m_draggableSelection=t},o.prototype._setItemDraggable=function(t){var e=this.GetDragAffordanceClass(),i=t.find("."+e);return null!=i&&i.length>0||(t.addClass("oj-draggable"),!1)},o.prototype._unsetItemDraggable=function(t){t.removeClass("oj-draggable")},o.prototype._setDraggable=function(t){if(null!=this._getDragOptions()||this.IsItemReOrdering()){var e,i=this.GetDragAffordanceClass();if(t.hasClass(i))e=a(t);else{var r=this._findItem(t);if(this.shouldDragCurrentItem())e=r;else{if(null!=r)if(this._setItemDraggable(r))return;var s=this._getSelectedItems(!0);s.length>0&&(null!=r&&s.indexOf(r[0])>-1?e=r:a(s[0]).removeClass("oj-draggable"))}}null!=e&&e.attr("draggable",!0)}},o.prototype._unsetDraggable=function(t){if(null!=this._getDragOptions()||this.IsItemReOrdering()){var e,i=this.GetDragAffordanceClass();null!=(e=t.hasClass(i)?a(t):this._findItem(t))&&(e.removeAttr("draggable"),this._unsetItemDraggable(e))}},o.prototype.isDndInProgress=function(){return null!=this.m_dragImage},o.prototype._invokeDndCallback=function(t,e,i,s){var n,a="drag"===t?this._getDragOptions():this._getDropOptions();if(a){var o=a[e];if(o&&"function"==typeof o)try{this.listview.ojContext._IsCustomElement()?(o(i.originalEvent,s),i.originalEvent.defaultPrevented&&i.preventDefault()):(i.dataTransfer=i.originalEvent.dataTransfer,n=o(i,s))}catch(t){r.error("Error: "+t)}else n=-1}else n=-1;return n},o.prototype._setDragItemDataTransfer=function(t,e,i){for(var r=[],s=0;s<i.length;s++){var n=this.listview._getDataForItem(i[s]);n&&(n.innerHTML&&n.tagName&&"LI"===n.tagName?r.push(n.innerHTML):r.push(n))}return r.length>0?(this._setDragItemData(t.originalEvent,e,r),this.SetDragItemImage(t.originalEvent,i),{items:r}):null},o.prototype._setDragItemData=function(t,e,i){var r=t.dataTransfer,s=JSON.stringify(i);if("string"==typeof e)r.setData(e,s);else if(e)for(var n=0;n<e.length;n++)r.setData(e[n],s);r.setData(this.GetDragSourceType(),this.listview.element.get(0).id)},o.prototype._createDragImage=function(){var t=document.createElement("ul");if(t.className=this.listview.element.get(0).className,t.classList.add(this.GetDragImageClass()),this.listview.ojContext._IsCustomElement()){var e=["oj-component","oj-complete"].concat(this.listview.GetContainerStyleClass().split(" "));this.listview.GetRootElement().get(0).classList.forEach(function(i){-1===e.indexOf(i)&&t.classList.add(i)})}return t},o.prototype._calculateOffset=function(t){var e=window.getComputedStyle(t);return parseFloat(e.marginLeft)+parseFloat(e.marginRight)+parseFloat(e.paddingLeft)+parseFloat(e.paddingRight)+parseFloat(e.borderLeftWidth)+parseFloat(e.borderRightWidth)},o.prototype._calculateAffordanceOffset=function(t,e){if(null==this.m_cachedOffset){this.m_cachedOffset=Math.max(0,e.offsetLeft-t.offsetLeft)+e.offsetWidth/2;var i=this.listview.isCardLayout(),r="rtl"===this.listview.ojContext._GetReadingDirection(),s=this._calculateOffset(t);i&&r&&(s+=this.listview.getListContainer().get(0).offsetWidth);var n=this._calculateOffset(this.listview.getListContainer().get(0));this.m_cachedOffset+=Math.max(n,s-n)}return this.m_cachedOffset},o.prototype.SetDragItemImage=function(t,e){var i,r,s,n=0,o=0,l=t.target,h=this.listview.isCardLayout();if(e.length>1){var d;(i=a(this._createDragImage())).css({width:this.listview.element.css("width"),height:this.listview.element.css("height")});var m=Number.MAX_VALUE;for(d=0;d<e.length;d++)m=Math.min(m,e[d].offsetTop);for(d=0;d<e.length;d++){r=e[d].offsetTop-m;var p=e[d].offsetWidth;(s=a(e[d].cloneNode(!0))).removeClass("oj-selected oj-focus oj-hover").css({position:"absolute",top:r,width:p}),h||s.addClass("oj-listview-item-drag-image"),i.append(s)}}else a(l).hasClass(this.GetDragAffordanceClass())?(r=0,a.contains(e[0],l.offsetParent)&&(r=l.offsetTop),n=this._calculateAffordanceOffset(e[0],l),o=r+l.offsetHeight/2):(n=Math.max(0,t.offsetX),o=Math.max(0,t.offsetY)),(s=a(e[0].cloneNode(!0))).removeClass("oj-selected oj-focus oj-hover").addClass("oj-drag"),h||s.addClass("oj-listview-item-drag-image"),(i=a(this._createDragImage())).css({width:this.GetDragImageWidth(e[0]),height:2*e[0].offsetHeight}).append(s);h&&i.addClass("oj-listview-card-layout"),a("body").append(i),this.m_dragImage=i,t.dataTransfer.setDragImage(i.get(0),n,o)},o.prototype.GetDragImageWidth=function(){return this.listview.element.css("width")},o.prototype.GetDefaultDataType=function(){return"text/ojlistview-items-data"},o.prototype._handleDragStart=function(t){var e,i,r=this._getDragOptions();if((null!=r||this.IsItemReOrdering())&&(e=null!=r?r.dataTypes:this.GetDefaultDataType(),a(t.target).hasClass(this.GetDragAffordanceClass())||this.shouldDragCurrentItem()?(i=[]).push(this._findItem(t.target)[0]):i=this._getSelectedItems(!0),i.length>0)){this.m_dragItems=i,this.m_currentDragItem=a(i[0]);var s=this._setDragItemDataTransfer(t,e,i);if(s){var n=this._invokeDndCallback("drag","dragStart",t,s);if(-1===n)return;return n}return!1}},o.prototype._handleDrag=function(t){return this._invokeDndCallback("drag","drag",t)},o.prototype._destroyDragImage=function(){null!=this.m_dragImage&&(this.m_dragImage.remove(),this.m_dragImage=null)},o.prototype._handleDragEnd=function(t){if(this.m_dragEndCallCheck&&(window.cancelAnimationFrame(this.m_dragEndCallCheck),this.m_dragEndCallCheck=null),null!=this.m_currentDragItem&&null!=this.m_dragItems){this.m_currentDragItem.find("."+this.GetDragAffordanceClass()).removeAttr("draggable"),this.m_currentDragItem.removeClass("oj-drag oj-draggable").removeAttr("draggable");for(var e=0;e<this.m_dragItems.length;e++){var i=this.m_dragItems[e];i.classList.remove("oj-listview-drag-source"),i.classList.remove(this.GetDragItemClass()),a(i).css("display","")}}this._cleanupDropTarget(),this._destroyDragImage(),this._unsetSelectionDraggable(),this._invokeDndCallback("drag","dragEnd",t),this.m_itemsDragged=this.m_dragItems,this.m_dragImage=null,this.m_currentDragItem=null,this.m_dragItems=null,this.listview.restoreFocusAfterDrag()},o.prototype._matchDragDataType=function(t){var e=this._getDropOptions();if(e&&e.dataTypes)for(var i=e.dataTypes,r="string"==typeof i?[i]:i,s=t.originalEvent.dataTransfer.types,n=0;n<s.length;n++)if(r.indexOf(s[n])>=0)return!0;return!1},o.prototype._invokeDropCallback=function(t,e,i){var r=this._invokeDndCallback("drop",t,e,i);return void 0!==r&&-1!==r||this._matchDragDataType(e)&&e.preventDefault(),r},o.prototype._getDropIndicator=function(){return null!=this.m_dragItems?"space":"line"},o.prototype._createDropTarget=function(t){var e,i=this._getDropIndicator();null==this.m_dropTarget&&("space"===i?(e=a(t.get(0).cloneNode(!1))).addClass("oj-drop").removeClass("oj-drag oj-draggable oj-hover oj-focus").css({display:"block",height:t.outerHeight(),width:t.outerWidth()}):"line"===i&&(e=document.createElement("li")).classList.add("oj-listview-drop-target"),this.m_dropTarget=a(e));var r=t.get(0);if("line"===i){r.classList.add("oj-drop"),null!=this.m_dropTargetElem&&this.m_dropTargetElem.classList.remove("oj-drop"),this.m_dropTargetElem=r;var s=r.offsetTop+r.offsetHeight-this._getDropIndicatorHeight();null==r.nextElementSibling&&this.listview._isGridlinesVisible()&&(s-=1),this.m_dropTarget.get(0).style.top=s+"px"}else"space"===i&&(this.m_dropTarget.get(0).key=r.key);return this.m_dropTarget},o.prototype._getDropIndicatorHeight=function(){if(!isNaN(this.m_dropIndicatorHeight))return this.m_dropIndicatorHeight;if(this.m_dropTarget){var t=this.m_dropTarget.get(0);return this.listview.element.get(0).appendChild(t),this.m_dropIndicatorHeight=t.offsetHeight,this.listview._isGridlinesVisible()&&(this.m_dropIndicatorHeight-=1),this.m_dropIndicatorHeight}return 0},o.prototype._cleanupGroupItem=function(){null!=this.m_currentDropItem&&-1===this.m_dropTargetIndex&&this.m_currentDropItem.children("."+this.listview.getGroupItemStyleClass()).removeClass("oj-drop")},o.prototype._cleanupEmptyList=function(){null!=this.m_currentDropItem&&this.m_currentDropItem.hasClass(this.listview.getEmptyTextStyleClass())&&(this.m_currentDropItem.removeClass("oj-drop"),this.m_currentDropItem.get(0).textContent=this.listview._getEmptyText())},o.prototype._cleanupDropTarget=function(){null!=this.m_dropTarget&&(this.m_dropTarget.css("height","0"),this.m_dropTarget.remove(),this.m_dropTarget=null),null!=this.m_dropTargetElem&&this.m_dropTargetElem.classList.remove("oj-drop"),null!=this.m_firstDropTarget&&(this.m_firstDropTarget.parentNode&&this.m_firstDropTarget.parentNode.removeChild(this.m_firstDropTarget),this.m_firstDropTarget=null),this._cleanupEmptyList(),this._cleanupGroupItem()},o.prototype._handleDragEnter=function(t){var e=this._findItem(t.target);if(null!=e&&e.length>0){var i=this._invokeDropCallback("dragEnter",t,{item:e.get(0)});if(-1!==i)return i}},o.prototype._setCurrentDropItem=function(t){null!=this.m_currentDropItem&&this.m_currentDropItem.removeClass("oj-valid-drop oj-invalid-drop"),this.m_currentDropItem=t,this.m_currentDropItem.addClass("oj-valid-drop")},o.prototype._setAccInfo=function(t,e){var i=t.attr("aria-label");null==i&&(i=t.text());var r="accessibleReorder"+e.charAt(0).toUpperCase()+e.substr(1)+"Item",s=this.listview.ojContext.getTranslatedString(r,{item:i});this.listview._setAccInfoText(s)},o.prototype._adjustGroupItemStyle=function(){null==this.m_maxHeightAdjusted&&this.listview._isTouchSupport()&&(this.listview.element.find("ul."+this.listview.getGroupStyleClass()).each(function(){a(this).attr("oldMaxHeight",a(this).css("maxHeight").toString()),a(this).css("maxHeight",1e4)}),this.m_maxHeightAdjusted="adjusted")},o.prototype._restoreGroupItemStyle=function(){this.listview._isTouchSupport()&&this.listview.element.find("ul."+this.listview.getGroupStyleClass()).each(function(){a(this).css("maxHeight",parseInt(a(this).attr("oldMaxHeight"),10)),a(this).removeAttr("oldMaxHeight")}),this.m_maxHeightAdjusted=null},o.prototype._setDropPosition=function(t,e){if("line"===this._getDropIndicator())return e.insertAfter(t),"after";var i=t.index();return null==this.m_dropTargetIndex||this.m_dropTargetIndex<i?(e.insertAfter(t),"after"):(e.insertBefore(t),"before")},o.prototype._checkFirstItemDropTarget=function(t,e,i){if(i.classList.contains("oj-listview-first-drop-target"))return this.m_dropPosition="before",void(e.style.top="0px");if("line"===this._getDropIndicator())if(null===t.previousElementSibling)if(null==this.m_firstDropTarget){var r=document.createElement("li");r.classList.add("oj-listview-first-drop-target"),r.style.top="0px",t.parentNode.appendChild(r),this.m_firstDropTarget=r}else this.m_dropPosition="after",e.style.top=t.offsetTop+t.offsetHeight-this._getDropIndicatorHeight()+"px";else this.m_firstDropTarget&&(this.m_firstDropTarget.parentNode&&this.m_firstDropTarget.parentNode.removeChild(this.m_firstDropTarget),this.m_firstDropTarget=null)},o.prototype._isDropOnDragItem=function(t,e){return this._matchDragDataType(t)&&null!=this.m_dragItems&&this.m_dragItems.length>=0&&this.m_dragItems[0].key===e.get(0).key},o.prototype._handleDragOver=function(t){var e,i,r;if(this._adjustGroupItemStyle(),null!=this.m_dragItems&&"none"!==a(this.m_dragItems[0]).css("display"))if(e=a(this.m_dragItems[0]),-1===(r=this._invokeDropCallback("dragOver",t,{item:e.get(0)}))&&this.IsItemReOrdering()&&this.isDndInProgress()||!1===r||t.isDefaultPrevented()){i=this._createDropTarget(e);for(var s=0;s<this.m_dragItems.length;s++)a(this.m_dragItems[s]).addClass(this.GetDragItemClass()).css("display","none");i.insertBefore(e),this.m_dropTargetIndex=i.index()}else e.get(0).classList.remove("oj-hover"),e.get(0).classList.add("oj-listview-drag-source");else if(null!=(e=this._findItem(t.target))&&e.length>0){if(this._isDropOnDragItem(t,e)){if(r=this._invokeDndCallback("drop","dragOver",t,{item:e.get(0)}),!t.isDefaultPrevented())return-1}else r=this._invokeDropCallback("dragOver",t,{item:e.get(0)});-1===r&&this.IsItemReOrdering()&&this.isDndInProgress()||!1===r||t.isDefaultPrevented()?(e.hasClass(this.listview.getItemStyleClass())?(this._cleanupGroupItem(),e.hasClass("oj-drop")?i=this.m_dropTarget:(i=this._createDropTarget(e),this.m_dropPosition=this._setDropPosition(e,i),this._setAccInfo(e,this.m_dropPosition),this._setCurrentDropItem(e),this.m_dropTargetIndex=i.index()),this._checkFirstItemDropTarget(e.get(0),i.get(0),t.target)):(this._cleanupDropTarget(),e.children("."+this.listview.getGroupItemStyleClass()).addClass("oj-drop"),this._setCurrentDropItem(e),this.m_dropTargetIndex=-1,this.m_dropPosition="inside",this._setAccInfo(e,this.m_dropPosition)),t.preventDefault()):a(t.target).hasClass(this.listview.getGroupStyleClass())||(e.addClass("oj-invalid-drop"),this._cleanupDropTarget())}else{var n=this._getAndUpdateEmptyItem();null!=n&&n.length>0&&(this._setCurrentDropItem(n),t.preventDefault())}return r},o.prototype._getAndUpdateEmptyItem=function(){var t=this.listview.element.children("."+this.listview.getEmptyTextStyleClass());return 0===t.length?t=a(this.listview.element[0].querySelector(".oj-listview-no-data-item")):t.get(0).textContent="",t.addClass("oj-drop"),t},o.prototype._isDndEventInElement=function(t,e){var i=e.getBoundingClientRect(),r=t.originalEvent;return r.clientX>=i.left&&r.clientX<i.right&&r.clientY>=i.top&&r.clientY<i.bottom},o.prototype._handleDragLeave=function(t){var e;if(null!=this.m_currentDropItem){var i=this._findItem(t.target);return null!=i&&i.length>0?(i.removeClass("oj-valid-drop oj-invalid-drop"),e=this._invokeDropCallback("dragLeave",t,{item:i.get(0)}),!this._isDndEventInElement(t,t.currentTarget)&&i.hasClass("oj-drop")&&(this._cleanupDropTarget(),this._restoreGroupItemStyle())):this._isDndEventInElement(t,t.currentTarget)||this._cleanupEmptyList(),-1!==e?e:void 0}},o.prototype._isEmptyItem=function(t){return t.hasClass(this.listview.getEmptyTextStyleClass())||t.hasClass("oj-listview-no-data-item")},o.prototype._handleDrop=function(t){if(null!=this.m_currentDropItem){var e,i=t.originalEvent.dataTransfer.getData(this.GetDragSourceType());e=this._isEmptyItem(this.m_currentDropItem)?{}:{item:this.m_currentDropItem.get(0),position:this.m_dropPosition},this.IsItemReOrdering()&&i===this.listview.element.get(0).id?e.reorder=!0:e.reorder=!1,null!=this.m_currentDropItem&&this.m_currentDropItem.removeClass("oj-valid-drop"),this._cleanupDropTarget(),this._restoreGroupItemStyle(),this._destroyDragImage();var r=this._invokeDropCallback("drop",t,e);if(e.reorder&&(e.items=null==this.m_dragItems?this.m_itemsDragged:this.m_dragItems,this.listview.Trigger("reorder",t,this.CreateReorderPayload(e.items,e.position,e.item)),t.preventDefault(),this.m_dragEndCallCheck=window.requestAnimationFrame(()=>{this.m_currentDragItem&&this._handleDragEnd(t)})),this.m_currentDropItem=null,this.m_dropTargetIndex=-1,this.m_dropPosition=null,this.m_itemsDragged=null,-1!==r)return r}},o.prototype._doReorderHelper=function(t,e,r){let s,n,a,o=[],l="before";const h=this.listview.FindElementByKey(e);if(null==h)throw new Error("invaild key");if(o.push(h),"groupKey"in r&&(a=this.listview.FindElementByKey(r.groupKey),null==a))throw i.error("invalid group key");if("groupIndex"in r&&r.groupIndex){let t=this.listview.element[0].querySelectorAll(".oj-listview-element > ."+this.listview.getItemElementStyleClass()+"> ."+this.listview.getGroupStyleClass());for(let e=0;e<r.groupIndex.length;e++){if(a=t[r.groupIndex[e]],null==a)throw i.error("invaild group index ");t=a.querySelectorAll("."+this.listview.getItemElementStyleClass()+"> ."+this.listview.getGroupStyleClass())}}if(a){let t=a.querySelectorAll("ul > ."+this.listview.getItemElementStyleClass());if(0===t.length&&(l="inside",n=this.listview.GetKey(a)),"itemIndex"in r&&r.itemIndex){for(let e=0;e<t.length;e++)if(r.itemIndex===e){n=this.listview.GetKey(t[e]);break}if(null==n)throw i.error("invalid itemIndex")}else null==n&&(n=this.listview.GetKey(t[t.length-1]),l="after")}if(null==n&&"key"in r){let t=this.listview.element[0].querySelectorAll("ul > ."+this.listview.getItemElementStyleClass());null!==r.key?n=r.key:(n=this.listview.GetKey(t[t.length-1]),l="after")}if(null==n&&"index"in r&&r.index){let t=this.listview.element[0].querySelectorAll("."+this.listview.GetStyleClass()+" > ."+this.listview.getItemElementStyleClass());for(let e=0;e<t.length;e++)if(r.index===e){n=this.listview.GetKey(t[e]);break}}if(null!==n&&(s=this.listview.FindElementByKey(n)),null==s)throw new Error("invaild reference position");this.listview.Trigger("reorder",t,this.CreateReorderPayload(o,l,s))},o.prototype.CreateReorderPayload=function(t,e,i){return{items:t,position:e,reference:i}},o.prototype.prepareContextMenu=function(t){var e=this,i=a(t);this.m_contextMenu!==t&&(this.m_contextMenu=t,"OJ-MENU"===t.tagName?(t.addEventListener("ojBeforeOpen",this._handleContextMenuBeforeOpen.bind(this)),t.addEventListener("ojAction",this._handleContextMenuSelect.bind(this))):(i.on("ojbeforeopen",this._handleContextMenuBeforeOpen.bind(this)),i.on("ojselect",this._handleContextMenuSelect.bind(this))));var r=this._getCommands(t,function(t,i){var r=e._buildContextMenuItem(i,t.tagName);"OJ-OPTION"===t.tagName?(t.innerHTML=r.get(0).innerHTML,a(t).attr("data-oj-command",r.attr("data-oj-command"))):(r.get(0).className=a(t).get(0).className,a(t).replaceWith(r))});this.m_menuItemsSet=r,r.length>0&&i.data("oj-ojMenu")&&("OJ-MENU"===t.tagName?t.refresh():a(t).ojMenu("refresh"))},o.prototype._getDndContextMenuItemSelector=function(){var t=this,e="",i=["cut","copy","paste","paste-before","paste-after","pasteBefore","pasteAfter"];return this.m_dndMenuItemSelector||(i.forEach(function(r,s){e+="[data-oj-command="+t.GetCommandPrefix()+r+"],",e+="[data-oj-command="+r+"]",s<i.length-1&&(e+=",")}),this.m_dndMenuItemSelector=e),this.m_dndMenuItemSelector},o.prototype._getCommands=function(t,e){var i=this,r=[];return a(t).find(this._getDndContextMenuItemSelector()).each(function(){var t;0===a(this).children("a").length?0===a(this).attr("data-oj-command").indexOf(i.GetCommandPrefix())&&(t=a(this).attr("data-oj-command").substring(i.GetCommandPrefix().length),e&&e(this,t)):(t=a(this).attr("data-oj-command"))===o.PASTE_BEFORE_COMMAND?t="paste-before":t===o.PASTE_AFTER_COMMAND&&(t="paste-after"),t&&r.push(t)}),r},o.prototype._buildContextMenuItem=function(t,e){return"paste-before"===t?this._buildContextMenuListItem(o.PASTE_BEFORE_COMMAND,e):"paste-after"===t?this._buildContextMenuListItem(o.PASTE_AFTER_COMMAND,e):this._buildContextMenuListItem(t,e)},o.prototype._buildContextMenuListItem=function(t,e){var i=a(document.createElement(e));return i.attr("data-oj-command",t),i.append(this._buildContextMenuLabel(t,"OJ-OPTION"===e)),i},o.prototype._buildContextMenuLabel=function(t,e){var i="label"+t.charAt(0).toUpperCase()+t.slice(1),r=document.createTextNode(this.listview.ojContext.getTranslatedString(i));return e?r:a('<a href="#"></a>').append(r)},o.prototype._handleCut=function(t){null!=this.m_clipboard&&a(this.m_clipboard).removeClass(this.GetCutStyleClass());var e=this.GetCutItems(t);this.listview.ojContext.element.focus(),a(e).addClass(this.GetCutStyleClass()),this.m_clipboard=e,this.listview.Trigger("cut",t,{items:e})},o.prototype.GetCutItems=function(t){return this._getSelectedItems()},o.prototype._handleCopy=function(t){null!=this.m_clipboard&&a(this.m_clipboard).removeClass(this.GetCutStyleClass());var e=this._getSelectedItems();this.m_clipboard=e,this.listview.Trigger("copy",t,{items:e})},o.prototype._handlePaste=function(t,e,i){this.listview.Trigger("paste",t,{item:e.get(0)}),a(this.m_clipboard).removeClass(this.GetCutStyleClass()),this.listview.Trigger("reorder",t,this.CreateReorderPayload(this.m_clipboard,i,e.get(0))),this.m_clipboard=null},o.prototype._handleContextMenuSelect=function(t,e){if(null!=this.m_contextMenuItem)switch((e?e.item:a(t.target)).attr("data-oj-command")){case o.CUT_COMMAND:this._handleCut(t);break;case o.COPY_COMMAND:this._handleCopy(t);break;case o.PASTE_COMMAND:this._handlePaste(t,this.m_contextMenuItem,"inside"),this.m_contextMenuItem=null;break;case o.PASTE_BEFORE_COMMAND:this._handlePaste(t,this.m_contextMenuItem,"before"),this.m_contextMenuItem=null;break;case o.PASTE_AFTER_COMMAND:this._handlePaste(t,this.m_contextMenuItem,"after"),this.m_contextMenuItem=null}},o.prototype._appendToMenuContainer=function(t,e){null!=this.m_menuItemsSet&&("paste-before"===e?e=o.PASTE_BEFORE_COMMAND:"paste-after"===e&&(e=o.PASTE_AFTER_COMMAND),t.find("[data-oj-command='"+e+"']").removeClass("oj-disabled"))},o.prototype._handleContextMenuBeforeOpen=function(t,e){var i,r=e?e.openOptions.position.of:t.detail.openOptions.position.of;if(r&&(r.target?i=this.listview.FindItem(r.target):r.hasClass&&r.hasClass(this.listview.getItemStyleClass())&&(i=r)),this.IsItemReOrdering()){var s=a(t.target);s.find(this._getDndContextMenuItemSelector()).addClass("oj-disabled"),null!=i&&null!=this.m_menuItemsSet&&0!==this.m_menuItemsSet.length?(i.children().first().hasClass(this.listview.getGroupItemStyleClass())?null!=this.m_clipboard&&this._appendToMenuContainer(s,"paste"):(this._appendToMenuContainer(s,"cut"),this._appendToMenuContainer(s,"copy"),null!=this.m_clipboard&&(this._appendToMenuContainer(s,"paste-before"),this._appendToMenuContainer(s,"paste-after"))),"OJ-MENU"!==s.get(0).tagName&&s.ojMenu("refresh"),this.m_contextMenuItem=i):"OJ-MENU"!==s.get(0).tagName&&s.ojMenu("refresh")}else this.m_contextMenuItem=i},o.prototype.HandleKeyDown=function(t){if(t.ctrlKey||t.metaKey){var e=t.keyCode;if(e===o.X_KEY||e===o.C_KEY||e===o.V_KEY){var i=this.listview.ojContext._GetContextMenu();if(null==i)return!1;var r=this._getCommands(i);if(0===r.length)return!1;if(e===o.X_KEY&&r.indexOf("cut")>-1)return this._handleCut(t),!0;if(e===o.C_KEY&&r.indexOf("copy")>-1)return this._handleCopy(t),!0;if(e===o.V_KEY){var s,n=a(this._getActiveItem());if(null!=this.m_clipboard){if(n.children().first().hasClass(this.listview.getGroupItemStyleClass())?r.indexOf("paste")>-1&&(s="inside"):r.indexOf("paste-before")>-1?s="before":r.indexOf("paste-after")>-1&&(s="after"),null!=s)return this._handlePaste(t,n,s),!0}else this.listview.Trigger("paste",t,{item:n.get(0)})}}}return!1},o.prototype.shouldDragCurrentItem=function(){return!1},o.prototype.GetDragSourceType=function(){return"text/ojlistview-dragsource-id"},t.ListViewDndContext=o,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ojlistviewdnd.js.map