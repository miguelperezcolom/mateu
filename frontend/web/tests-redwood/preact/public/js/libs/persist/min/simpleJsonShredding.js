/**
 * Copyright (c) 2017, Oracle and/or its affiliates.
 * All rights reserved.
 */

define(["./persistenceUtils","./impl/logger"],(function(e,r){"use strict";return{getShredder:function(n,t,s){return function(i){r.log("Offline Persistence Toolkit simpleJsonShredding: Shredding Response");var a=i.clone(),o=a.headers.get("Etag");return a.text().then((function(i){var a=[],c=[],d="collection";if(i&&i.length>0)try{var u=JSON.parse(i);if(Array.isArray(u))a=u.map((function(e){if(t instanceof Array){var r=[];return t.forEach((function(n){r.push(e[n])})),r}return e[t]})),c=u;else{if(t instanceof Array){var f=[];t.forEach((function(e){f.push(u[e])})),a[0]=f}else a[0]=u[t];c[0]=u,d="single"}}catch(e){r.log("Offline Persistence Toolkit simpleRestJsonShredding: Error during shredding: "+e)}var l=e._mapData(a,c,s);return[{name:n,resourceIdentifier:o,keys:l.keys,data:l.data,resourceType:d}]}))}},getUnshredder:function(n){return function(t,s){return r.log("Offline Persistence Toolkit simpleJsonShredding: Unshredding Response"),Promise.resolve().then((function(){if(!t||1!==t.length)throw new Error({message:"shredded data is not in the correct format."});var r=e._unmapData(t[0].keys,t[0].data,n),i=function(e){var r=e[0].data;return r&&1===r.length&&"single"===e[0].resourceType?r[0]:r}([{keys:r.keys,data:r.data,resourceType:t[0].resourceType}]);return e.setResponsePayload(s,i)})).then((function(e){return e.headers.set("x-oracle-jscpt-cache-expiration-date",""),e}))}}}}));