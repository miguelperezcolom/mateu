/**
 * @license
 * Copyright (c) 2014, 2025, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["ojs/ojcore-base","ojs/ojdataprovider","ojs/ojeventtarget","ojs/ojobservable"],function(t,e,s,i){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;
/**
     * @preserve Copyright 2013 jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */
class r{constructor(t,s){var n;this.dataProvider=t,this.options=s,this._noFilterSupport=!1,this._totalFilteredRowCountObservable=null,this.AsyncIterable=(n=class{constructor(t,e){this._parent=t,this._asyncIterator=e,this[Symbol.asyncIterator]=()=>this._asyncIterator}},Symbol.asyncIterator,n),this.AsyncIterator=class{constructor(t,e,s){this._parent=t,this._nextFunc=e,this._params=s}next(){const t=this._params?.signal;return e.wrapWithAbortHandling(t,t=>t(this._nextFunc(this._params)),!1)}},this.AsyncIteratorYieldResult=class{constructor(t,e){this._parent=t,this.value=e,this[r._VALUE]=e,this[r._DONE]=!1}},this.AsyncIteratorReturnResult=class{constructor(t,e){this._parent=t,this.value=e,this[r._VALUE]=e,this[r._DONE]=!0}},this.FetchListResult=class{constructor(t,e,s,i,n){this._parent=t,this.fetchParameters=e,this.data=s,this.metadata=i,this.totalFilteredRowCount=n,this[r._FETCHPARAMETERS]=e,this[r._DATA]=s,this[r._METADATA]=i,e&&"enabled"===e.includeFilteredRowCount&&(this[r._TOTALFILTEREDROWCOUNT]=n)}},this.Item=class{constructor(t,e,s){this._parent=t,this.metadata=e,this.data=s,this[r._METADATA]=e,this[r._DATA]=s}},this.ItemMetadata=class{constructor(t,e){this._parent=t,this.key=e,this[r._KEY]=e}},this.FetchListParameters=class{constructor(t,e,s,i,n,h,l,a){this._parent=t,this.params=e,this.size=s,this.sortCriteria=i,this.filterCriterion=n,this.attributes=h,this.signal=l,this.includeFilteredRowCount=a,e&&Object.keys(e).forEach(t=>{this[t]=e[t]}),this[r._SIZE]=s,i&&(this[r._SORTCRITERIA]=i),n&&(this[r._FILTERCRITERION]=n),h&&(this[r._FETCHATTRIBUTES]=h),l&&(this[r._SIGNAL]=l),a&&(this[r._INCLUDEFILTEREDROWCOUNT]=a)}},this.FetchByKeysParameters=class{constructor(t,e,s,i){this._parent=t,this.keys=e,this.params=s,this.attributes=i,s&&Object.keys(s).forEach(t=>{this[t]=s[t]}),e&&(this[r._KEYS]=e),i&&(this[r._FETCHATTRIBUTES]=i)}},this.FetchByOffsetParameters=class{constructor(t,e,s,i,n,h,l,a,T){this._parent=t,this.offset=e,this.params=s,this.size=i,this.sortCriteria=n,this.filterCriterion=h,this.attributes=l,this.signal=a,this.includeFilteredRowCount=T,s&&Object.keys(s).forEach(t=>{this[t]=s[t]}),i&&(this[r._SIZE]=i),n&&(this[r._SORTCRITERIA]=n),e&&(this[r._OFFSET]=e),h&&(this[r._FILTERCRITERION]=h),l&&(this[r._FETCHATTRIBUTES]=l),a&&(this[r._SIGNAL]=a),T&&(this[r._INCLUDEFILTEREDROWCOUNT]=T)}},this.FetchByKeysResults=class{constructor(t,e,s){this._parent=t,this.fetchParameters=e,this.results=s,this[r._FETCHPARAMETERS]=e,this[r._RESULTS]=s}},this.ContainsKeysResults=class{constructor(t,e,s){this._parent=t,this.containsParameters=e,this.results=s,this[r._CONTAINSPARAMETERS]=e,this[r._RESULTS]=s}},this.FetchByOffsetResults=class{constructor(t,e,s,i,n){this._parent=t,this.fetchParameters=e,this.results=s,this.done=i,this.totalFilteredRowCount=n,this[r._FETCHPARAMETERS]=e,this[r._RESULTS]=s,this[r._DONE]=i,e&&"enabled"===e.includeFilteredRowCount&&(this[r._TOTALFILTEREDROWCOUNT]=n)}},this[r._INTERNAL_FROM]=null==this.options?null:this.options[r._FROM],this[r._INTERNAL_OFFSET]=null==this.options?0:this.options[r._OFFSET]>0?this.options[r._OFFSET]:0,this[r._INTERNAL_SORTCRITERIA]=null==this.options?null:this.options[r._SORTCRITERIA],this[r._INTERNAL_DATAMAPPING]=null==this.options?null:this.options[r._DATAMAPPING],this[r._INTERNAL_FETCHATTRIBUTES]=null==this.options?null:this.options[r._FETCHATTRIBUTES],this[r._INTERNAL_FILTERCRITERION]=null==this.options?null:this.options[r._FILTERCRITERION],this._addEventListeners(t),"enabled"===this.options?.includeFilteredRowCount&&(this._totalFilteredRowCountObservable=new i.BehaviorSubject({type:"notFetched"})),t.getCapability&&!t.getCapability("filter")&&(this._noFilterSupport=!0),Object.defineProperty(this,"from",{set(t){this[r._INTERNAL_FROM]=t,this.dispatchEvent(new e.DataProviderRefreshEvent)},get(){return this[r._INTERNAL_FROM]},enumerable:!0}),Object.defineProperty(this,"offset",{set(t){this[r._INTERNAL_OFFSET]=t,this.dispatchEvent(new e.DataProviderRefreshEvent)},get(){return this[r._INTERNAL_OFFSET]},enumerable:!0}),Object.defineProperty(this,"sortCriteria",{set(t){this[r._INTERNAL_SORTCRITERIA]=t,this.dispatchEvent(new e.DataProviderRefreshEvent)},get(){return this[r._INTERNAL_SORTCRITERIA]},enumerable:!0}),Object.defineProperty(this,"dataMapping",{set(t){this[r._INTERNAL_DATAMAPPING]=t,this.dispatchEvent(new e.DataProviderRefreshEvent)},get(){return this[r._INTERNAL_DATAMAPPING]},enumerable:!0}),Object.defineProperty(this,"attributes",{set(t){this[r._INTERNAL_FETCHATTRIBUTES]=t,this.dispatchEvent(new e.DataProviderRefreshEvent)},get(){return this[r._INTERNAL_FETCHATTRIBUTES]},enumerable:!0}),Object.defineProperty(this,"filterCriterion",{set(t){this[r._INTERNAL_FILTERCRITERION]=t,this.getTotalFilteredRowCountObservable()?.next({type:"notFetched"}),this.dispatchEvent(new e.DataProviderRefreshEvent)},get(){return this[r._INTERNAL_FILTERCRITERION]},enumerable:!0})}getTotalFilteredRowCountObservable(){return this._totalFilteredRowCountObservable}containsKeys(t){return this.dataProvider[r._CONTAINSKEYS]?this.dataProvider[r._CONTAINSKEYS](t):this.fetchByKeys(t).then(e=>{const s=new Set;return t[r._KEYS].forEach(t=>{null!=e[r._RESULTS].get(t)&&s.add(t)}),Promise.resolve(new this.ContainsKeysResults(this,t,s))})}fetchByKeys(t){const s=null!=t?t[r._KEYS]:null;let i=null!=t?t[r._FETCHATTRIBUTES]:null;null==i&&(i=this[r._INTERNAL_FETCHATTRIBUTES]);const n=t?.signal;return e.wrapWithAbortHandling(n,e=>{const n=new this.FetchByKeysParameters(this,s,t,i);if(this.dataProvider[r._FETCHBYKEYS])return e(this.dataProvider[r._FETCHBYKEYS](n).then(t=>{const e=t[r._RESULTS],s=new Map;return e.forEach((t,e)=>{const i=this._getMappedItems([t]);s.set(e,i[0])}),new this.FetchByKeysResults(this,n,s)}));{const s=new this.FetchListParameters(this,null,r._DEFAULT_SIZE,null,null,i),h=new Map,l=this.dataProvider[r._FETCHFIRST](s)[Symbol.asyncIterator]();return e(this._fetchNextSet(t,l,h).then(t=>{const e=new Map;return t.forEach((t,s)=>{const i=this._getMappedItems([t]);e.set(s,i[0])}),new this.FetchByKeysResults(this,n,e)}))}},!1)}fetchByOffset(t){const s=null!=t?t[r._OFFSET]:null,i=null!=t?t[r._SIZE]:null;let n=null!=t?t[r._FETCHATTRIBUTES]:null;null==n&&(n=this[r._INTERNAL_FETCHATTRIBUTES]);let h=null!=t?t[r._SORTCRITERIA]:null;null==h&&(h=this[r._INTERNAL_SORTCRITERIA]),this.getTotalFilteredRowCountObservable()?.next({type:"notFetched"});const l=this._getMappedSortCriteria(h),a=this._combineFilters(t),T=t?.signal;return e.wrapWithAbortHandling(T,e=>{const h=this._getMappedFilterCriterion(a),_=new this.FetchByOffsetParameters(this,s,t,i,l,h,n,T,this.options?.includeFilteredRowCount);return e(this.dataProvider[r._FETCHBYOFFSET](_).then(t=>{const e=t[r._RESULTS],s=t[r._DONE],i=t[r._TOTALFILTEREDROWCOUNT],n=new Array;e.forEach(t=>{const e=this._getMappedItems([t]);n.push(e[0])});const h=t[r._FETCHPARAMETERS],l=h?.[r._SORTCRITERIA],a=h?.[r._FILTERCRITERION],T=this._getUnmappedSortCriteria(l),E=this._getUnmappedFilterCriterion(a);return this._updateFilteredRowCountObservable(i,_),new this.FetchByOffsetResults(this,{..._,sortCriteria:T,filterCriterion:E},n,s,i)}))},!1)}fetchFirst(t){this.getTotalFilteredRowCountObservable()?.next({type:"notFetched"});const e={};e[r._ITEMS]=[],e[r._DONE]=!1,e[r._STARTINDEX]=0,e[r._LASTDONEHASDATA]=!1;const s=null!=t?t[r._SIZE]:null,i=t?.signal;let n=null!=t?t[r._SORTCRITERIA]:null;null==n&&(n=this[r._INTERNAL_SORTCRITERIA]);const h=this._getMappedSortCriteria(n),l=this._combineFilters(t),a=this._getMappedFilterCriterion(l);let T=null!=t?t[r._FETCHATTRIBUTES]:null;if(null==T&&(T=this[r._INTERNAL_FETCHATTRIBUTES]),null==this[r._INTERNAL_FROM]&&this[r._INTERNAL_OFFSET]>0){let n=this[r._INTERNAL_OFFSET];return new this.AsyncIterable(this,new this.AsyncIterator(this,(t=>()=>{const e=new this.FetchByOffsetParameters(this,n,null,s,h,a,T,i,this.options?.includeFilteredRowCount);return this.dataProvider[r._FETCHBYOFFSET](e).then(e=>{const i=e.results;n+=i.length;const h=this._getMappedItems(i);this._cacheResult(t,h),t[r._DONE]=e[r._DONE];const l=e[r._TOTALFILTEREDROWCOUNT],a=h.map(t=>t[r._DATA]),T=h.map(t=>t[r._METADATA]),_=e[r._FETCHPARAMETERS],E=null!=_?_[r._SORTCRITERIA]:null,o=null!=_?_[r._FILTERCRITERION]:null,R=this._getUnmappedSortCriteria(E),A=this._getUnmappedFilterCriterion(o),I=new this.FetchByOffsetParameters(this,this[r._INTERNAL_OFFSET],null,s,R,A);return this._updateFilteredRowCountObservable(l,I),t[r._DONE]?Promise.resolve(new this.AsyncIteratorReturnResult(this,new this.FetchListResult(this,I,a,T,l))):Promise.resolve(new this.AsyncIteratorYieldResult(this,new this.FetchListResult(this,I,a,T,l)))})})(e),t))}{const n=new this.FetchListParameters(this,t,s,h,a,T,i,this.options?.includeFilteredRowCount),l=this.dataProvider[r._FETCHFIRST](n)[Symbol.asyncIterator]();return new this.AsyncIterable(this,new this.AsyncIterator(this,((e,s)=>()=>e[r._LASTDONEHASDATA]?(e[r._LASTDONEHASDATA]=!1,Promise.resolve(new this.AsyncIteratorReturnResult(this,new this.FetchListResult(this,t,[],[],this._totalFilteredRowCount)))):s.next().then(i=>{let n=i[r._VALUE];n||(n={data:[],metadata:[],fetchParameters:null});const h=n[r._DATA],l=n.totalFilteredRowCount,T=n[r._METADATA],_=h.map((t,e)=>new this.Item(this,T[e],h[e]));this._noFilterSupport&&this._filterResult(a,_);const E=this._getMappedItems(_);this._cacheResult(e,E),e[r._DONE]=i[r._DONE];const o=null!=t?t[r._SIZE]:null,R=(null!=t&&t[r._OFFSET],n[r._FETCHPARAMETERS]),A=null!=R?R[r._SORTCRITERIA]:null,I=null!=R?R[r._FILTERCRITERION]:null,u=this._getUnmappedSortCriteria(A),c=this._getUnmappedFilterCriterion(I),N=new this.FetchListParameters(this,t,o,u,c);return this._fetchUntilKey(N,this[r._INTERNAL_FROM],e,s).then(()=>this._fetchUntilOffset(N,this[r._INTERNAL_OFFSET]+e[r._STARTINDEX],h.length,e,s,l))}))(e,l),t))}}getCapability(t){return this.dataProvider.getCapability(t)}getTotalSize(){return this.dataProvider.getTotalSize()}isEmpty(){return this.dataProvider.isEmpty()}_fetchNextSet(e,s,i){return s.next().then(n=>{let h=n[r._VALUE];h||(h={data:[],metadata:[],fetchParameters:null});const l=h[r._DATA],a=h[r._METADATA],T=a.map(t=>t[r._KEY]);let _=!0;return e[r._KEYS].forEach(e=>{i.has(e)||T.map((s,r)=>{t.Object.compareValues(s,e)&&i.set(e,new this.Item(this,a[r],l[r]))}),i.has(e)||(_=!1)}),_||n[r._DONE]?i:this._fetchNextSet(e,s,i)})}_fetchUntilKey(e,s,i,n){if(null!=s){const e=i[r._ITEMS].filter(e=>{if(t.KeyUtils.equals(e[r._METADATA][r._KEY],s))return!0});if(e.length>0){const t=i[r._ITEMS].indexOf(e[0]);i[r._ITEMS]=i[r._ITEMS].slice(t,i[r._ITEMS].length)}else{if(!i[r._DONE])return n.next().then(t=>{let e=t[r._VALUE];e||(e={data:[],metadata:[],fetchParameters:null});const s=e[r._DATA],h=e[r._METADATA],l=s.map((t,e)=>new this.Item(this,h[e],s[e])),a=this._getMappedItems(l);return this._cacheResult(i,a),i[r._DONE]=t[r._DONE],this._fetchUntilKey(t[r._FETCHPARAMETERS],a[r._KEYS],i,n)});i[r._ITEMS]=[]}}return Promise.resolve(null)}_fetchUntilOffset(t,e,s,i,n,h){const l=null!=t&&t[r._SIZE]>0?t[r._SIZE]:s;e=e>0?e:0;const a=i[r._ITEMS].slice(e,e+l);if(this._noFilterSupport){const e=this._getMappedFilterCriterion(t[r._FILTERCRITERION]);this._filterResult(e,a)}return t&&t[r._SIZE]>0&&a.length<l&&!i[r._DONE]?n.next().then(s=>{let l=s[r._VALUE];l||(l={data:[],metadata:[],fetchParameters:null});const a=l[r._DATA],T=l[r._METADATA],_=a.map((t,e)=>new this.Item(this,T[e],a[e]));if(this._noFilterSupport){const e=this._getMappedFilterCriterion(t[r._FILTERCRITERION]);this._filterResult(e,_)}s.done&&_.length>0&&(i[r._LASTDONEHASDATA]=!0);const E=this._getMappedItems(_);return this._cacheResult(i,E),i[r._DONE]=s[r._DONE],this._fetchUntilOffset(t,e,a.length,i,n,h)}):this._createResultPromise(t,i,a,h)}_createResultPromise(t,e,s,i){e[r._STARTINDEX]=e[r._STARTINDEX]+s.length;const n=s.map(t=>t[r._DATA]),h=s.map(t=>t[r._METADATA]);let l=!1;return e[r._DONE]&&0===n.length&&(l=!0),this._updateFilteredRowCountObservable(i,t),l?Promise.resolve(new this.AsyncIteratorReturnResult(this,new this.FetchListResult(this,t,n,h,i))):Promise.resolve(new this.AsyncIteratorYieldResult(this,new this.FetchListResult(this,t,n,h,i)))}_cacheResult(t,e){e.forEach(e=>{t[r._ITEMS].push(e)})}_filterResult(t,s){if(t){t.filter||(t=e.FilterFactory.getFilter({filterDef:t}));let i=s.length-1;for(;i>=0;)t.filter(s[i][r._DATA])||s.splice(i,1),i--}}_getMappedItems(t){if(null!=this[r._INTERNAL_DATAMAPPING]){const e=this[r._INTERNAL_DATAMAPPING][r._MAPFIELDS];if(null!=e&&null!=t&&t.length>0){return t.map(t=>e.bind(this)(t))}}return t}_combineFilters(t){const s=[];let i,n=0;return null!=t&&null!=t[r._FILTERCRITERION]&&(s[n]=t[r._FILTERCRITERION],n++),null!=this[r._INTERNAL_FILTERCRITERION]&&(s[n]=this[r._INTERNAL_FILTERCRITERION]),i=0==s.length?null:1==s.length?s[0]:e.FilterFactory.getFilter({filterDef:{op:"$and",criteria:s}}),i}_getMappedFilterCriterion(t){if(null!=this[r._INTERNAL_DATAMAPPING]){const e=this[r._INTERNAL_DATAMAPPING][r._MAPFILTERCRITERION];if(null!=e&&null!=t)return e(t)}return t}_getMappedSortCriteria(t){if(null!=this[r._INTERNAL_DATAMAPPING]){const e=this[r._INTERNAL_DATAMAPPING][r._MAPSORTCRITERIA];if(null!=e&&null!=t&&t.length>0)return e(t)}return t}_getUnmappedSortCriteria(t){if(null!=this[r._INTERNAL_DATAMAPPING]){const e=this[r._INTERNAL_DATAMAPPING][r._UNMAPSORTCRITERIA];if(null!=e&&null!=t&&t.length>0)return e(t)}return t}_getUnmappedFilterCriterion(t){if(null!=this[r._INTERNAL_DATAMAPPING]){const e=this[r._INTERNAL_DATAMAPPING][r._UNMAPFILTERCRITERION];if(null!=e&&null!=t)return e(t)}return t}_addEventListeners(t){t[r._ADDEVENTLISTENER](r._REFRESH,t=>{this.dispatchEvent(t)}),t[r._ADDEVENTLISTENER](r._MUTATE,t=>{this.dispatchEvent(t)})}_updateFilteredRowCountObservable(t,e){if("enabled"===this.options?.includeFilteredRowCount||e&&"enabled"===e.includeFilteredRowCount){let e={type:"unknown"};null!=t&&t>=0&&(e={type:"exact",count:t}),this.getTotalFilteredRowCountObservable()?.next(e)}}}return r._KEY="key",r._KEYS="keys",r._DATA="data",r._STARTINDEX="startIndex",r._SORT="sort",r._INTERNAL_SORTCRITERIA="_sortCriteria",r._SORTCRITERIA="sortCriteria",r._INTERNAL_FILTERCRITERION="_filterCriterion",r._FILTERCRITERION="filterCriterion",r._METADATA="metadata",r._ITEMS="items",r._INTERNAL_FROM="_from",r._INTERNAL_OFFSET="_offset",r._FROM="from",r._OFFSET="offset",r._REFRESH="refresh",r._MUTATE="mutate",r._SIZE="size",r._FETCHPARAMETERS="fetchParameters",r._VALUE="value",r._DONE="done",r._LASTDONEHASDATA="lastDoneHasData",r._INTERNAL_DATAMAPPING="_dataMapping",r._DATAMAPPING="dataMapping",r._MAPFIELDS="mapFields",r._MAPSORTCRITERIA="mapSortCriteria",r._MAPFILTERCRITERION="mapFilterCriterion",r._UNMAPSORTCRITERIA="unmapSortCriteria",r._UNMAPFILTERCRITERION="unmapFilterCriterion",r._RESULTS="results",r._CONTAINSPARAMETERS="containsParameters",r._DEFAULT_SIZE=25,r._CONTAINSKEYS="containsKeys",r._FETCHBYKEYS="fetchByKeys",r._FETCHBYOFFSET="fetchByOffset",r._FETCHFIRST="fetchFirst",r._ADDEVENTLISTENER="addEventListener",r._INTERNAL_FETCHATTRIBUTES="_attributes",r._FETCHATTRIBUTES="attributes",r._TOTALFILTEREDROWCOUNT="totalFilteredRowCount",r._SIGNAL="signal",r._INCLUDEFILTEREDROWCOUNT="includeFilteredRowCount",s.EventTargetMixin.applyMixin(r),t._registerLegacyNamespaceProp("ListDataProviderView",r),r});
//# sourceMappingURL=ojlistdataproviderview.js.map