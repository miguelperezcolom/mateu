/**
 * @license
 * Copyright (c) 2014, 2025, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["jquery","ojs/ojjquery-hammer","ojs/ojpopupcore","ojs/ojoption","ojs/ojcore-base","hammerjs","ojs/ojcontext","ojs/ojthemeutils","ojs/ojcomponentcore","ojs/ojanimation","ojs/ojlogger","ojs/ojconfig","ojs/ojcustomelement-utils","ojs/ojcustomelement-registry","ojs/ojtranslation"],function(e,t,i,n,s,o,r,a,l,u,c,h,m,d,p){"use strict";var f;e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,s=s&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,function(){var t=[],n=!1,f="oj-menu-position";const _="OJ-MENU-SELECT-MANY",v=".oj-menu-item",g=".oj-focus-ancestor",O=".oj-menu-divider",b=".oj-disabled",j="oj-disabled",y="aria-expanded",C="aria-hidden",S="aria-disabled",E="aria-activedescendant",P="data-oj-default-margin",I="margin-left",T="margin-right",A="oj-menu-item-before-divider",x={dropdown:{open:"--oj-private-menu-global-drop-down-open-animation",close:"--oj-private-menu-global-drop-down-close-animation"},sheet:{open:"--oj-private-menu-global-sheet-open-animation",close:"--oj-private-menu-global-sheet-close-animation"},submenu:{open:"--oj-private-menu-global-submenu-open-animation",close:"--oj-private-menu-global-submenu-close-animation"}};var N="menuItem"===a.getCachedCSSVarValues(["--oj-private-menu-global-sheet-cancel-affordance"])[0],w="dismiss"===a.getCachedCSSVarValues(["--oj-private-menu-global-sheet-swipe-down-behavior"])[0],D=a.getCachedCSSVarValues(["--oj-private-menu-global-drop-down-modality"])[0]||"modeless",M=a.getCachedCSSVarValues(["--oj-private-menu-global-sheet-modality"])[0]||"modal",H="bottom-"+(a.getCachedCSSVarValues(["oj-private-menu-global-sheet-margin-bottom"])[0]||0),k=w&&{recognizers:[[o.Swipe,{direction:o.DIRECTION_HORIZONTAL}]]},R="oj-menu-cancel-command";function B(t){var i,n=[],s=t.children("oj-defer").first();i=s.length>0?s.children(".oj-menu-item, oj-menu-select-many"):t.children(".oj-menu-item, oj-menu-select-many");for(var o=0;o<i.length;o++){var r=e(i[o]);r.is(v)?n.push(r[0]):r[0].nodeName===_&&(n=e.merge(n,r.children(v)))}return n}s.__registerWidget("oj.ojMenu",e.oj.baseComponent,{defaultElement:"<ul>",delay:300,role:"menu",widgetEventPrefix:"oj",options:{menuSelector:"ul",openOptions:{display:"auto",initialFocus:"menu",launcher:null,position:{my:{horizontal:"start",vertical:"top"},offset:{x:0,y:0},at:{horizontal:"start",vertical:"bottom"},of:void 0,collision:"flipfit"}},submenuOpenOptions:{position:{my:"start top",at:"end top",collision:"flipfit"}},animateStart:null,animateEnd:null,beforeOpen:null,close:null,open:null,action:null,menuAction:null},_ComponentCreate:function(){if(this._super(),this._focusForTesting=this._focus,this._nextForTesting=this._next,this._selectForTesting=this._select,this._IsCustomElement()){this.element.hide();var e=this.options;e.openOptions.position=i.PositionUtils.coerceToJet(e.openOptions.position);var t=this.element[0].querySelector("oj-defer");t&&t.setAttribute("data-oj-context",!0)}else this._createAsTopLevelMenu()},_preventDefault:function(e){this.options.disabled&&e.preventDefault()},_createAsTopLevelMenu:function(){var t=this;this.activeMenu=this.element,this.mouseHandled=!1,this._setupSwipeBehavior(),this.element.uniqueId().addClass("oj-menu oj-component").hide().attr({role:this.role,tabIndex:"0","aria-hidden":"true"}),this._on(!0,{"mousedown .oj-menu-item":this._preventDefault,click:this._preventDefault,keydown:function(t){this.options.disabled&&(t.keyCode!==e.ui.keyCode.ESCAPE&&t.keyCode!==e.ui.keyCode.TAB||(t.keyCode===e.ui.keyCode.TAB&&t.preventDefault(),this._focusLauncherAndDismiss(t)))}}),this.options.disabled&&this.element.addClass(j).attr(S,"true");var i=function(t){if(!this.focusHandled){this.focusHandled=!0;var i=e(t.currentTarget);try{this._focusIsFromPointer=!0,this._focus(t,i)}finally{this._focusIsFromPointer=!1}}}.bind(this),n=function(t){e(t.target).is(":visible")&&this._collapse(t,"eventSubtree")}.bind(this);this._touchStartHandler=function(t){this.focusHandled=!1;var i=e(t.currentTarget);this._focus(t,i)}.bind(this),this.element[0].addEventListener("touchstart",this._touchStartHandler,{passive:!0}),this._delegatedHandleMouseEnterMenuItem=function(t){const n=v,s=t.currentTarget,o=t.target.closest(n);o&&s.contains(o)&&i(e.Event(t,{currentTarget:o}))},this.element[0].addEventListener("touchstart",this._delegatedHandleMouseEnterMenuItem,{passive:!0}),this._on({"click .oj-disabled > a":function(e){e.preventDefault()},click:function(){this.mouseHandled=!1},mouseover:function(){this.focusHandled=!1},"click .oj-menu-item:has(a)":function(t){var i=e(t.target).closest(v);if(!this.mouseHandled&&i.not(b).length){if(this.mouseHandled=!0,t.preventDefault(),this.active&&this.active.closest(i).length&&this.active.get(0)!==i.get(0))return;i.has(".oj-menu").length?this._expand(t):(this._select(t),this.element.is(":focus")||this.active&&1===this.active.parents(".oj-menu").length&&this._clearTimer&&this._clearTimer())}},"mouseenter .oj-menu-item":i,mouseleave:n,"mouseleave .oj-menu":n,focus:function(t,i){if(!i&&t.target!==this.element[0]){var n=this.active||e(B(this.element)).first(0);this._focus(t,n)}},keydown:this._keydown,keyup:function(t){t.keyCode!==e.ui.keyCode.ENTER&&t.keyCode!==e.ui.keyCode.SPACE||(this.__spaceEnterDownInMenu=!1)}}),this._focusable({applyHighlight:!0,recentPointer:function(){return t._focusIsFromPointer},setupHandlers:function(e,i){t._focusInHandler=e,t._focusOutHandler=i}}),this._usingCallback=e.proxy(this._usingHandler,this),this._setup()},_createAsSubmenu:function(){this.element.attr(l._OJ_CONTAINER_ATTR,this.widgetName),this.element.uniqueId().addClass("oj-menu oj-component oj-menu-submenu oj-menu-dropdown").hide().attr({role:this.role,tabIndex:"0","aria-hidden":"true"}),this._setup()},__contextMenuPressHoldJustEnded:function(e){if(!arguments.length)return n;n=e},_processOjOptions:function(){this._maxEndIconCount=0,this._maxStartIconCount=0,this._startIconWidth=0,this._endIconWidth=0;var t=function(t){var i,n=[],s=t.children("oj-defer").first();i=s.length>0?s.children("oj-option, oj-menu-select-many"):t.children("oj-option, oj-menu-select-many");for(var o=0;o<i.length;o++){var r=e(i[o]);"OJ-OPTION"===r[0].nodeName?n.push(r[0]):r[0].nodeName===_&&(n=e.merge(n,r.children("oj-option")))}return e(n)}(this.element);this._clearOption(t);for(var i=0;i<t.length;i++){t[i].customOptionRenderer=this._customOptionRenderer.bind(this)}},_customOptionRenderer:function(t){function i(e){if(e.previousElementSibling&&"OJ-OPTION"===e.previousElementSibling.nodeName)return e.previousElementSibling;if(e.previousElementSibling&&e.previousElementSibling.nodeName===_){var t=e.previousElementSibling.lastElementChild;return"OJ-OPTION"===t.nodeName?t:t.previousElementSibling?t.previousElementSibling:i(t)}return e.previousElementSibling||e.parentElement.nodeName!==_?void 0:i(e.parentElement)}function n(e){return e.nextElementSibling&&"OJ-OPTION"===e.nextElementSibling.nodeName?e.nextElementSibling:e.nextElementSibling&&e.nextElementSibling.nodeName===_?e.nextElementSibling.firstElementChild:e.nextElementSibling&&"OJ-OPTION"===e.nextElementSibling.nodeName||e.parentElement.nodeName!==_?void 0:n(e.parentElement)}var s=e(t),o=s.parent().prop("nodeName")===_,r=this;this._hasSubmenus=!1;for(var a,l,u,c,h=s.children('a[ojmenu="opt"]'),d=0;d<h.length;d++)(a=e(h[d])).children().removeClass("oj-menu-item-icon").removeClass("oj-menu-item-end-icon"),a.replaceWith(a.contents());if(s.children('span[ojmenu="opt"]').remove(),/[^\-\u2014\u2013\s]/.test(s.text())||0!==s.children().length){this._initMenuItems(s);var p=document.createElement("a");p.setAttribute("ojmenu","opt"),(a=e(p)).uniqueId().attr({tabIndex:"-1",role:this._itemRole(s)}),o&&(a.attr("aria-checked","false"),(l=t).previousElementSibling||i(l)||e(l).addClass("oj-top"),l.nextElementSibling&&"OJ-OPTION"===l.nextElementSibling.nodeName||n(l)||e(l).addClass("oj-bottom")),s.prepend(p);var f=m.CustomElementUtils.getSlotMap(t),v=f.startIcon;if(v||o){if(o){var g=document.createElement("span");g.setAttribute("slot","startIcon"),g.setAttribute("ojmenu","opt"),g.setAttribute("class","oj-menucheckbox-icon"),v?v.splice(0,0,g):v=[g]}var O=v.length;r._maxStartIconCount=Math.max(r._maxStartIconCount,O),e.each(v,function(t,i){e(i).addClass("oj-menu-item-icon"),a.append(i),O>1&&r._positionStartIcon(i,t,O)})}var b=0,y=f.endIcon;y&&(b=y.length,r._maxEndIconCount=Math.max(r._maxEndIconCount,b));var C=f[""];e.each(C,function(t,i){e(i).is("oj-menu")?(r._setupSubmenu(a,e(i),0===b),r._hasSubmenus=!0):a.append(i)}),y&&e.each(y,function(t,i){e(i).addClass("oj-menu-item-end-icon"),a.append(i),b>1&&r._positionEndIcon(i,t,b)}),t.disabled?(s.addClass(j),a.attr(S,"true")):(s.removeClass(j),a.removeAttr(S))}else this._initDividers(s),(c=i(u=t))&&e(c).addClass(A),(c=n(u))&&e(c).addClass("oj-menu-item-after-divider");this._updateMenuPadding(this.element)},_positionStartIcon:function(t,i,n){var s;s=this.isRtl?T:I;var o=Number(e(t).attr(P));isNaN(o)&&(o=parseInt(e(t).css(s),10),e(t).attr(P,o)),this._startIconWidth=-1*o,e(t).css(s,o*(n-i)+"px")},_positionEndIcon:function(t,i,n){var s,o;this.isRtl?(s=I,o=T):(s=T,o=I);var r=Number(e(t).attr(P));isNaN(r)&&(r=parseInt(e(t).css(s),10),e(t).attr(P,r)),this._endIconWidth=-1*parseInt(e(t).css(o),10),e(t).css(s,r+this._endIconWidth*(n-i-1)+"px")},_updateMenuPadding:function(t){var i=e(B(t)).children();i.each(function(){let t=e(this).children(".oj-menu-item-icon:not(.oj-menu-cancel-icon)").length,i=e(this).children(".oj-menu-item-end-icon").length||e(this).children(".oj-menu-submenu-icon").length;0===t&&0===i?e(this).addClass("oj-menu-option-text-only"):(t>0&&e(this).addClass("oj-menu-option-start-icon"),i>0&&e(this).addClass("oj-menu-option-end-icon"))}),this._maxStartIconCount&&this._maxStartIconCount>1&&this._applyAnchorIconPadding(i,this._startIconWidth,this._maxStartIconCount,!0),this._maxEndIconCount&&this._maxEndIconCount>1&&this._applyAnchorIconPadding(i,this._endIconWidth,this._maxEndIconCount,!1)},_applyAnchorIconPadding:function(t,i,n,s){var o;o=this.isRtl&&s||!this.isRtl&&!s?"padding-right":"padding-left",t.each(function(){var t=Number(e(this).attr("data-oj-default-padding"));isNaN(t)&&(t=parseInt(e(this).css(o),10),e(this).attr("data-oj-default-padding",t)),e(this).css(o,t+i*(n-1)+"px")})},_clickAwayHandler:function(i){if("focus"===i.type||"mousedown"===i.type||"touchstart"===i.type||121===i.keyCode&&i.shiftKey||93===i.keyCode){if("mousedown"===i.type&&n)return;var s=this,o=t.slice(0,t.length);e.each(o,function(t,n){if(!e(i.target).closest(n.element).length&&("keydown"===i.type||"mousedown"===i.type&&3===i.which||!e(i.target).closest(n._launcher).length||n._isContextMenu&&("mousedown"===i.type&&3!==i.which||"touchstart"===i.type))&&!n._dismissEvent){n._dismissEvent=i;var o=n._collapse(i,"eventSubtree");s._runOnPromise(o,function(){n.__dismiss(i),n._dismissEvent=null})}})}},_setOption:function(e,t){this._superApply(arguments),"translations"===e&&this._cancelAnchor&&this._cancelAnchor.text(this.options.translations.labelCancel)},_destroy:function(){this.element.is(":visible")&&this.__dismiss(),this._setWhenReady("none"),this._clearTimer&&this._clearTimer(),delete this._clearTimer,this.element[0].removeEventListener("touchstart",this._touchStartHandler,{passive:!0}),delete this._touchStartHandler,this.element[0].removeEventListener("touchstart",this._delegatedHandleMouseEnterMenuItem,{passive:!0}),delete this._delegatedHandleMouseEnterMenuItem,this.element.removeAttr(E).removeClass("oj-component").find(".oj-menu").addBack().removeClass("oj-menu oj-menu-submenu oj-menu-icons oj-menu-end-icons oj-menu-text-only").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr(C).removeAttr(S).removeUniqueId().show(),this.element.find(v).removeClass("oj-menu-item").removeAttr("role").children("a").removeAttr(S).removeUniqueId().removeClass("oj-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("oj-ojMenu-submenu-icon")&&t.remove()}),this.element.find("a").removeAttr(y),this.element.find(O).removeClass("oj-menu-divider").removeAttr("role"),delete this._popupServiceEvents,delete this._usingCallback;var t=this._clearCloseDelayTimer;delete this._clearCloseDelayTimer,t&&t(),this.element.ojHammer("destroy"),this._super()},_keydown:function(t){var i=!0;function n(e){return e.replace(/[-\[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}switch(t.keyCode){case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this._previous(t);break;case e.ui.keyCode.DOWN:this._next(t);break;case e.ui.keyCode.LEFT:case e.ui.keyCode.RIGHT:t.keyCode===e.ui.keyCode.RIGHT!==this.isRtl?this.active&&!this.active.is(b)&&this._expand(t):this._collapse(t,"active");break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._handleEnterSpace(t),this.__spaceEnterDownInMenu=!0;var s=this;setTimeout(function(){s.__spaceEnterDownInMenu=!1},100);break;case e.ui.keyCode.TAB:t.preventDefault(),this._focusLauncherAndDismiss(t);break;case e.ui.keyCode.ESCAPE:if(this._launcher){var o=this.element.attr(E),r=e(document.getElementById(o)).parents(".oj-menu").first();r.length>0&&r[0]!==this.element[0]?this._collapse(t,"active"):this._focusLauncherAndDismiss(t)}else this._collapse(t,"active");break;default:i=!1;var a=this.previousFilter||"",l=String.fromCharCode(t.keyCode),u=!1;clearTimeout(this.filterTimer),l===a?u=!0:l=a+l;var c=new RegExp("^"+n(l),"i"),h=e(B(this.activeMenu)).filter(function(){return c.test(e(this).children("a").text())});(h=u&&-1!==h.index(this.active.next())?this.active.nextAll(v):h).length||(l=String.fromCharCode(t.keyCode),c=new RegExp("^"+n(l),"i"),h=e(B(this.activeMenu)).filter(function(){return c.test(e(this).children("a").text())})),h.length?(this._focus(t,h),h.length>1?(this.previousFilter=l,this.filterTimer=setTimeout(function(){delete this.previousFilter}.bind(this),1e3)):delete this.previousFilter):delete this.previousFilter}i&&t.preventDefault()},_handleEnterSpace:function(e){this.active&&!this.active.is(b)&&(this.active.children("a[aria-haspopup='true']").length?this._expand(e):this._select(e))},refresh:function(){function t(t){for(var i=t.element.find("oj-menu:not(.oj-menu-submenu)"),n=0;n<i.length;n++){e(i[n]).attr(C,"true").hide(),r.getContext(i[n]).getBusyContext().whenReady().then(function(e){e.refresh()}.bind(t,i[n]))}}(this._super(),this._IsCustomElement()&&!this._wasCreated)?(this.element.parent().is("oj-option")&&(this._isSubmenu=!0,this._createAsSubmenu()),this._isSubmenu||(l.subtreeShown(this.element[0]),this._createAsTopLevelMenu(),t(this)),this._wasCreated=!0):(t(this),this._setup());if(i.ZOrderUtils.getStatus(this.element)===i.ZOrderUtils.STATUS.OPEN){var n=r.getContext(this.element[0]).getBusyContext().addBusyState({description:"Waiting for menu to be rendered with new DOM correctly"});requestAnimationFrame(()=>{n(),this._reposition(!0),this._closeHiddenButton&&(this._closeHiddenButton.style.top=this.element[0].getBoundingClientRect().top-1+"px")})}},_reposition:function(t){var i=this.element;if(i.is(":visible")&&(n=i[0],!((s=n.getBoundingClientRect()).width>document.documentElement.clientWidth||s.height>document.documentElement.clientHeight)||t)){var n,s,o=i.data(f);i[0].style.maxHeight="",i[0].style.overflowY="",this._updateMenuMaxHeight(),i.position(o),i.find(".oj-menu").each(function(){var t=e(this);t.is(":visible")&&(o=t.data(f),t.position(o))})}},_setup:function(){this.isRtl="rtl"===this._GetReadingDirection(),this._IsCustomElement()?(this._processOjOptions(),this._isSubmenu&&(this.options.openOptions.launcher=this.element.parent()),this._updateMenuPadding(this.element)):this._setupWidgetMenus(),this.active&&!e.contains(this.element[0],this.active[0])&&this._blur()},_setupWidgetMenus:function(){var t=this,i=this.element.find(this.options.menuSelector),n=i.add(this.element),s=n.children();this._hasSubmenus=!!i.length,s.filter(O).has("a").removeClass("oj-menu-divider oj-menu-item").removeAttr("role");var o=s.filter(":not(.oj-menu-item):has(a)"),r=o.children("a");this._initMenuItems(o),this._initAnchors(r);var a=s.filter(function(t,i){var n=e(i);return n.is(":not(.oj-menu-item)")&&!/[^\-\u2014\u2013\s]/.test(n.text())});this._initDividers(a),this._initDividerNeighbors(s,a),s.filter(b).children("a").attr(S,"true"),s.filter(":not(.oj-disabled)").children("a").removeAttr(S),i.filter(":not(.oj-menu)").addClass("oj-menu oj-menu-submenu oj-menu-dropdown").hide().attr({role:this.role,"aria-hidden":"true"}).each(function(){var i=e(this);t._setupSubmenu(t._getSubmenuAnchor(i),i,!0)}),n.each(function(){t._updateMenuPadding(e(this))})},_setupSubmenu:function(t,i,n){var s=0!==t[0].querySelectorAll(".oj-menu-submenu-icon.oj-component-icon").length;if(t.attr("aria-haspopup","true").attr("role","menuitem").attr(y,"false"),n&&!s){var o=e("<span>");o.addClass("oj-menu-submenu-icon oj-component-icon").data("oj-ojMenu-submenu-icon",!0),t.append(o)}this._clearTimer=this._setTimer(function(){delete this._clearTimer,t[0].parentElement&&t[0].parentElement.disabled&&i.find("oj-option").attr("disabled",!0)},this._getSubmenuBusyStateDescription("enable or disable submenu"),0),i.attr("aria-labelledby",t.attr("id"))},_initMenuItems:function(e){e.addClass("oj-menu-item").attr("role","presentation")},_initAnchors:function(t){for(var i=0;i<t.length;i++){var n=e(t[i]);n.uniqueId().attr({tabIndex:"-1",role:this._itemRole(n.parent())})}},_initDividers:function(e){e.addClass("oj-menu-divider").attr("role","separator")},_initDividerNeighbors:function(e,t){e.removeClass("oj-menu-item-before-divider oj-menu-item-after-divider"),t.prev().addClass(A),t.next().addClass("oj-menu-item-after-divider")},_clearOption:function(e){e.removeClass("oj-menu-item-before-divider oj-menu-item-after-divider oj-menu-divider oj-menu-item").removeAttr("role")},_getSubmenuAnchor:function(e){return e.prev("a")},_getSubmenuWidget:function(e){return l.__GetWidgetConstructor(e,"ojMenu")("instance")},_itemRole:function(e){return e.parent().prop("nodeName")===_?"menuitemcheckbox":"menuitem"},_getAdjacentDividers:function(e,t){var i=e.prev(O).add(e.next(O));return t&&(i=i.add(e)),i},_focus:function(t,i){var n=this.active?this.active:e();if(!i.is(n)){t&&"focus"===t.type||this._clearTimer&&this._clearTimer(),i=i.first(),this._makeActive(i,t);var s=i.parents(".oj-menu").first(),o=s.closest(v);s.find(g).removeClass("oj-focus-ancestor"),this._getAdjacentDividers(o,!0).addClass("oj-focus-ancestor"),t&&"keydown"===t.type?this._close():this._clearTimer=this._setTimer(function(){return delete this._clearTimer,this._close()},this._getSubmenuBusyStateDescription("closing"),this.delay);var r=this._IsCustomElement()?i.children("oj-menu"):i.children(".oj-menu"),a=r.length>0&&n.length>0&&e.contains(r[0],n[0]);r.length&&t&&/^mouse|click/.test(t.type)&&!a&&this._startOpening(t,r),this.activeMenu=i.parents(".oj-menu").first()}},_makeActive:function(t,i){if(!t.is(this.active)){var n,s,o,r,a=this.active?this.active:e(),l=t.children("a");this.active=t,this.element.attr(E,l.attr("id")),this._focusOutHandler(a),this._focusInHandler(t),this._getAdjacentDividers(a).removeClass("oj-focus"),this._getAdjacentDividers(t).addClass("oj-focus"),this._trigger("_activeItem",i,{previousItem:a,item:t,privateNotice:"The _activeItem event is private.  Do not use."}),i&&/^key/.test(i.type)&&(n=l[0],s=n.closest("[role=menu]"),o=n.getBoundingClientRect(),r=s.getBoundingClientRect(),o.top<0||o.bottom>document.documentElement.clientHeight||r.top>o.top||r.bottom<o.bottom||o.left<0||o.right>document.documentElement.clientWidth)&&l[0].scrollIntoView()}},_removeActive:function(t){if(this.active){var i=this.active;this.active=null,this.element.removeAttr(E),this._focusOutHandler(i),this._getAdjacentDividers(i).removeClass("oj-focus"),this._trigger("_activeItem",t,{previousItem:i,item:e(),privateNotice:"The _activeItem event is private.  Do not use."})}},_blur:function(e){this._clearTimer&&this._clearTimer(),this._removeActive(e)},_focusLauncherAndDismiss:function(e,t){this._launcher&&this._launcher.focus(),this.__dismiss(e,t)},close:function(){this.__dismiss()},__dismiss:function(e,t){if(!this._isOperationPending("close","__dismiss",[e,t])&&i.ZOrderUtils.getStatus(this.element)===i.ZOrderUtils.STATUS.OPEN){var n=this.element.is(":visible");this._setWhenReady("close");var s={};s[i.PopupService.OPTION.POPUP]=this.element,s[i.PopupService.OPTION.CONTEXT]={event:e,selectUi:t,isOpen:n},i.PopupService.getInstance().close(s)}},_getDefaultAnimation:function(e,t){var i=x,n=a.getCachedCSSVarValues([i[e][t]])[0];return JSON.parse(n)},_isAnimationDisabled:function(){return!this._IsCustomElement()||this._disableAnimation},_replaceAnimationOptions:function(e,t){var i=e;if(t&&e&&"string"!=typeof e){for(var n=JSON.stringify(e),s=Object.keys(t),o=0;o<s.length;o++){var r=s[o];n=n.replace(new RegExp(r,"g"),t[r])}i=JSON.parse(n)}return i},_runOnPromise:function(e,t){return e?e.then(t):t()},_beforeCloseHandler:function(e){var t=e[i.PopupService.OPTION.POPUP];if(this._IsCustomElement()){var n=e[i.PopupService.OPTION.CONTEXT],s=n.selectUi;if(s&&s.item.length){var o={},r=s.item[0],a=n.event;o.originalEvent=a.originalEvent;var l={detail:o,cancelable:!0,bubbles:!0},c=new CustomEvent("ojAction",l);r.dispatchEvent(c),l.detail.selectedValue=r.value;var h=new CustomEvent("ojMenuAction",l);this.element[0].dispatchEvent(h),n.event=h}}if(!this._isAnimationDisabled()){var m=this._getDefaultAnimation(this._sheetMenuIsOpen?"sheet":"dropdown","close"),d=u.startAnimation(t[0],"close",i.PositionUtils.addTransformOriginAnimationEffectsOption(t,m),this);return d.then(function(){t.attr(C,"true").hide()}),d}t.attr(C,"true").hide()},_afterCloseHandler:function(e){var n=e[i.PopupService.OPTION.CONTEXT],s=n.event,o=n.selectUi,a=n.isOpen;if(this.element.removeData(f),this._launcher=null,this._sheetMenuIsOpen=!1,!this._IsCustomElement()&&o){var l=this._trigger2("select",s,o);s=l.event}if(a){var u=r.getContext(this.element[0]).getBusyContext().addBusyState({description:"close event about to be triggered"});requestAnimationFrame(()=>{u(),this._trigger("close",s,{})})}this._currentOpenOptions=null;var c=t.indexOf(this);t.splice(c,1),this._removeSheetMenuCloseHiddenButton()},getCurrentOpenOptions:function(){return e.extend(!0,{},this._currentOpenOptions||this.options.openOptions)},_closeMenuIfOpen:function(e,t,n){i.ZOrderUtils.getStatus(this.element)===i.ZOrderUtils.STATUS.OPEN&&(this._disableAnimation=!0,this._currentOpenOptions=e,this.__dismiss(t.event),this._dismissEvent=null,this._currentOpenOptions=n)},open:function(n,o){var l=arguments[2];if(!this._isOperationPending("open","open",[n,o,l])){var u=function(n,o){this._IsCustomElement()&&this.refresh(),this.element.removeAttr(E),this.element.find(".oj-focus").removeClass("oj-focus"),this.focusHandled=!1,this._focusIsFromPointer=!1,this.mouseHandled=!1,this.activeMenu=this.element,this.active=null,(o=e.extend({},this.options.openOptions,o)).position=e.extend({},o.position),n&&"keydown"===n.type&&121===n.which&&(o.initialFocus="firstItem"),this._IsCustomElement()&&this._setPosition(o.position),l=e.extend({},this.options.submenuOpenOptions,l);var r=this._currentOpenOptions;this._currentOpenOptions=o,i.PositionUtils._normalizeEventForPosition(n),this._isContextMenu=this.element[0].slot&&"contextMenu"===this.element[0].slot;var u=this._trigger2("beforeOpen",n,{openOptions:o});if(!u.proceed)return this._currentOpenOptions=r,void(this._disableAnimation=!1);this._closeMenuIfOpen(r,u,o);var h=o.launcher;if(!(h=this._IsCustomElement()?"string"===e.type(h)?e(document.getElementById(h)):e(h):"string"===e.type(h)?e(h):h)||!h.length)return c.warn("When calling Menu.open(), must specify openOptions.launcher via the component option, method param, or beforeOpen listener.  Ignoring the call."),this._currentOpenOptions=null,void(this._disableAnimation=!1);var m,d,p=this._isDropDown(o.display);if(this._toggleCancelDom(p),p){this.element.addClass("oj-menu-dropdown").removeClass("oj-menu-sheet"),d=D;var _=i.PositionUtils.normalizeHorizontalAlignment(o.position,this.isRtl);if(!_.of&&_.offset&&0===_.offset.x&&0===_.offset.y){const e=a.getCachedCSSVarValues(["--oj-private-core-global-dropdown-offset"])[0]||0;_.offset={x:0,y:e}}this._IsCustomElement()?(_=i.PositionUtils.coerceToJet(_,this.options.openOptions.position),this._referenceOpenPosition=_,m=i.PositionUtils.coerceToJqUi(_)):(this._referenceOpenPosition=_,m=_),m.of=i.PositionUtils.normalizePositionOf(m.of,h,n)}else this.element.addClass("oj-menu-sheet").removeClass("oj-menu-dropdown"),d=M,m={my:"bottom",at:H,of:window,collision:"flipfit"};var v=this.element[0],g=t.slice(0,t.length);e.each(g,function(e,t){t.element[0]!==v&&(t._collapse(n,"eventSubtree"),t.__dismiss(n))}),this._submenuPosition=i.PositionUtils.normalizeHorizontalAlignment(l.position,this.isRtl);var O=this._usingCallback;e.isFunction(m.using)&&(m.origUsing=m.using),m.using=O,this.element.data(f,m),this._setWhenReady("open");var b={};b[i.PopupService.OPTION.POPUP]=this.element,b[i.PopupService.OPTION.LAUNCHER]=h,b[i.PopupService.OPTION.POSITION]=m,b[i.PopupService.OPTION.EVENTS]=this._getPopupServiceEvents(),b[i.PopupService.OPTION.LAYER_SELECTORS]="oj-menu-layer",b[i.PopupService.OPTION.MODALITY]=d,b[i.PopupService.OPTION.CONTEXT]={event:n,initialFocus:o.initialFocus,launcher:h,isDropDown:p},b[i.PopupService.OPTION.CUSTOM_ELEMENT]=this._IsCustomElement();var j=i.PopupService.getInstance(),y=j.open.bind(j,b),C=this.element[0].querySelector("oj-defer");C?s.Context.getContext(C).getBusyContext().whenReady().then(y):y();this._disableAnimation=!1}.bind(this,n,o);if(this._dismissEvent)r.getContext(this.element[0]).getBusyContext().whenReady().then(u);else u()}},_setPosition:function(e){var t=this.options;t.openOptions.position=i.PositionUtils.coerceToJet(e,t.openOptions.position)},_beforeOpenHandler:function(e){var t,n=e[i.PopupService.OPTION.POPUP],s=e[i.PopupService.OPTION.POSITION],o=e[i.PopupService.OPTION.CONTEXT],r=o.event,a=o.isDropDown,l=o.initialFocus;if(n[0].style.maxHeight="",n[0].style.overflowY="",n.show(),a&&(s=this._checkBrowserVerticalScollBar(o,s)),this.rootHeight=n[0].offsetHeight,"click"===s.of.type?(this.launcherHeight=s.of.clientY,this.launcherTop=s.of.clientY):(this.launcherHeight=o.launcher[0].getBoundingClientRect().bottom,this.launcherTop=o.launcher[0].getBoundingClientRect().top),this._updateMenuMaxHeight(),n.position(s),this.initialWidth=n.width(),this.initialHeight=n.height(),"firstItem"===l){var c=this._getFirstItem();this._focus(r,c)}if(!this._isAnimationDisabled()){var h=this._getDefaultAnimation(a?"dropdown":"sheet","open");t=u.startAnimation(n[0],"open",i.PositionUtils.addTransformOriginAnimationEffectsOption(n,h),this)}return t},_checkBrowserVerticalScollBar:function(t,n){var s=t.launcher,o=e.position.scrollbarWidth(),r=window.innerWidth>document.documentElement.clientWidth,a=window.innerWidth-s[0].offsetLeft-this.element[0].offsetWidth<o;if(!r||!a)return n;if(this._referenceOpenPosition.offset.x=-1*o,this._IsCustomElement()){var l=i.PositionUtils.coerceToJqUi(this._referenceOpenPosition);return Object.assign(n,{my:l.my})}return Object.assign(n,{offset:{my:-1*o}})},_updateMenuMaxHeight:function(e){var t=e?e[0]:this.element[0],i=this._isDropDown(this.options.openOptions.display);const n=s.AgentUtils.getAgentInfo().browser===s.AgentUtils.BROWSER.SAFARI;if(!i||t.offsetHeight<window.innerHeight||n&&t.querySelectorAll("oj-menu").length)return;const o="OJ-OPTION"===t.parentNode.nodeName?t.parentNode.getBoundingClientRect().bottom:this.launcherHeight;let r;const a=this.launcherTop,l=window.innerHeight-o;r=this.options.openOptions.position.collision.includes(["none","fit"])?"top"===this.options.openOptions.position.at.vertical?a:l:Math.max(l,a)-25,r<25&&(r=25),t.style.maxHeight=r+"px",t.style.overflowY="auto"},_afterOpenHandler:function(e){var n,o=e[i.PopupService.OPTION.POPUP],r=e[i.PopupService.OPTION.CONTEXT],a=r.event,l=r.launcher,u=r.isDropDown,c=r.initialFocus;(this._launcher=l,this._sheetMenuIsOpen=!u,t.push(this),this.initialWidth===o.width()&&this.initialHeight===o.height()&&s.AgentUtils.getAgentInfo().os!==s.AgentUtils.OS.IOS||this._reposition(),delete this.initialWidth,delete this.initialHeight,this._createSheetMenuCloseHiddenButton(e),"firstItem"===c||"menu"===c)&&(n=this.element,this._IsCustomElement()?window.setImmediate(function(){n.is(":focusable")&&n.focus()}):n.focus());this._trigger("open",a,{})},_createSheetMenuCloseHiddenButton:function(e){const t=e[i.PopupService.OPTION.POPUP];if(!e[i.PopupService.OPTION.CONTEXT].isDropDown){const e=s.ZOrderUtils.getOpenPopupLayer(t)[0],i=t[0];if(e&&i){const t=document.createElement("a");t.tabIndex=-1,t.role="button";const n=p.getTranslatedString("oj-ojDialog.labelCloseIcon");t.ariaLabel=n,t.addEventListener("click",e=>{this.__collapseAll(e,!0),this._focusLauncherAndDismiss(e)}),t.classList.add("oj-menu-sheet-hidden-button"),t.style.top=i.getBoundingClientRect().top-1+"px",this._closeHiddenButton=t,e.insertBefore(t,i)}}},_removeSheetMenuCloseHiddenButton:function(){this._closeHiddenButton&&(this._closeHiddenButton.remove(),delete this._closeHiddenButton)},_getFirstItem:function(){return this.element.find(v).first()},_startOpening:function(e,t){this._clearTimer&&this._clearTimer(),this._IsCustomElement()&&t[0].refresh(),this._clearTimer=this._setTimer(function(){return delete this._clearTimer,this._close().then(function(){this._open(e,t)}.bind(this))},this._getSubmenuBusyStateDescription("closing and opening"),this.delay)},_open:function(t,n){if("true"===n.attr(C)&&this.active){var s;if(this._IsCustomElement()){var o=this._getSubmenuWidget(n);if(!o._trigger2("beforeOpen",t).proceed)return;const e=parseInt(window.getComputedStyle(document.documentElement).fontSize,10),r=-(.5*e+1),a=-.5*e;let l=Object.assign(o.options.openOptions.position,{offset:{x:a,y:r}});s=i.PositionUtils.coerceToJqUi(l),s=i.PositionUtils.normalizeHorizontalAlignment(s,this.isRtl)}else s=this._submenuPosition;if(s=e.extend({of:this.active},s),this._clearTimer&&this._clearTimer(),this.element.find(".oj-menu").not(n.parents(".oj-menu")).hide().attr(C,"true").removeData(f),n.show().removeAttr(C).position(s).data(f,s),this._getSubmenuAnchor(n).attr(y,"true"),this._updateMenuMaxHeight(n),n.position(n.data(f)),!this._isAnimationDisabled()){var a=r.getContext(this.element[0]).getBusyContext().addBusyState({description:this._getSubmenuBusyStateDescription("opening")}),l=this._getDefaultAnimation("submenu","open"),c=s.my.slice();!this.isRtl&&parseFloat(n[0].style.left)<0?c="right top":this.isRtl&&parseFloat(n[0].style.left)>0&&(c="left top"),l=this._replaceAnimationOptions(l,{"#myPosition":c}),u.startAnimation(n[0],"open",l,this).then(a)}}},__collapseAll:function(t,i,n){var s;this._clearTimer&&this._clearTimer();var o=this,a=function(){delete o._clearTimer;var n=i?o.element:e(t&&t.target).closest(o.element.find(".oj-menu"));n.length||(n=o.element);var s=o._close(n);return s=o._runOnPromise(s,function(){o._blur(t),o.activeMenu=n})};if(n?this._isAnimationDisabled()?o._clearTimer=o._setTimer(a,o._getSubmenuBusyStateDescription("closing"),n):s=new Promise(function(e){o._clearTimer=o._setTimer(a,o._getSubmenuBusyStateDescription("closing"),n,function(){e(!0)})}):s=a(),s){var l=r.getContext(this.element[0]).getBusyContext().addBusyState({description:"closing submenus"});s.then(l)}return s},_close:function(t){var i;t||(t=this.active?this.active.parents(".oj-menu").first():this.element);var n=this,s=n._getDefaultAnimation("submenu","close"),o=t.find(".oj-menu"),r=function(e){e.hide().attr(C,"true").removeData(f),n._getSubmenuAnchor(e).attr(y,"false")};if(this._isAnimationDisabled())r(o),t.find(g).removeClass("oj-focus-ancestor"),i=Promise.resolve(!0);else{var a=function(t){var i=null;return e(B(t)).children(".oj-menu").each(function(t,o){var l=e(o);if(l.is(":visible")){var c=a(l);i=n._runOnPromise(c,function(){var e=l.data(f),t=n._replaceAnimationOptions(s,{"#myPosition":e.my});return u.startAnimation(o,"close",t,n).then(function(){r(l)})})}else r(l),i=Promise.resolve(!0)}),i};i=a(t),i=this._runOnPromise(i,function(){t.find(g).removeClass("oj-focus-ancestor")})}return i},_collapse:function(e,t){var i;if(null==t||"active"===t){var n=this.activeMenu&&this.activeMenu.closest(v,this.element);if(n&&n.length){var s=this;i=this._close(),i=this._runOnPromise(i,function(){s._focus(e,n)})}}else"all"===t||"eventSubtree"===t?i=this.__collapseAll(e,"all"===t,this.delay):c.warn("Invalid param "+t+" passed to Menu._collapse().  Ignoring the call.");return i},_expand:function(t){var i,n;if(this.active){var s=B(n=this.active.children(".oj-menu ").first());s.length>0&&(i=e(s[0]))}i&&i.length&&(this._open(t,n),this._clearTimer&&this._clearTimer(),this._clearTimer=this._setTimer(function(){delete this._clearTimer,this._focus(t,i)},this._getBusyStateDescription("focusing an item")))},_next:function(e){this._move("next","first",e)},_previous:function(e){this._move("prev","last",e)},_move:function(t,i,n){var s,o=B(this.activeMenu),r=o.indexOf(this.active?this.active[0]:null);r>-1?"first"===t?s=o[0]:"last"===t?s=o[o.length-1]:"next"===t?s=r+1<o.length?o[r+1]:o[0]:"prev"===t&&(s=r-1>-1?o[r-1]:o[o.length-1]):s="first"===i?o[0]:o[o.length-1],this._focus(n,e(s))},_select:function(t){if(!this.active&&t&&t.target){var i=e(t.target).closest(v);i.closest(this.element).length&&this._makeActive(i,t)}var n=this.active.is(this._cancelItem)?void 0:{item:this.active},s=this.__collapseAll(t,!0);this._runOnPromise(s,function(){this._focusLauncherAndDismiss(t,n)}.bind(this))},_surrogateRemoveHandler:function(){var e=this.element;i.ZOrderUtils.getStatus(e)===i.ZOrderUtils.STATUS.OPEN&&(m.CustomElementUtils.cleanComponentBindings(e[0]),e.remove())},_getPopupServiceEvents:function(){if(!this._popupServiceEvents){var e={};this._popupServiceEvents=e,e[i.PopupService.EVENT.POPUP_CLOSE]=this._closeAll.bind(this),e[i.PopupService.EVENT.POPUP_REMOVE]=this._surrogateRemoveHandler.bind(this),e[i.PopupService.EVENT.POPUP_REFRESH]=this._reposition.bind(this),e[i.PopupService.EVENT.POPUP_AUTODISMISS]=this._clickAwayHandler.bind(this),e[i.PopupService.EVENT.POPUP_BEFORE_OPEN]=this._beforeOpenHandler.bind(this),e[i.PopupService.EVENT.POPUP_AFTER_OPEN]=this._afterOpenHandler.bind(this),e[i.PopupService.EVENT.POPUP_BEFORE_CLOSE]=this._beforeCloseHandler.bind(this),e[i.PopupService.EVENT.POPUP_AFTER_CLOSE]=this._afterCloseHandler.bind(this)}return this._popupServiceEvents},_closeAll:function(){this._disableAnimation=!0,this._close(this.element),this.__dismiss(null),this._setWhenReady("none")},_usingHandler:function(e,t){var n=t.element.element;n.css(e),i.PositionUtils.captureTransformOriginAnimationEffectsOption(n,t);var s=n.data(f).origUsing;s&&s(e,t),i.PositionUtils.isAligningPositionClipped(t)&&(this._clearCloseDelayTimer=this._setTimer(this._closeAll,this._getSubmenuBusyStateDescription("closing"),1))},getNodeBySubId:function(e){return e&&e.subId===R?this._cancelDomAttached?this._cancelItem[0]:null:this._super(e)},getSubIdByNode:function(t){return this._cancelItem&&this._cancelItem.is(e(t).parents().addBack(t))?{subId:R}:this._super(t)},_isDropDown:function(e){if(this._hasSubmenus)return!0;switch(e){case"dropDown":return!0;case"sheet":return!1;default:return"phone"!==h.getDeviceRenderMode()}},_toggleCancelDom:function(t){function i(t,i){var n=B(t),s=n.indexOf(i[1]);return e(n[s-1])}if(N)if(t)this._cancelDomAttached&&(i(this.element,this._getCancelDom()).removeClass(A),this._getCancelDom().detach(),this._cancelDomAttached=!1);else{var n=this._getCancelDom();n.appendTo(this.element),i(this.element,n).addClass(A),this._cancelDomAttached=!0}},_getCancelDom:function(){if(!this._cancelDom){var t=e("<li></li>",this.document[0]),i=e("<a></a>",this.document[0]).text(this.options.translations.labelCancel);e("<span class='oj-menu-item-icon oj-component-icon oj-menu-cancel-icon'></span>",this.document[0]).prependTo(i);var n=e("<li></li>",this.document[0]).addClass("oj-menu-item-cancel oj-menu-item-after-divider").append(i);this._initDividers(t),this._initAnchors(i),this._initMenuItems(n),this._cancelAnchor=i,this._cancelItem=n,this._cancelDom=e([t[0],n[0]])}return this._cancelDom},_setupSwipeBehavior:function(){w&&(this.element.ojHammer(k),this._on({swipedown:function(e){this._sheetMenuIsOpen&&"touch"===e.gesture.pointerType&&(this.__collapseAll(e,!0),this._focusLauncherAndDismiss(e))}}))},_setWhenReady:function(e){var t=this._whenReadyMediator;t&&(t.destroy(),delete this._whenReadyMediator),["open","close"].indexOf(e)<0||(this._whenReadyMediator=new i.PopupWhenReadyMediator(this.element,e,"ojMenu",this._IsCustomElement()))},_isOperationPending:function(e,t,i){var n=this._whenReadyMediator;return!!n&&n.isOperationPending(this,e,t,i)},_setTimer:function(e,t,i,n){var s=r.getContext(this.element[0]).getBusyContext().addBusyState({description:t}),o=function(){s&&(s(),s=null,n&&n())},a=this,l=setTimeout(function(){var t=e.bind(a)();t&&t instanceof Promise?t.then(o):o()},i||0);return function(){clearTimeout(l),o()}},_getBusyStateDescription:function(e){return"Menu with id '"+this.element.attr("id")+"' is busy "+e+"."},_getSubmenuBusyStateDescription:function(e){return this._getBusyStateDescription(e+" a submenu")},_NotifyDetached:function(){i.ZOrderUtils.getStatus(this.element)===i.ZOrderUtils.STATUS.OPEN&&this._closeAll(),this._super()}}),l.setDefaultOptions({ojMenu:{openOptions:l.createDynamicPropertyGetter(function(e){return{position:d.isElementRegistered(e.element.tagName)?e.containers.indexOf("ojMenu")>=0?{my:{horizontal:"start",vertical:"top"},at:{horizontal:"end",vertical:"top"},offset:{x:0,y:0},collision:"flipfit"}:{my:{horizontal:"start",vertical:"top"},at:{horizontal:"start",vertical:"bottom"},offset:{x:0,y:0},collision:"flipfit"}:{my:"start top",at:"start bottom",collision:"flipfit"}}})}})}(),(f={properties:{disabled:{type:"boolean",value:!1},openOptions:{type:"object",properties:{display:{type:"string",enumValues:["auto","dropDown","sheet"],value:"auto"},initialFocus:{type:"string",enumValues:["firstItem","menu","none"],value:"menu"},launcher:{type:"string|Element"},position:{type:"object",properties:{at:{type:"object",properties:{horizontal:{type:"string",enumValues:["center","end","left","right","start"]},vertical:{type:"string",enumValues:["bottom","center","top"]}}},collision:{type:"string",enumValues:["fit","flip","flipcenter","flipfit","none"],value:"flipfit"},my:{type:"object",properties:{horizontal:{type:"string",enumValues:["center","end","left","right","start"],value:"start"},vertical:{type:"string",enumValues:["bottom","center","top"],value:"top"}}},of:{type:"string|object"},offset:{type:"object",properties:{x:{type:"number",value:0},y:{type:"number",value:0}}}}}}},translations:{type:"object",value:{},properties:{ariaFocusSkipLink:{type:"string"},labelCancel:{type:"string"}}}},methods:{close:{},getProperty:{},open:{},refresh:{},setProperties:{},setProperty:{},getNodeBySubId:{},getSubIdByNode:{}},events:{ojAction:{},ojAnimateEnd:{},ojAnimateStart:{},ojBeforeOpen:{},ojClose:{},ojMenuAction:{},ojOpen:{}},extension:{}}).extension._WIDGET_NAME="ojMenu",s.CustomElementBridge.register("oj-menu",{metadata:f})});
//# sourceMappingURL=ojmenu.js.map